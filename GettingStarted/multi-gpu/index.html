
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="SELF Documentation">
      
      
        <meta name="author" content="Fluid Numerics">
      
      
      
        <link rel="prev" href="../building-with-self/">
      
      
        <link rel="next" href="../../Tutorials/BurgersEquation1D/TravelingShock/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Using Multiple GPUs - Spectral Element Library in Fortran</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="cyan">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#multi-gpu-computing-with-self" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Spectral Element Library in Fortran" class="md-header__button md-logo" aria-label="Spectral Element Library in Fortran" data-md-component="logo">
      
  <img src="../../assets/images/logo-fluid-numerics.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spectral Element Library in Fortran
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Using Multiple GPUs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/fluidnumerics/SELF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub/fluidnumerics/SELF
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spectral Element Library in Fortran" class="md-nav__button md-logo" aria-label="Spectral Element Library in Fortran" data-md-component="logo">
      
  <img src="../../assets/images/logo-fluid-numerics.png" alt="logo">

    </a>
    Spectral Element Library in Fortran
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/fluidnumerics/SELF" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub/fluidnumerics/SELF
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dependencies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dependencies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../building-with-self/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building Applications with SELF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Using Multiple GPUs
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Using Multiple GPUs
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    Key Concepts:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpirun-options-for-sequential-affinity" class="md-nav__link">
    mpirun Options for Sequential Affinity:
  </a>
  
    <nav class="md-nav" aria-label="mpirun Options for Sequential Affinity:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-command" class="md-nav__link">
    Example Command:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation-of-options" class="md-nav__link">
    Explanation of Options:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-for-multi-gpu-nodes" class="md-nav__link">
    Example for Multi-GPU Nodes:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-process-bindings-with-mpirun" class="md-nav__link">
    Validating process bindings with mpirun
  </a>
  
    <nav class="md-nav" aria-label="Validating process bindings with mpirun">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openmpi" class="md-nav__link">
    OpenMPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mpich" class="md-nav__link">
    MPICH
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launching-with-slurm" class="md-nav__link">
    Launching with Slurm:
  </a>
  
    <nav class="md-nav" aria-label="Launching with Slurm:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validating-process-bindings-with-slurm" class="md-nav__link">
    Validating process bindings with Slurm
  </a>
  
    <nav class="md-nav" aria-label="Validating process bindings with Slurm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-execution-information" class="md-nav__link">
    Job Execution Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slurm-environment-variables" class="md-nav__link">
    Slurm Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job-allocation-report" class="md-nav__link">
    Job Allocation Report
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-specific-considerations" class="md-nav__link">
    System-Specific Considerations:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Burgers Equation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Burgers Equation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/BurgersEquation1D/TravelingShock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Traveling Shock
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linear Euler (2D)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linear Euler (2D)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearEuler2D/PlaneWavePropagation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plane wave propagation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearEuler2D/PlaneWaveReflection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plane wave reflection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearEuler2D/SphericalSoundWave/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spherical sound wave
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linear Euler (3D)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Linear Euler (3D)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearEuler3D/PlaneWavePropagation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plane wave propagation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearEuler3D/SphericalSoundWave/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spherical sound wave
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linear Shallow Water (2D)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Linear Shallow Water (2D)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearShallowWater/LinearShallowWater.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reflecting wave
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearShallowWater/KelvinWaves/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kelvin waves
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Tutorials/LinearShallowWater/PlanetaryRossbyWave/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planetary Rossby wave
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Models/burgers-equation-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Viscous Burgers Equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Models/linear-euler-2d-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear Euler (2D)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Models/linear-euler-3d-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear Euler (3D)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Models/linear-shallow-water-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linear Shallow Water (2D)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mesh Generation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Mesh Generation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../MeshGeneration/Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../MeshGeneration/StructuredMesh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Structured Mesh Generators
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Learning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Theory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Theory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Learning/SpectralApproximations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spectral Approximations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Learning/DifferentialGeometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Differential Geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Learning/ProvableStability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Provable Stability
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Code
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Learning/SoftwareArchitecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Learning/dependencies.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dependencies
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../ford/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Contributing/Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    Key Concepts:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mpirun-options-for-sequential-affinity" class="md-nav__link">
    mpirun Options for Sequential Affinity:
  </a>
  
    <nav class="md-nav" aria-label="mpirun Options for Sequential Affinity:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-command" class="md-nav__link">
    Example Command:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation-of-options" class="md-nav__link">
    Explanation of Options:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-for-multi-gpu-nodes" class="md-nav__link">
    Example for Multi-GPU Nodes:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-process-bindings-with-mpirun" class="md-nav__link">
    Validating process bindings with mpirun
  </a>
  
    <nav class="md-nav" aria-label="Validating process bindings with mpirun">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#openmpi" class="md-nav__link">
    OpenMPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mpich" class="md-nav__link">
    MPICH
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launching-with-slurm" class="md-nav__link">
    Launching with Slurm:
  </a>
  
    <nav class="md-nav" aria-label="Launching with Slurm:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validating-process-bindings-with-slurm" class="md-nav__link">
    Validating process bindings with Slurm
  </a>
  
    <nav class="md-nav" aria-label="Validating process bindings with Slurm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-execution-information" class="md-nav__link">
    Job Execution Information
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slurm-environment-variables" class="md-nav__link">
    Slurm Environment Variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#job-allocation-report" class="md-nav__link">
    Job Allocation Report
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-specific-considerations" class="md-nav__link">
    System-Specific Considerations:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="multi-gpu-computing-with-self">Multi-GPU Computing with SELF<a class="headerlink" href="#multi-gpu-computing-with-self" title="Permanent link">#</a></h1>
<p>SELF builds come with domain-decomposition enabled by default, which allows you to run in parallel using distributed memory parallelism with MPI. When you build SELF with GPU acceleration enabled, native support is provided for multi-GPU platforms. The key requirement is that you are working with a GPU Aware MPI installation (see <a href="https://gpuopen.com/learn/amd-lab-notes/amd-lab-notes-gpu-aware-mpi-readme/">GPU Aware MPI with ROCm</a> and <a href="https://developer.nvidia.com/blog/introduction-cuda-aware-mpi/">GPU Aware MPI with CUDA</a>).</p>
<h2 id="key-concepts">Key Concepts:<a class="headerlink" href="#key-concepts" title="Permanent link">#</a></h2>
<ol>
<li><strong>Process Affinity</strong>: Bind MPI processes to specific CPUs/cores and GPUs to optimize performance by reducing interconnect overhead.</li>
<li><strong>Sequential Rank Assignment</strong>: Assign MPI ranks such that ranks for a node are packed together before moving to the next node.</li>
<li><strong>Mapping Policies</strong>: Use <code>mpirun</code>'s mapping and binding options to control how MPI processes are distributed across nodes and resources.</li>
</ol>
<p>When deploying SELF on multi-GPU platforms, each MPI rank is assigned to a single GPU. The GPU assignment algorithm is simple and is implemented in the <code>Init_DomainDecomposition</code> method defined in the <code>src/gpu/SELF_DomainDecomposition.f90</code> module. Each MPI rank queries HIP or CUDA for the number of GPU devices on your server. The device id assigned to the MPI process is set as the modulo of the MPI rank id and the number of devices.</p>
<p>If you are working on clusters of multi-GPU accelerated nodes, this implies that all servers have the same number of GPUs. Additionally, if you are explicitly setting your process affinity, you will want to assign MPI ranks to pack servers sequentially.</p>
<h2 id="mpirun-options-for-sequential-affinity"><code>mpirun</code> Options for Sequential Affinity:<a class="headerlink" href="#mpirun-options-for-sequential-affinity" title="Permanent link">#</a></h2>
<p>Use these options when launching your application with <code>mpirun</code>:</p>
<ul>
<li><code>--map-by ppr:N:node</code>: Places <code>N</code> processes per node.</li>
<li><code>--bind-to core</code> or <code>--bind-to socket</code>: Binds processes to specific cores or sockets.</li>
<li><code>--rank-by slot</code> or <code>--rank-by node</code>: Determines how ranks are ordered within the mapping.</li>
</ul>
<h3 id="example-command">Example Command:<a class="headerlink" href="#example-command" title="Permanent link">#</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>mpirun<span class="w"> </span>--map-by<span class="w"> </span>ppr:1:node<span class="w"> </span>--bind-to<span class="w"> </span>core<span class="w"> </span>--rank-by<span class="w"> </span>node<span class="w"> </span>-np<span class="w"> </span>&lt;num_procs&gt;<span class="w"> </span>./your_self_application
</span></code></pre></div>
<h3 id="explanation-of-options">Explanation of Options:<a class="headerlink" href="#explanation-of-options" title="Permanent link">#</a></h3>
<ol>
<li><code>--map-by ppr:1:node</code>: Places 1 MPI process per GPU (assuming one GPU per rank) and packs the ranks sequentially on each node.</li>
<li><code>--bind-to core</code>: Binds each MPI process to a core, ensuring proper CPU affinity.</li>
<li><code>--rank-by node</code>: Ensures that ranks are assigned sequentially across nodes.</li>
<li><code>-np &lt;num_procs&gt;</code>: Specifies the total number of MPI processes.</li>
</ol>
<h3 id="example-for-multi-gpu-nodes">Example for Multi-GPU Nodes:<a class="headerlink" href="#example-for-multi-gpu-nodes" title="Permanent link">#</a></h3>
<p>If each node has 4 GPUs and you want 4 MPI processes per node:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>mpirun<span class="w"> </span>--map-by<span class="w"> </span>ppr:4:node<span class="w"> </span>--bind-to<span class="w"> </span>core<span class="w"> </span>--rank-by<span class="w"> </span>node<span class="w"> </span>-np<span class="w"> </span>&lt;total_procs&gt;<span class="w"> </span>./your_self_application
</span></code></pre></div></p>
<p>This ensures:
- MPI ranks <code>0-3</code> are on Node 1 (bound to GPUs <code>0-3</code>).
- MPI ranks <code>4-7</code> are on Node 2 (bound to GPUs <code>0-3</code>), and so on.</p>
<p>To validate process affinity and report process bindings, both MPI and Slurm provide tools and options to display detailed information about how MPI ranks and processes are mapped to hardware resources (e.g., CPUs, GPUs).</p>
<h3 id="validating-process-bindings-with-mpirun">Validating process bindings with <code>mpirun</code><a class="headerlink" href="#validating-process-bindings-with-mpirun" title="Permanent link">#</a></h3>
<p>Most MPI implementations have options to print detailed binding information.</p>
<h4 id="openmpi">OpenMPI<a class="headerlink" href="#openmpi" title="Permanent link">#</a></h4>
<p>OpenMPI provides options to report process bindings:
- Add <code>--report-bindings</code> to your <code>mpirun</code> command:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>mpirun<span class="w"> </span>--report-bindings<span class="w"> </span>--map-by<span class="w"> </span>ppr:1:node<span class="w"> </span>--bind-to<span class="w"> </span>core<span class="w"> </span>--rank-by<span class="w"> </span>node<span class="w"> </span>-np<span class="w"> </span>&lt;num_procs&gt;<span class="w"> </span>./your_application
</span></code></pre></div></p>
<ul>
<li>
<p>Example Output:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Rank 0: bound to socket 0[core 0]
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Rank 1: bound to socket 0[core 1]
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Rank 2: bound to socket 0[core 2]
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Rank 3: bound to socket 0[core 3]
</span></code></pre></div></p>
</li>
<li>
<p>Use <code>--display-map</code> to visualize the mapping of ranks across nodes:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>mpirun<span class="w"> </span>--display-map<span class="w"> </span>--map-by<span class="w"> </span>ppr:1:node<span class="w"> </span>--bind-to<span class="w"> </span>core<span class="w"> </span>./your_application
</span></code></pre></div></p>
</li>
<li>
<p>Example Output:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>Data for JOB [12345,1] offset 0
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Mapping policy: BYNODE, Binding policy: CORE
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>...
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>Node: node01  Ranks: 0, 1, 2, 3
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>Node: node02  Ranks: 4, 5, 6, 7
</span></code></pre></div></p>
</li>
</ul>
<h4 id="mpich">MPICH<a class="headerlink" href="#mpich" title="Permanent link">#</a></h4>
<p>MPICH can display binding information using the <code>MPICH_RANK_REORDER_DISPLAY</code> environment variable:
- Set the environment variable before running:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MPICH_RANK_REORDER_DISPLAY</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>mpirun<span class="w"> </span>-np<span class="w"> </span>&lt;num_procs&gt;<span class="w"> </span>./your_application
</span></code></pre></div>
- Example Output:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>Rank 0 running on node01
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>Rank 1 running on node01
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>...
</span></code></pre></div></p>
<h2 id="launching-with-slurm">Launching with Slurm:<a class="headerlink" href="#launching-with-slurm" title="Permanent link">#</a></h2>
<p>For Slurm-managed clusters, the equivalent command is:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>srun<span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">4</span><span class="w"> </span>--cpus-per-task<span class="o">=</span>&lt;cpus_per_mpi_process&gt;<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>--distribution<span class="o">=</span>block:block<span class="w"> </span>./your_application
</span></code></pre></div></p>
<p>This approach ensures proper resource packing and sequential affinity per node.</p>
<h3 id="validating-process-bindings-with-slurm">Validating process bindings with Slurm<a class="headerlink" href="#validating-process-bindings-with-slurm" title="Permanent link">#</a></h3>
<p>Slurm provides options to display detailed information about how tasks are distributed and bound.</p>
<h4 id="job-execution-information">Job Execution Information<a class="headerlink" href="#job-execution-information" title="Permanent link">#</a></h4>
<ul>
<li>
<p>Add the <code>--cpu-bind</code> or <code>--gpu-bind</code> flag to <code>srun</code> to specify binding and display it:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>srun<span class="w"> </span>--cpu-bind<span class="o">=</span>verbose<span class="w"> </span>--gpus-per-task<span class="o">=</span><span class="m">1</span><span class="w"> </span>--ntasks-per-node<span class="o">=</span><span class="m">4</span><span class="w"> </span>./your_application
</span></code></pre></div></p>
</li>
<li>
<p>Example Output:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>srun: CPU Bindings: rank 0 on cores 0-3
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>srun: CPU Bindings: rank 1 on cores 4-7
</span></code></pre></div></p>
</li>
</ul>
<h4 id="slurm-environment-variables">Slurm Environment Variables<a class="headerlink" href="#slurm-environment-variables" title="Permanent link">#</a></h4>
<ul>
<li>
<p>Slurm provides environment variables during job execution, which you can print from within your application:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>getenv<span class="o">(</span><span class="s2">&quot;SLURM_TASKS_PER_NODE&quot;</span><span class="o">)</span><span class="w">   </span>!<span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>tasks<span class="w"> </span>per<span class="w"> </span>node
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>getenv<span class="o">(</span><span class="s2">&quot;SLURM_CPUS_ON_NODE&quot;</span><span class="o">)</span><span class="w">     </span>!<span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span>CPUs<span class="w"> </span>allocated
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>getenv<span class="o">(</span><span class="s2">&quot;SLURM_JOB_NODELIST&quot;</span><span class="o">)</span><span class="w">     </span>!<span class="w"> </span>List<span class="w"> </span>of<span class="w"> </span>allocated<span class="w"> </span>nodes
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>getenv<span class="o">(</span><span class="s2">&quot;SLURM_LOCALID&quot;</span><span class="o">)</span><span class="w">          </span>!<span class="w"> </span>Local<span class="w"> </span>rank<span class="w"> </span>ID
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>getenv<span class="o">(</span><span class="s2">&quot;SLURM_PROCID&quot;</span><span class="o">)</span><span class="w">           </span>!<span class="w"> </span>Global<span class="w"> </span>rank<span class="w"> </span>ID
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>getenv<span class="o">(</span><span class="s2">&quot;SLURM_CPU_BIND&quot;</span><span class="o">)</span><span class="w">         </span>!<span class="w"> </span>CPU<span class="w"> </span>binding
</span></code></pre></div></p>
</li>
<li>
<p>Example Fortran snippet:
  <div class="language-fortran highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SLURM_PROCID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;SLURM_PROCID&quot;</span><span class="p">)</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">print</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;SLURM_CPU_BIND:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">getenv</span><span class="p">(</span><span class="s2">&quot;SLURM_CPU_BIND&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
</ul>
<h4 id="job-allocation-report">Job Allocation Report<a class="headerlink" href="#job-allocation-report" title="Permanent link">#</a></h4>
<p>Run <code>scontrol show job &lt;job_id&gt;</code> to display task and resource binding for a running or completed job:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>scontrol<span class="w"> </span>show<span class="w"> </span>job<span class="w"> </span>&lt;job_id&gt;
</span></code></pre></div></p>
<ul>
<li>Relevant fields in the output include:</li>
<li><code>TaskAffinity</code></li>
<li><code>CpusPerTask</code></li>
<li><code>TRES</code> (e.g., GPUs, memory)</li>
<li><code>Nodes</code> and <code>Nodelist</code></li>
</ul>
<h3 id="system-specific-considerations">System-Specific Considerations:<a class="headerlink" href="#system-specific-considerations" title="Permanent link">#</a></h3>
<ol>
<li><strong><code>mpirun</code> Implementation</strong>: The specific MPI implementation (e.g., OpenMPI, MPICH) might have slightly different syntax or options. Check your implementations documentation.</li>
<li><strong>Resource Manager Integration</strong>: If using a resource manager like Slurm, consider its process binding flags (e.g., <code>--distribution block:block</code> or <code>--ntasks-per-node</code>).</li>
<li><strong>NUMA domains</strong> : When assing process affinity, you should also consider the latency between CPUs and GPUs on your system. On AMD platforms, you can use <code>rocm-bandwidth-test</code> to report on your system's topology; On Nvidia platforms, you can use <code>nvidia-smi -topo</code>. Ideally, MPI ranks should be assigned to the NUMA domain closest to their assigned GPU.</li>
</ol>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>