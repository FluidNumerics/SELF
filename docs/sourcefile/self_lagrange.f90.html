<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="SELF -- Spectral Element Libraries in Fortran. Fortran classes for implementing spectral element methods on CPU and GPU hardware.">
    
    <meta name="author" content="Joe Schoonover" >
    <link rel="icon" href="../favicon.png">

    <title>SELF_Lagrange.f90 &ndash; SELF</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SELF </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/self.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/self.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>SELF_Lagrange.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title="19.6% of total for source files.">1666 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/SELF_Lagrange.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">SELF_Lagrange.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/self_lagrange.html">SELF_Lagrange</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/self_lagrange.f90.html#src">SELF_Lagrange.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.30.1 (20201013.1554)
 -->
<!-- Title: sourcefile~~self_lagrange.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileself_lagrangef90EfferentGraph" width="464pt" height="154pt"
 viewBox="0.00 0.00 464.00 154.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 150)">
<title>sourcefile~~self_lagrange.f90~~EfferentGraph</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-150 461,-150 461,5 -4,5"/>
<!-- sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_node1" class="node"><title>sourcefile~self_lagrange.f90</title>
<polygon fill="none" stroke="black" points="455.5,-86 340.5,-86 340.5,-62 455.5,-62 455.5,-86"/>
<text text-anchor="middle" x="398" y="-71.6" font-family="Helvetica,sans-Serif" font-size="10.50">SELF_Lagrange.f90</text>
</g>
<!-- sourcefile~self_memory.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_node3" class="node"><title>sourcefile~self_memory.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/self_memory.f90.html" xlink:title="SELF_Memory.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="281,-146 175,-146 175,-122 281,-122 281,-146"/>
<text text-anchor="middle" x="228" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_Memory.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_memory.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_memory.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M364.338,-86.0929C346.529,-92.6484 324.082,-100.849 304,-108 294.263,-111.467 283.794,-115.135 273.858,-118.587"/>
<polygon fill="#ff0000" stroke="#ff0000" points="272.449,-115.371 264.146,-121.953 274.741,-121.985 272.449,-115.371"/>
</g>
<!-- sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_node2" class="node"><title>sourcefile~self_constants.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/self_constants.f90.html" xlink:title="SELF_Constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="116,-86 0,-86 0,-62 116,-62 116,-86"/>
<text text-anchor="middle" x="58" y="-71.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_Constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M340.443,-74.7053C328.414,-74.8281 315.787,-74.9366 304,-75 236.445,-75.3632 219.555,-75.3632 152,-75 143.644,-74.9551 134.866,-74.8875 126.178,-74.8081"/>
<polygon fill="#ff0000" stroke="#ff0000" points="126.085,-71.3072 116.051,-74.7103 126.017,-78.3068 126.085,-71.3072"/>
</g>
<!-- sourcefile~self_quadrature.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_node4" class="node"><title>sourcefile~self_quadrature.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/self_quadrature.f90.html" xlink:title="SELF_Quadrature.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="290.5,-66 165.5,-66 165.5,-42 290.5,-42 290.5,-66"/>
<text text-anchor="middle" x="228" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_Quadrature.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_quadrature.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_edge3" class="edge"><title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_quadrature.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M340.123,-67.2289C327.455,-65.7208 313.865,-64.103 300.688,-62.5343"/>
<polygon fill="#ff0000" stroke="#ff0000" points="301.058,-59.0537 290.715,-61.347 300.231,-66.0047 301.058,-59.0537"/>
</g>
<!-- sourcefile~self_supportroutines.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_node5" class="node"><title>sourcefile~self_supportroutines.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/self_supportroutines.f90.html" xlink:title="SELF_SupportRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="303.5,-24 152.5,-24 152.5,-0 303.5,-0 303.5,-24"/>
<text text-anchor="middle" x="228" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_SupportRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_supportroutines.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_edge4" class="edge"><title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_supportroutines.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M372.131,-61.8787C353.621,-53.1434 327.587,-41.4531 304,-33 298.153,-30.9044 291.989,-28.8848 285.81,-26.9812"/>
<polygon fill="#ff0000" stroke="#ff0000" points="286.716,-23.599 276.133,-24.0912 284.713,-30.3064 286.716,-23.599"/>
</g>
<!-- sourcefile~self_memory.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_edge5" class="edge"><title>sourcefile~self_memory.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M191.854,-121.953C179.266,-117.602 164.982,-112.623 152,-108 135.37,-102.078 117.118,-95.4363 101.22,-89.6052"/>
<polygon fill="#7fff00" stroke="#7fff00" points="102.255,-86.2568 91.6618,-86.0929 99.8409,-92.8272 102.255,-86.2568"/>
</g>
<!-- sourcefile~self_quadrature.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_edge6" class="edge"><title>sourcefile~self_quadrature.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M165.397,-61.3337C152.687,-62.8467 139.24,-64.4476 126.338,-65.9835"/>
<polygon fill="#00ffff" stroke="#00ffff" points="125.65,-62.5407 116.134,-67.1984 126.477,-69.4916 125.65,-62.5407"/>
</g>
<!-- sourcefile~self_supportroutines.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_lagrange.f90~~EfferentGraph_edge7" class="edge"><title>sourcefile~self_supportroutines.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M179.867,-24.0912C170.555,-26.7897 160.91,-29.8068 152,-33 132.098,-40.1323 110.454,-49.5692 93.0585,-57.5912"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="91.4515,-54.4788 83.8692,-61.8787 94.4113,-60.8223 91.4515,-54.4788"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.30.1 (20201013.1554)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="201pt" height="32pt"
 viewBox="0.00 0.00 201.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-28 198,-28 198,5 -4,5"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="70.25,-24 -0.25,-24 -0.25,-0 70.25,-0 70.25,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193,-24 89,-24 89,-0 193,-0 193,-24"/>
<text text-anchor="middle" x="141" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.30.1 (20201013.1554)
 -->
<!-- Title: sourcefile~~self_lagrange.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileself_lagrangef90AfferentGraph" width="641pt" height="127pt"
 viewBox="0.00 0.00 641.00 127.11" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph" class="graph" transform="scale(0.681915 0.681915) rotate(0) translate(4 182.402)">
<title>sourcefile~~self_lagrange.f90~~AfferentGraph</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-182.402 937,-182.402 937,5 -4,5"/>
<!-- sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node1" class="node"><title>sourcefile~self_lagrange.f90</title>
<polygon fill="none" stroke="black" points="115.5,-126 0.5,-126 0.5,-102 115.5,-102 115.5,-126"/>
<text text-anchor="middle" x="58" y="-111.6" font-family="Helvetica,sans-Serif" font-size="10.50">SELF_Lagrange.f90</text>
</g>
<!-- sourcefile~self_tests.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node2" class="node"><title>sourcefile~self_tests.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/self_tests.f90.html" xlink:title="SELF_Tests.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="827,-66 737,-66 737,-42 827,-42 827,-66"/>
<text text-anchor="middle" x="782" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_Tests.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_tests.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~self_tests.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M623,-172C554.153,-185.83 535.221,-171.629 465,-172"/>
</g>
<!-- sourcefile~self_data.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node3" class="node"><title>sourcefile~self_data.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/self_data.f90.html" xlink:title="SELF_Data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="241.5,-106 152.5,-106 152.5,-82 241.5,-82 241.5,-106"/>
<text text-anchor="middle" x="197" y="-91.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_Data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_tests.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge7" class="edge"><title>sourcefile~self_tests.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M736.905,-52.4503C705.634,-51.7298 662.699,-51.5057 625,-54"/>
</g>
<!-- sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node5" class="node"><title>sourcefile~self_mesh.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/self_mesh.f90.html" xlink:title="SELF_Mesh.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="369.5,-106 278.5,-106 278.5,-82 369.5,-82 369.5,-106"/>
<text text-anchor="middle" x="324" y="-91.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_Mesh.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_tests.f90&#45;&gt;sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge13" class="edge"><title>sourcefile~self_tests.f90&#45;&gt;sourcefile~self_mesh.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M773.265,-66.0091C759.218,-86.8508 727.478,-129.715 690,-153 664.435,-168.884 654.508,-166.072 625,-172"/>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M623,-172C593.492,-177.928 583.286,-169.325 558,-153 537.345,-139.665 542.402,-124.718 522,-111 499.84,-96.0996 491.526,-95.0734 465,-92"/>
</g>
<!-- sourcefile~self_mappeddata.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node6" class="node"><title>sourcefile~self_mappeddata.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/self_mappeddata.f90.html" xlink:title="SELF_MappedData.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="690,-144 558,-144 558,-120 690,-120 690,-144"/>
<text text-anchor="middle" x="624" y="-129.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_MappedData.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_tests.f90&#45;&gt;sourcefile~self_mappeddata.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge17" class="edge"><title>sourcefile~self_tests.f90&#45;&gt;sourcefile~self_mappeddata.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M761.543,-66.1689C743.401,-77.2607 715.398,-93.7367 690,-106 682.766,-109.493 674.935,-112.915 667.297,-116.071"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="665.748,-112.921 657.785,-119.91 668.368,-119.413 665.748,-112.921"/>
</g>
<!-- sourcefile~self_data.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~self_data.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M152.276,-100.383C143.855,-101.612 134.857,-102.926 125.896,-104.234"/>
<polygon fill="#ff0000" stroke="#ff0000" points="125.216,-100.796 115.827,-105.704 126.227,-107.723 125.216,-100.796"/>
</g>
<!-- sourcefile~self_geometry.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node4" class="node"><title>sourcefile~self_geometry.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/self_geometry.f90.html" xlink:title="SELF_Geometry.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="521.5,-144 406.5,-144 406.5,-120 521.5,-120 521.5,-144"/>
<text text-anchor="middle" x="464" y="-129.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_Geometry.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M323,-134C267.584,-130.061 253.424,-137.821 198,-134"/>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge8" class="edge"><title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M406.204,-135.003C381.263,-135.759 351.649,-135.894 325,-134"/>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M323,-134C291.499,-131.761 257.467,-120.221 232.878,-110.108"/>
<polygon fill="#cbff00" stroke="#cbff00" points="234.187,-106.862 223.614,-106.182 231.455,-113.307 234.187,-106.862"/>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge14" class="edge"><title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_mesh.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M419.336,-119.977C406.373,-116.407 392.026,-112.456 378.513,-108.736"/>
<polygon fill="#0066ff" stroke="#0066ff" points="379.424,-105.356 368.854,-106.076 377.566,-112.105 379.424,-105.356"/>
</g>
<!-- sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge4" class="edge"><title>sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M301.945,-106.091C277.589,-118.797 235.962,-136.617 198,-134"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M196,-134C173.021,-132.416 148.05,-129.216 125.797,-125.831"/>
<polygon fill="#ff0000" stroke="#ff0000" points="126.201,-122.352 115.781,-124.268 125.122,-129.268 126.201,-122.352"/>
</g>
<!-- sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge10" class="edge"><title>sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M278.225,-94C269.666,-94 260.622,-94 251.814,-94"/>
<polygon fill="#cbff00" stroke="#cbff00" points="251.624,-90.5001 241.624,-94 251.624,-97.5001 251.624,-90.5001"/>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge5" class="edge"><title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M590.281,-144.081C558.719,-154.82 509.339,-169.24 465,-172"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M463,-172C380.249,-177.152 359.966,-160.483 278,-148 242.316,-142.566 234.01,-136.482 198,-134"/>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge11" class="edge"><title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M607.565,-119.865C580.545,-99.7096 522.101,-60.8587 465,-54"/>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_geometry.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge12" class="edge"><title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_geometry.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M557.823,-132C549.362,-132 540.683,-132 532.191,-132"/>
<polygon fill="#00ff66" stroke="#00ff66" points="531.951,-128.5 521.951,-132 531.951,-135.5 531.951,-128.5"/>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge16" class="edge"><title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_mesh.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M586.798,-119.912C555.101,-110.037 507.583,-96.9338 465,-92"/>
</g>
<!-- sourcefile~self_mpilayer.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node7" class="node"><title>sourcefile~self_mpilayer.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/self_mpilayer.f90.html" xlink:title="SELF_MPILayer.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="837.5,-24 726.5,-24 726.5,-0 837.5,-0 837.5,-24"/>
<text text-anchor="middle" x="782" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF_MPILayer.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge9" class="edge"><title>sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M750.532,-24.0391C719.521,-35.3717 669.778,-51.0372 625,-54"/>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M623,-54C552.931,-58.6361 534.721,-62.3747 465,-54"/>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M463,-54C386.401,-44.7992 297.855,-64.2983 244.974,-79.179"/>
<polygon fill="#cbff00" stroke="#cbff00" points="243.849,-75.8607 235.207,-81.9897 245.784,-82.5877 243.849,-75.8607"/>
</g>
<!-- sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge15" class="edge"><title>sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_mesh.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M743.319,-24.028C737.322,-26.6013 731.342,-29.5909 726,-33 707.189,-45.0049 710.201,-58.5194 690,-68 598.96,-110.725 564.899,-103.574 465,-92"/>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M463,-92C435.676,-89.052 405.135,-89.1471 379.744,-90.1503"/>
<polygon fill="#0066ff" stroke="#0066ff" points="379.396,-86.6623 369.564,-90.611 379.712,-93.6552 379.396,-86.6623"/>
</g>
<!-- sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_mappeddata.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge18" class="edge"><title>sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_mappeddata.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M739.093,-24.0797C734.355,-26.5454 729.854,-29.4902 726,-33 699.254,-57.3574 716.553,-81.4324 690,-106 686.195,-109.521 681.853,-112.59 677.259,-115.261"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="675.485,-112.237 668.188,-119.919 678.683,-118.464 675.485,-112.237"/>
</g>
<!-- sourcefile~self.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_node8" class="node"><title>sourcefile~self.f90</title>
<g id="a_sourcefile~~self_lagrange.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/self.f90.html" xlink:title="SELF.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="931.5,-66 874.5,-66 874.5,-42 931.5,-42 931.5,-66"/>
<text text-anchor="middle" x="903" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">SELF.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self.f90&#45;&gt;sourcefile~self_tests.f90 -->
<g id="sourcefile~~self_lagrange.f90~~AfferentGraph_edge6" class="edge"><title>sourcefile~self.f90&#45;&gt;sourcefile~self_tests.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M874.4,-54C863.348,-54 850.211,-54 837.393,-54"/>
<polygon fill="#ff0000" stroke="#ff0000" points="837.227,-50.5001 827.227,-54 837.227,-57.5001 837.227,-50.5001"/>
</g>
</g>
</svg>
</div><script>var pansourcefileself_lagrangef90AfferentGraph = svgPanZoom('#sourcefileself_lagrangef90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.30.1 (20201013.1554)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="201pt" height="32pt"
 viewBox="0.00 0.00 201.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-28 198,-28 198,5 -4,5"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="70.25,-24 -0.25,-24 -0.25,-0 70.25,-0 70.25,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193,-24 89,-24 89,-0 193,-0 193,-24"/>
<text text-anchor="middle" x="141" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/self_lagrange.html">SELF_Lagrange</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/self_lagrange.f90.html#src">SELF_Lagrange.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! SELF_Lagrange.f90</span>
<a name="ln-2"></a><span class="c">!</span>
<a name="ln-3"></a><span class="c">! Copyright 2017-2021 Fluid Numerics LLC</span>
<a name="ln-4"></a><span class="c">! Author : Joseph Schoonover (joe@fluidnumerics.com)</span>
<a name="ln-5"></a><span class="c">! Support : support@fluidnumerics.com</span>
<a name="ln-6"></a><span class="c">!</span>
<a name="ln-7"></a><span class="c">! //////////////////////////////////////////////////////////////////////////////////////////////// !</span>
<a name="ln-8"></a>
<a name="ln-9"></a><span class="k">MODULE </span><span class="n">SELF_Lagrange</span>
<a name="ln-10"></a>
<a name="ln-11"></a>  <span class="k">USE </span><span class="n">ISO_FORTRAN_ENV</span>
<a name="ln-12"></a>  <span class="k">USE </span><span class="n">SELF_Constants</span>
<a name="ln-13"></a>  <span class="k">USE </span><span class="n">SELF_Memory</span>
<a name="ln-14"></a>  <span class="k">USE </span><span class="n">SELF_SupportRoutines</span>
<a name="ln-15"></a>  <span class="k">USE </span><span class="n">SELF_Quadrature</span>
<a name="ln-16"></a>
<a name="ln-17"></a><span class="cp">#ifdef GPU</span>
<a name="ln-18"></a>  <span class="k">USE </span><span class="n">hipfort</span>
<a name="ln-19"></a>  <span class="k">USE </span><span class="n">hipfort_check</span>
<a name="ln-20"></a><span class="cp">#endif</span>
<a name="ln-21"></a>  <span class="k">USE </span><span class="nb">ISO_C_BINDING</span>
<a name="ln-22"></a><span class="nb">  </span><span class="k">IMPLICIT NONE</span>
<a name="ln-23"></a>
<a name="ln-24"></a>
<a name="ln-25"></a><span class="k">  TYPE</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Lagrange</span>
<a name="ln-26"></a>    <span class="c">!! A data structure for working with Lagrange Interpolating Polynomials in one, two, and three dimensions.</span>
<a name="ln-27"></a>    <span class="c">!! The Lagrange data-structure stores the information necessary to interpolate between two</span>
<a name="ln-28"></a>    <span class="c">!! sets of grid-points and to estimate the derivative of data at native grid points. Routines for</span>
<a name="ln-29"></a>    <span class="c">!! multidimensional interpolation are based on the tensor product of 1-D interpolants. It is</span>
<a name="ln-30"></a>    <span class="c">!! assumed that the polynomial degree (and the interpolation nodes) are the same in each direction.</span>
<a name="ln-31"></a>    <span class="c">!! This assumption permits the storage of only one array of interpolation nodes and barycentric</span>
<a name="ln-32"></a>    <span class="c">!! weights and is what allows this data structure to be flexible.</span>
<a name="ln-33"></a>
<a name="ln-34"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">N</span>
<a name="ln-35"></a>      <span class="c">!! The number of control points.</span>
<a name="ln-36"></a>
<a name="ln-37"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">M</span>
<a name="ln-38"></a>      <span class="c">!! The number of target points.</span>
<a name="ln-39"></a>
<a name="ln-40"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">controlPoints</span>
<a name="ln-41"></a>      <span class="c">!! The set of nodes in one dimension where data is known. </span>
<a name="ln-42"></a>      <span class="c">!! To create higher dimension interpolation and differentiation operators, structured grids in two and three</span>
<a name="ln-43"></a>      <span class="c">!! dimensions are created by tensor products of the controlPoints. This design decision implies that all </span>
<a name="ln-44"></a>      <span class="c">!! spectral element methods supported by the Lagrange class have the same polynomial degree in each </span>
<a name="ln-45"></a>      <span class="c">!! computational/spatial dimension. In practice, the controlPoints are the Legendre-Gauss, Legendre-Gauss-Lobatto,</span>
<a name="ln-46"></a>      <span class="c">!! Legendre-Gauss-Radau, Chebyshev-Gauss, Chebyshev-Gauss-Lobatto, or Chebyshev-Gauss-Radau quadrature points over </span>
<a name="ln-47"></a>      <span class="c">!! the domain [-1,1] (computational space). The Init routine for this class restricts controlPoints to one of </span>
<a name="ln-48"></a>      <span class="c">!! these quadrature types or uniform points on [-1,1].</span>
<a name="ln-49"></a>
<a name="ln-50"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">targetPoints</span>
<a name="ln-51"></a>      <span class="c">!! The set of nodes in one dimension where data is to be interpolated to. To create higher dimension interpolation </span>
<a name="ln-52"></a>      <span class="c">!! and differentiation operators, structured grids in two and three dimensions are created by tensor products of </span>
<a name="ln-53"></a>      <span class="c">!! the targetPoints. In practice, the targetPoints are set to a uniformly distributed set of points between [-1,1]</span>
<a name="ln-54"></a>      <span class="c">!! (computational space) to allow for interpolation from unevenly spaced quadrature points to a plotting grid.</span>
<a name="ln-55"></a>
<a name="ln-56"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bWeights</span>
<a name="ln-57"></a>      <span class="c">!! The barycentric weights that are calculated from the controlPoints and used for interpolation.</span>
<a name="ln-58"></a>
<a name="ln-59"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qWeights</span>
<a name="ln-60"></a>      <span class="c">!! The quadrature weights for discrete integration. The quadradture weights depend on the type of controlPoints </span>
<a name="ln-61"></a>      <span class="c">!! provided; one of Legendre-Gauss, Legendre-Gauss-Lobatto, Legendre-Gauss-Radau, Chebyshev-Gauss, </span>
<a name="ln-62"></a>      <span class="c">!! Chebyshev-Gauss-Lobatto, Chebyshev-Gauss Radau, or Uniform. If Uniform, the quadrature weights are constant</span>
<a name="ln-63"></a>      <span class="c">!! $$dx = \frac{2.0}{N+1}$$.</span>
<a name="ln-64"></a>
<a name="ln-65"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrix</span>
<a name="ln-66"></a>      <span class="c">!! The interpolation matrix (transpose) for mapping data from the control grid to the target grid.</span>
<a name="ln-67"></a>
<a name="ln-68"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrix</span>
<a name="ln-69"></a>      <span class="c">!! The derivative matrix for mapping function nodal values to a nodal values of the derivative estimate. The </span>
<a name="ln-70"></a>      <span class="c">!! dMatrix is based on a strong form of the derivative.</span>
<a name="ln-71"></a>
<a name="ln-72"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgMatrix</span>
<a name="ln-73"></a>      <span class="c">!! The derivative matrix for mapping function nodal values to a nodal values of the derivative estimate. The dgMatrix is based</span>
<a name="ln-74"></a>      <span class="c">!! on a weak form of the derivative. It must be used with bMatrix to account for boundary contributions in the weak form. </span>
<a name="ln-75"></a>
<a name="ln-76"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">hfReal_r2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix</span>
<a name="ln-77"></a>      <span class="c">!! The boundary interpolation matrix that is used to map a grid of nodal values at the control points to the element boundaries.</span>
<a name="ln-78"></a>
<a name="ln-79"></a>  <span class="k">CONTAINS</span>
<a name="ln-80"></a>
<a name="ln-81"></a><span class="k">    PROCEDURE</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Init</span> <span class="o">=&gt;</span> <span class="n">Init_Lagrange</span>
<a name="ln-82"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Free</span> <span class="o">=&gt;</span> <span class="n">Free_Lagrange</span>
<a name="ln-83"></a>
<a name="ln-84"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">UpdateDevice</span> <span class="o">=&gt;</span> <span class="n">UpdateDevice_Lagrange</span>
<a name="ln-85"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">UpdateHost</span> <span class="o">=&gt;</span> <span class="n">UpdateHost_Lagrange</span>
<a name="ln-86"></a>
<a name="ln-87"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarGridInterp_1D</span> <span class="o">=&gt;</span> <span class="n">ScalarGridInterp_1D_cpu</span><span class="p">,</span><span class="n">ScalarGridInterp_1D_gpu</span>
<a name="ln-88"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarGridInterp_1D_cpu</span><span class="p">,</span><span class="n">ScalarGridInterp_1D_gpu</span>
<a name="ln-89"></a>
<a name="ln-90"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarGridInterp_2D</span> <span class="o">=&gt;</span> <span class="n">ScalarGridInterp_2D_cpu</span><span class="p">,</span><span class="n">ScalarGridInterp_2D_gpu</span>
<a name="ln-91"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarGridInterp_2D_cpu</span><span class="p">,</span><span class="n">ScalarGridInterp_2D_gpu</span>
<a name="ln-92"></a>
<a name="ln-93"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorGridInterp_2D</span> <span class="o">=&gt;</span> <span class="n">VectorGridInterp_2D_cpu</span><span class="p">,</span><span class="n">VectorGridInterp_2D_gpu</span>
<a name="ln-94"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorGridInterp_2D_cpu</span><span class="p">,</span><span class="n">VectorGridInterp_2D_gpu</span>
<a name="ln-95"></a>
<a name="ln-96"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorGridInterp_2D</span> <span class="o">=&gt;</span> <span class="n">TensorGridInterp_2D_cpu</span><span class="p">,</span><span class="n">TensorGridInterp_2D_gpu</span>
<a name="ln-97"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorGridInterp_2D_cpu</span><span class="p">,</span><span class="n">TensorGridInterp_2D_gpu</span>
<a name="ln-98"></a>
<a name="ln-99"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarGridInterp_3D</span> <span class="o">=&gt;</span> <span class="n">ScalarGridInterp_3D_cpu</span><span class="p">,</span><span class="n">ScalarGridInterp_3D_gpu</span>
<a name="ln-100"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarGridInterp_3D_cpu</span><span class="p">,</span><span class="n">ScalarGridInterp_3D_gpu</span>
<a name="ln-101"></a>
<a name="ln-102"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorGridInterp_3D</span> <span class="o">=&gt;</span> <span class="n">VectorGridInterp_3D_cpu</span><span class="p">,</span><span class="n">VectorGridInterp_3D_gpu</span>
<a name="ln-103"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorGridInterp_3D_cpu</span><span class="p">,</span><span class="n">VectorGridInterp_3D_gpu</span>
<a name="ln-104"></a>
<a name="ln-105"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorGridInterp_3D</span> <span class="o">=&gt;</span> <span class="n">TensorGridInterp_3D_cpu</span><span class="p">,</span><span class="n">TensorGridInterp_3D_gpu</span>
<a name="ln-106"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorGridInterp_3D_cpu</span><span class="p">,</span><span class="n">TensorGridInterp_3D_gpu</span>
<a name="ln-107"></a>
<a name="ln-108"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarBoundaryInterp_1D</span> <span class="o">=&gt;</span> <span class="n">ScalarBoundaryInterp_1D_cpu</span><span class="p">,</span><span class="n">ScalarBoundaryInterp_1D_gpu</span>
<a name="ln-109"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarBoundaryInterp_1D_cpu</span><span class="p">,</span><span class="n">ScalarBoundaryInterp_1D_gpu</span>
<a name="ln-110"></a>
<a name="ln-111"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarBoundaryInterp_2D</span> <span class="o">=&gt;</span> <span class="n">ScalarBoundaryInterp_2D_cpu</span><span class="p">,</span><span class="n">ScalarBoundaryInterp_2D_gpu</span>
<a name="ln-112"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarBoundaryInterp_2D_cpu</span><span class="p">,</span><span class="n">ScalarBoundaryInterp_2D_gpu</span>
<a name="ln-113"></a>
<a name="ln-114"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorBoundaryInterp_2D</span> <span class="o">=&gt;</span> <span class="n">VectorBoundaryInterp_2D_cpu</span><span class="p">,</span><span class="n">VectorBoundaryInterp_2D_gpu</span>
<a name="ln-115"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorBoundaryInterp_2D_cpu</span><span class="p">,</span><span class="n">VectorBoundaryInterp_2D_gpu</span>
<a name="ln-116"></a>
<a name="ln-117"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorBoundaryInterp_2D</span> <span class="o">=&gt;</span> <span class="n">TensorBoundaryInterp_2D_cpu</span><span class="p">,</span><span class="n">TensorBoundaryInterp_2D_gpu</span>
<a name="ln-118"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorBoundaryInterp_2D_cpu</span><span class="p">,</span><span class="n">TensorBoundaryInterp_2D_gpu</span>
<a name="ln-119"></a>
<a name="ln-120"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarBoundaryInterp_3D</span> <span class="o">=&gt;</span> <span class="n">ScalarBoundaryInterp_3D_cpu</span><span class="p">,</span><span class="n">ScalarBoundaryInterp_3D_gpu</span>
<a name="ln-121"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarBoundaryInterp_3D_cpu</span><span class="p">,</span><span class="n">ScalarBoundaryInterp_3D_gpu</span>
<a name="ln-122"></a>
<a name="ln-123"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorBoundaryInterp_3D</span> <span class="o">=&gt;</span> <span class="n">VectorBoundaryInterp_3D_cpu</span><span class="p">,</span><span class="n">VectorBoundaryInterp_3D_gpu</span>
<a name="ln-124"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorBoundaryInterp_3D_cpu</span><span class="p">,</span><span class="n">VectorBoundaryInterp_3D_gpu</span>
<a name="ln-125"></a>
<a name="ln-126"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorBoundaryInterp_3D</span> <span class="o">=&gt;</span> <span class="n">TensorBoundaryInterp_3D_cpu</span><span class="p">,</span><span class="n">TensorBoundaryInterp_3D_gpu</span>
<a name="ln-127"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorBoundaryInterp_3D_cpu</span><span class="p">,</span><span class="n">TensorBoundaryInterp_3D_gpu</span>
<a name="ln-128"></a>
<a name="ln-129"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Derivative_1D</span> <span class="o">=&gt;</span> <span class="n">Derivative_1D_cpu</span><span class="p">,</span><span class="n">Derivative_1D_gpu</span>
<a name="ln-130"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Derivative_1D_cpu</span><span class="p">,</span><span class="n">Derivative_1D_gpu</span>
<a name="ln-131"></a>
<a name="ln-132"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">DGDerivative_1D</span> <span class="o">=&gt;</span> <span class="n">DGDerivative_1D_cpu</span><span class="p">,</span><span class="n">DGDerivative_1D_gpu</span>
<a name="ln-133"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">DGDerivative_1D_cpu</span><span class="p">,</span><span class="n">DGDerivative_1D_gpu</span>
<a name="ln-134"></a>
<a name="ln-135"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarGradient_2D</span> <span class="o">=&gt;</span> <span class="n">ScalarGradient_2D_cpu</span><span class="p">,</span><span class="n">ScalarGradient_2D_gpu</span>
<a name="ln-136"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarGradient_2D_cpu</span><span class="p">,</span><span class="n">ScalarGradient_2D_gpu</span>
<a name="ln-137"></a>
<a name="ln-138"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarDGGradient_2D</span> <span class="o">=&gt;</span> <span class="n">ScalarDGGradient_2D_cpu</span><span class="p">,</span><span class="n">ScalarDGGradient_2D_gpu</span>
<a name="ln-139"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarDGGradient_2D_cpu</span><span class="p">,</span><span class="n">ScalarDGGradient_2D_gpu</span>
<a name="ln-140"></a>
<a name="ln-141"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorGradient_2D</span> <span class="o">=&gt;</span> <span class="n">VectorGradient_2D_cpu</span><span class="p">,</span><span class="n">VectorGradient_2D_gpu</span>
<a name="ln-142"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorGradient_2D_cpu</span><span class="p">,</span><span class="n">VectorGradient_2D_gpu</span>
<a name="ln-143"></a>
<a name="ln-144"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorDGGradient_2D</span> <span class="o">=&gt;</span> <span class="n">VectorDGGradient_2D_cpu</span><span class="p">,</span><span class="n">VectorDGGradient_2D_gpu</span>
<a name="ln-145"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorDGGradient_2D_cpu</span><span class="p">,</span><span class="n">VectorDGGradient_2D_gpu</span>
<a name="ln-146"></a>
<a name="ln-147"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorDivergence_2D</span> <span class="o">=&gt;</span> <span class="n">VectorDivergence_2D_cpu</span><span class="p">,</span><span class="n">VectorDivergence_2D_gpu</span>
<a name="ln-148"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorDivergence_2D_cpu</span><span class="p">,</span><span class="n">VectorDivergence_2D_gpu</span>
<a name="ln-149"></a>
<a name="ln-150"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorDGDivergence_2D</span> <span class="o">=&gt;</span> <span class="n">VectorDGDivergence_2D_cpu</span><span class="p">,</span><span class="n">VectorDGDivergence_2D_gpu</span>
<a name="ln-151"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorDGDivergence_2D_cpu</span><span class="p">,</span><span class="n">VectorDGDivergence_2D_gpu</span>
<a name="ln-152"></a>
<a name="ln-153"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorCurl_2D</span> <span class="o">=&gt;</span> <span class="n">VectorCurl_2D_cpu</span><span class="p">,</span><span class="n">VectorCurl_2D_gpu</span>
<a name="ln-154"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorCurl_2D_cpu</span><span class="p">,</span><span class="n">VectorCurl_2D_gpu</span>
<a name="ln-155"></a>
<a name="ln-156"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorDivergence_2D</span> <span class="o">=&gt;</span> <span class="n">TensorDivergence_2D_cpu</span><span class="p">,</span><span class="n">TensorDivergence_2D_gpu</span>
<a name="ln-157"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorDivergence_2D_cpu</span><span class="p">,</span><span class="n">TensorDivergence_2D_gpu</span>
<a name="ln-158"></a>
<a name="ln-159"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorDGDivergence_2D</span> <span class="o">=&gt;</span> <span class="n">TensorDGDivergence_2D_cpu</span><span class="p">,</span><span class="n">TensorDGDivergence_2D_gpu</span>
<a name="ln-160"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorDGDivergence_2D_cpu</span><span class="p">,</span><span class="n">TensorDGDivergence_2D_gpu</span>
<a name="ln-161"></a>
<a name="ln-162"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">ScalarGradient_3D</span> <span class="o">=&gt;</span> <span class="n">ScalarGradient_3D_cpu</span><span class="p">,</span><span class="n">ScalarGradient_3D_gpu</span>
<a name="ln-163"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ScalarGradient_3D_cpu</span><span class="p">,</span><span class="n">ScalarGradient_3D_gpu</span>
<a name="ln-164"></a>
<a name="ln-165"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorGradient_3D</span> <span class="o">=&gt;</span> <span class="n">VectorGradient_3D_cpu</span><span class="p">,</span><span class="n">VectorGradient_3D_gpu</span>
<a name="ln-166"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorGradient_3D_cpu</span><span class="p">,</span><span class="n">VectorGradient_3D_gpu</span>
<a name="ln-167"></a>
<a name="ln-168"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorDivergence_3D</span> <span class="o">=&gt;</span> <span class="n">VectorDivergence_3D_cpu</span><span class="p">,</span><span class="n">VectorDivergence_3D_gpu</span>
<a name="ln-169"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorDivergence_3D_cpu</span><span class="p">,</span><span class="n">VectorDivergence_3D_gpu</span>
<a name="ln-170"></a>
<a name="ln-171"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorDGDivergence_3D</span> <span class="o">=&gt;</span> <span class="n">VectorDGDivergence_3D_cpu</span><span class="p">,</span><span class="n">VectorDGDivergence_3D_gpu</span>
<a name="ln-172"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorDGDivergence_3D_cpu</span><span class="p">,</span><span class="n">VectorDGDivergence_3D_gpu</span>
<a name="ln-173"></a>
<a name="ln-174"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">VectorCurl_3D</span> <span class="o">=&gt;</span> <span class="n">VectorCurl_3D_cpu</span><span class="p">,</span><span class="n">VectorCurl_3D_gpu</span>
<a name="ln-175"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">VectorCurl_3D_cpu</span><span class="p">,</span><span class="n">VectorCurl_3D_gpu</span>
<a name="ln-176"></a>
<a name="ln-177"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorDivergence_3D</span> <span class="o">=&gt;</span> <span class="n">TensorDivergence_3D_cpu</span><span class="p">,</span><span class="n">TensorDivergence_3D_gpu</span>
<a name="ln-178"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorDivergence_3D_cpu</span><span class="p">,</span><span class="n">TensorDivergence_3D_gpu</span>
<a name="ln-179"></a>
<a name="ln-180"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">TensorDGDivergence_3D</span> <span class="o">=&gt;</span> <span class="n">TensorDGDivergence_3D_cpu</span><span class="p">,</span><span class="n">TensorDGDivergence_3D_gpu</span>
<a name="ln-181"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">TensorDGDivergence_3D_cpu</span><span class="p">,</span><span class="n">TensorDGDivergence_3D_gpu</span>
<a name="ln-182"></a>
<a name="ln-183"></a>
<a name="ln-184"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">CalculateBarycentricWeights</span>
<a name="ln-185"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">CalculateInterpolationMatrix</span>
<a name="ln-186"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">CalculateDerivativeMatrix</span>
<a name="ln-187"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">CalculateLagrangePolynomials</span>
<a name="ln-188"></a>
<a name="ln-189"></a>  <span class="k">END TYPE </span><span class="n">Lagrange</span>
<a name="ln-190"></a>
<a name="ln-191"></a><span class="cp">#ifdef GPU</span>
<a name="ln-192"></a>  <span class="k">INTERFACE</span>
<a name="ln-193"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarGridInterp_1D_gpu_wrapper</span><span class="p">(</span><span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-194"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarGridInterp_1D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-195"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-196"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-197"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span>
<a name="ln-198"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-199"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarGridInterp_1D_gpu_wrapper</span>
<a name="ln-200"></a>  <span class="k">END INTERFACE</span>
<a name="ln-201"></a>
<a name="ln-202"></a><span class="k">  INTERFACE</span>
<a name="ln-203"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarGridInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-204"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarGridInterp_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-205"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-206"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-207"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span>
<a name="ln-208"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-209"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarGridInterp_2D_gpu_wrapper</span>
<a name="ln-210"></a>  <span class="k">END INTERFACE</span>
<a name="ln-211"></a>
<a name="ln-212"></a><span class="k">  INTERFACE</span>
<a name="ln-213"></a><span class="k">    SUBROUTINE </span><span class="n">VectorGridInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-214"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorGridInterp_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-215"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-216"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-217"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span>
<a name="ln-218"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-219"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorGridInterp_2D_gpu_wrapper</span>
<a name="ln-220"></a>  <span class="k">END INTERFACE</span>
<a name="ln-221"></a>
<a name="ln-222"></a><span class="k">  INTERFACE</span>
<a name="ln-223"></a><span class="k">    SUBROUTINE </span><span class="n">TensorGridInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-224"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorGridInterp_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-225"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-226"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-227"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span>
<a name="ln-228"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-229"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorGridInterp_2D_gpu_wrapper</span>
<a name="ln-230"></a>  <span class="k">END INTERFACE</span>
<a name="ln-231"></a>
<a name="ln-232"></a><span class="k">  INTERFACE</span>
<a name="ln-233"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarGridInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-234"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarGridInterp_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-235"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-236"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-237"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span>
<a name="ln-238"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-239"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarGridInterp_3D_gpu_wrapper</span>
<a name="ln-240"></a>  <span class="k">END INTERFACE</span>
<a name="ln-241"></a>
<a name="ln-242"></a><span class="k">  INTERFACE</span>
<a name="ln-243"></a><span class="k">    SUBROUTINE </span><span class="n">VectorGridInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-244"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorGridInterp_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-245"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-246"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-247"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span>
<a name="ln-248"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-249"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorGridInterp_3D_gpu_wrapper</span>
<a name="ln-250"></a>  <span class="k">END INTERFACE</span>
<a name="ln-251"></a>
<a name="ln-252"></a><span class="k">  INTERFACE</span>
<a name="ln-253"></a><span class="k">    SUBROUTINE </span><span class="n">TensorGridInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-254"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorGridInterp_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-255"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-256"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-257"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span>
<a name="ln-258"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-259"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorGridInterp_3D_gpu_wrapper</span>
<a name="ln-260"></a>  <span class="k">END INTERFACE</span>
<a name="ln-261"></a>
<a name="ln-262"></a>  <span class="c">! /////////////// !</span>
<a name="ln-263"></a>  <span class="c">! Boundary Interpolation Routines</span>
<a name="ln-264"></a>
<a name="ln-265"></a>  <span class="k">INTERFACE</span>
<a name="ln-266"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarBoundaryInterp_1D_gpu_wrapper</span><span class="p">(</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-267"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarBoundaryInterp_1D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-268"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-269"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-270"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span>
<a name="ln-271"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-272"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_1D_gpu_wrapper</span>
<a name="ln-273"></a>  <span class="k">END INTERFACE</span>
<a name="ln-274"></a>
<a name="ln-275"></a><span class="k">  INTERFACE</span>
<a name="ln-276"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarBoundaryInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-277"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarBoundaryInterp_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-278"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-279"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-280"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span>
<a name="ln-281"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-282"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_2D_gpu_wrapper</span>
<a name="ln-283"></a>  <span class="k">END INTERFACE</span>
<a name="ln-284"></a>
<a name="ln-285"></a><span class="k">  INTERFACE</span>
<a name="ln-286"></a><span class="k">    SUBROUTINE </span><span class="n">VectorBoundaryInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-287"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorBoundaryInterp_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-288"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-289"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-290"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span>
<a name="ln-291"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-292"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorBoundaryInterp_2D_gpu_wrapper</span>
<a name="ln-293"></a>  <span class="k">END INTERFACE</span>
<a name="ln-294"></a>
<a name="ln-295"></a><span class="k">  INTERFACE</span>
<a name="ln-296"></a><span class="k">    SUBROUTINE </span><span class="n">TensorBoundaryInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-297"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorBoundaryInterp_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-298"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-299"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-300"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span>
<a name="ln-301"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-302"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorBoundaryInterp_2D_gpu_wrapper</span>
<a name="ln-303"></a>  <span class="k">END INTERFACE</span>
<a name="ln-304"></a>
<a name="ln-305"></a><span class="k">  INTERFACE</span>
<a name="ln-306"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarBoundaryInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-307"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarBoundaryInterp_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-308"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-309"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-310"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span>
<a name="ln-311"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-312"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_3D_gpu_wrapper</span>
<a name="ln-313"></a>  <span class="k">END INTERFACE</span>
<a name="ln-314"></a>
<a name="ln-315"></a><span class="k">  INTERFACE</span>
<a name="ln-316"></a><span class="k">    SUBROUTINE </span><span class="n">VectorBoundaryInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-317"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorBoundaryInterp_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-318"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-319"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-320"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span>
<a name="ln-321"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-322"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorBoundaryInterp_3D_gpu_wrapper</span>
<a name="ln-323"></a>  <span class="k">END INTERFACE</span>
<a name="ln-324"></a>
<a name="ln-325"></a><span class="k">  INTERFACE</span>
<a name="ln-326"></a><span class="k">    SUBROUTINE </span><span class="n">TensorBoundaryInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-327"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorBoundaryInterp_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-328"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-329"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-330"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fBound_dev</span>
<a name="ln-331"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-332"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorBoundaryInterp_3D_gpu_wrapper</span>
<a name="ln-333"></a>  <span class="k">END INTERFACE</span>
<a name="ln-334"></a>
<a name="ln-335"></a>  <span class="c">! /////////////// !</span>
<a name="ln-336"></a>
<a name="ln-337"></a>  <span class="k">INTERFACE</span>
<a name="ln-338"></a><span class="k">    SUBROUTINE </span><span class="n">Derivative_1D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-339"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Derivative_1D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-340"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-341"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-342"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-343"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-344"></a>    <span class="k">END SUBROUTINE </span><span class="n">Derivative_1D_gpu_wrapper</span>
<a name="ln-345"></a>  <span class="k">END INTERFACE</span>
<a name="ln-346"></a>
<a name="ln-347"></a><span class="k">  INTERFACE</span>
<a name="ln-348"></a><span class="k">    SUBROUTINE </span><span class="n">DGDerivative_1D_gpu_wrapper</span><span class="p">(</span><span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-349"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;DGDerivative_1D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-350"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-351"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-352"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-353"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-354"></a>    <span class="k">END SUBROUTINE </span><span class="n">DGDerivative_1D_gpu_wrapper</span>
<a name="ln-355"></a>  <span class="k">END INTERFACE</span>
<a name="ln-356"></a>
<a name="ln-357"></a><span class="k">  INTERFACE</span>
<a name="ln-358"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-359"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarGradient_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-360"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-361"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-362"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-363"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-364"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarGradient_2D_gpu_wrapper</span>
<a name="ln-365"></a>  <span class="k">END INTERFACE</span>
<a name="ln-366"></a>
<a name="ln-367"></a><span class="k">  INTERFACE</span>
<a name="ln-368"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarDGGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-369"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarDGGradient_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-370"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-371"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-372"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-373"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-374"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarDGGradient_2D_gpu_wrapper</span>
<a name="ln-375"></a>  <span class="k">END INTERFACE</span>
<a name="ln-376"></a>
<a name="ln-377"></a><span class="k">  INTERFACE</span>
<a name="ln-378"></a><span class="k">    SUBROUTINE </span><span class="n">VectorGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-379"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorGradient_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-380"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-381"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-382"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-383"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-384"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorGradient_2D_gpu_wrapper</span>
<a name="ln-385"></a>  <span class="k">END INTERFACE</span>
<a name="ln-386"></a>
<a name="ln-387"></a><span class="k">  INTERFACE</span>
<a name="ln-388"></a><span class="k">    SUBROUTINE </span><span class="n">VectorDGGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-389"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorDGGradient_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-390"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-391"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-392"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-393"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-394"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorDGGradient_2D_gpu_wrapper</span>
<a name="ln-395"></a>  <span class="k">END INTERFACE</span>
<a name="ln-396"></a>
<a name="ln-397"></a><span class="k">  INTERFACE</span>
<a name="ln-398"></a><span class="k">    SUBROUTINE </span><span class="n">VectorDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-399"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorDivergence_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-400"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-401"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-402"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-403"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-404"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorDivergence_2D_gpu_wrapper</span>
<a name="ln-405"></a>  <span class="k">END INTERFACE</span>
<a name="ln-406"></a>
<a name="ln-407"></a><span class="k">  INTERFACE</span>
<a name="ln-408"></a><span class="k">    SUBROUTINE </span><span class="n">VectorDGDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-409"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorDGDivergence_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-410"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-411"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-412"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-413"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-414"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorDGDivergence_2D_gpu_wrapper</span>
<a name="ln-415"></a>  <span class="k">END INTERFACE</span>
<a name="ln-416"></a>
<a name="ln-417"></a><span class="k">  INTERFACE</span>
<a name="ln-418"></a><span class="k">    SUBROUTINE </span><span class="n">VectorCurl_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-419"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorCurl_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-420"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-421"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-422"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-423"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-424"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorCurl_2D_gpu_wrapper</span>
<a name="ln-425"></a>  <span class="k">END INTERFACE</span>
<a name="ln-426"></a>
<a name="ln-427"></a><span class="k">  INTERFACE</span>
<a name="ln-428"></a><span class="k">    SUBROUTINE </span><span class="n">TensorDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-429"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorDivergence_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-430"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-431"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-432"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-433"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-434"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorDivergence_2D_gpu_wrapper</span>
<a name="ln-435"></a>  <span class="k">END INTERFACE</span>
<a name="ln-436"></a>
<a name="ln-437"></a><span class="k">  INTERFACE</span>
<a name="ln-438"></a><span class="k">    SUBROUTINE </span><span class="n">TensorDGDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-439"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorDGDivergence_2D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-440"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-441"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-442"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-443"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-444"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorDGDivergence_2D_gpu_wrapper</span>
<a name="ln-445"></a>  <span class="k">END INTERFACE</span>
<a name="ln-446"></a>
<a name="ln-447"></a><span class="k">  INTERFACE</span>
<a name="ln-448"></a><span class="k">    SUBROUTINE </span><span class="n">ScalarGradient_3D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-449"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ScalarGradient_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-450"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-451"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-452"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-453"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-454"></a>    <span class="k">END SUBROUTINE </span><span class="n">ScalarGradient_3D_gpu_wrapper</span>
<a name="ln-455"></a>  <span class="k">END INTERFACE</span>
<a name="ln-456"></a>
<a name="ln-457"></a><span class="k">  INTERFACE</span>
<a name="ln-458"></a><span class="k">    SUBROUTINE </span><span class="n">VectorGradient_3D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-459"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorGradient_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-460"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-461"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-462"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-463"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-464"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorGradient_3D_gpu_wrapper</span>
<a name="ln-465"></a>  <span class="k">END INTERFACE</span>
<a name="ln-466"></a>
<a name="ln-467"></a><span class="k">  INTERFACE</span>
<a name="ln-468"></a><span class="k">    SUBROUTINE </span><span class="n">VectorDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-469"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorDivergence_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-470"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-471"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-472"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-473"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-474"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorDivergence_3D_gpu_wrapper</span>
<a name="ln-475"></a>  <span class="k">END INTERFACE</span>
<a name="ln-476"></a>
<a name="ln-477"></a><span class="k">  INTERFACE</span>
<a name="ln-478"></a><span class="k">    SUBROUTINE </span><span class="n">VectorDGDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-479"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorDGDivergence_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-480"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-481"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-482"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-483"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-484"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorDGDivergence_3D_gpu_wrapper</span>
<a name="ln-485"></a>  <span class="k">END INTERFACE</span>
<a name="ln-486"></a>
<a name="ln-487"></a><span class="k">  INTERFACE</span>
<a name="ln-488"></a><span class="k">    SUBROUTINE </span><span class="n">VectorCurl_3D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-489"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;VectorCurl_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-490"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-491"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-492"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-493"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-494"></a>    <span class="k">END SUBROUTINE </span><span class="n">VectorCurl_3D_gpu_wrapper</span>
<a name="ln-495"></a>  <span class="k">END INTERFACE</span>
<a name="ln-496"></a>
<a name="ln-497"></a><span class="k">  INTERFACE</span>
<a name="ln-498"></a><span class="k">    SUBROUTINE </span><span class="n">TensorDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-499"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorDivergence_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-500"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-501"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-502"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dMatrixT_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-503"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-504"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorDivergence_3D_gpu_wrapper</span>
<a name="ln-505"></a>  <span class="k">END INTERFACE</span>
<a name="ln-506"></a>
<a name="ln-507"></a><span class="k">  INTERFACE</span>
<a name="ln-508"></a><span class="k">    SUBROUTINE </span><span class="n">TensorDGDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-509"></a>      <span class="k">bind</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TensorDGDivergence_3D_gpu_wrapper&quot;</span><span class="p">)</span>
<a name="ln-510"></a>      <span class="k">USE </span><span class="nb">iso_c_binding</span>
<a name="ln-511"></a><span class="nb">      </span><span class="k">IMPLICIT NONE</span>
<a name="ln-512"></a><span class="k">      TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgMatrixT_dev</span><span class="p">,</span><span class="n">bMatrix_dev</span><span class="p">,</span><span class="n">qWeights_dev</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span>
<a name="ln-513"></a>      <span class="kt">INTEGER</span><span class="p">,</span><span class="k">VALUE</span> <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">nVar</span><span class="p">,</span><span class="n">nEl</span>
<a name="ln-514"></a>    <span class="k">END SUBROUTINE </span><span class="n">TensorDGDivergence_3D_gpu_wrapper</span>
<a name="ln-515"></a>  <span class="k">END INTERFACE</span>
<a name="ln-516"></a><span class="cp">#endif</span>
<a name="ln-517"></a>
<a name="ln-518"></a><span class="k">CONTAINS</span>
<a name="ln-519"></a>
<a name="ln-520"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-521"></a><span class="c">!</span>
<a name="ln-522"></a><span class="c">! Init_Lagrange</span>
<a name="ln-523"></a><span class="c">!</span>
<a name="ln-524"></a><span class="c">!   A manual constructor for the Lagrange class that allocates memory and fills in data</span>
<a name="ln-525"></a><span class="c">!   for the attributes of the Lagrange class.</span>
<a name="ln-526"></a><span class="c">!</span>
<a name="ln-527"></a><span class="c">!   The Init subroutine allocates memory for the interpolation and target points, barycentric</span>
<a name="ln-528"></a><span class="c">!   weights, interpolation matrix, and derivative matrix.</span>
<a name="ln-529"></a><span class="c">!</span>
<a name="ln-530"></a><span class="c">!   Usage :</span>
<a name="ln-531"></a><span class="c">!</span>
<a name="ln-532"></a><span class="c">!     TYPE(Lagrange) :: interp</span>
<a name="ln-533"></a><span class="c">!     INTEGER        :: N, M</span>
<a name="ln-534"></a><span class="c">!     REAL(prec)     :: interpNodes(0:N), targetNodes(0:M+1)</span>
<a name="ln-535"></a><span class="c">!</span>
<a name="ln-536"></a><span class="c">!     CALL interp % Init( N, M, interpNodes, targetNodes )</span>
<a name="ln-537"></a><span class="c">!</span>
<a name="ln-538"></a><span class="c">!   Input/Output :</span>
<a name="ln-539"></a><span class="c">!</span>
<a name="ln-540"></a><span class="c">!     myPoly  (out)</span>
<a name="ln-541"></a><span class="c">!       The Lagrange data structure to be constructed</span>
<a name="ln-542"></a><span class="c">!</span>
<a name="ln-543"></a><span class="c">!     N (in)</span>
<a name="ln-544"></a><span class="c">!       The degree of the polynomial interpolant</span>
<a name="ln-545"></a><span class="c">!</span>
<a name="ln-546"></a><span class="c">!     M (in)</span>
<a name="ln-547"></a><span class="c">!       M+1 is the number of target grid points. The upper bound of the targetNodes array</span>
<a name="ln-548"></a><span class="c">!</span>
<a name="ln-549"></a><span class="c">!     interpNodes(0:N) (in)</span>
<a name="ln-550"></a><span class="c">!       The interpolation nodes.</span>
<a name="ln-551"></a><span class="c">!</span>
<a name="ln-552"></a><span class="c">!     targetNodes(0:M) (in)</span>
<a name="ln-553"></a><span class="c">!       The target nodes. The iMatrix will map the a function at the interpolation</span>
<a name="ln-554"></a><span class="c">!       nodes onto the target nodes.</span>
<a name="ln-555"></a><span class="c">!</span>
<a name="ln-556"></a><span class="c">! =============================================================================================== !</span>
<a name="ln-557"></a>
<a name="ln-558"></a>  <span class="k">SUBROUTINE </span><span class="n">Init_Lagrange</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">controlNodeType</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">targetNodeType</span><span class="p">)</span>
<a name="ln-559"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-560"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-561"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">N</span><span class="p">,</span><span class="n">M</span>
<a name="ln-562"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">controlNodeType</span><span class="p">,</span><span class="n">targetNodeType</span>
<a name="ln-563"></a>    <span class="c">! Local</span>
<a name="ln-564"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">q</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">M</span><span class="p">)</span>
<a name="ln-565"></a>
<a name="ln-566"></a>    <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
<a name="ln-567"></a>    <span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span> <span class="o">=</span> <span class="n">M</span>
<a name="ln-568"></a>
<a name="ln-569"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-570"></a>                                        <span class="n">upBound</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
<a name="ln-571"></a>
<a name="ln-572"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">targetPoints</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-573"></a>                                       <span class="n">upBound</span><span class="o">=</span><span class="n">M</span><span class="p">)</span>
<a name="ln-574"></a>
<a name="ln-575"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-576"></a>                                   <span class="n">upBound</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
<a name="ln-577"></a>
<a name="ln-578"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-579"></a>                                   <span class="n">upBound</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
<a name="ln-580"></a>
<a name="ln-581"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-582"></a>                                  <span class="n">upBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="o">/</span><span class="p">))</span>
<a name="ln-583"></a>
<a name="ln-584"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-585"></a>                                  <span class="n">upBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="p">))</span>
<a name="ln-586"></a>
<a name="ln-587"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-588"></a>                                   <span class="n">upBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">/</span><span class="p">))</span>
<a name="ln-589"></a>
<a name="ln-590"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">Alloc</span><span class="p">(</span><span class="n">loBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="o">/</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-591"></a>                                  <span class="n">upBound</span><span class="o">=</span><span class="p">(</span><span class="o">/</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">))</span>
<a name="ln-592"></a>
<a name="ln-593"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">controlNodeType</span> <span class="o">==</span> <span class="n">GAUSS</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">controlNodeType</span> <span class="o">==</span> <span class="n">GAUSS_LOBATTO</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-594"></a>
<a name="ln-595"></a><span class="k">      CALL </span><span class="n">LegendreQuadrature</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-596"></a>                              <span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-597"></a>                              <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-598"></a>                              <span class="n">controlNodeType</span><span class="p">)</span>
<a name="ln-599"></a>
<a name="ln-600"></a>    <span class="n">ELSEIF</span> <span class="p">(</span><span class="n">controlNodeType</span> <span class="o">==</span> <span class="n">UNIFORM</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-601"></a>
<a name="ln-602"></a><span class="k">      </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">hostData</span> <span class="o">=</span> <span class="n">UniformPoints</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0_prec</span><span class="p">,</span><span class="mf">1.0_prec</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<a name="ln-603"></a>      <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span> <span class="o">=</span> <span class="mf">2.0_prec</span><span class="o">/</span><span class="kt">REAL</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">prec</span><span class="p">)</span>
<a name="ln-604"></a>
<a name="ln-605"></a>    <span class="k">END IF</span>
<a name="ln-606"></a>
<a name="ln-607"></a>    <span class="c">! Target Points</span>
<a name="ln-608"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">targetNodeType</span> <span class="o">==</span> <span class="n">GAUSS</span> <span class="p">.</span><span class="nb">OR</span><span class="p">.</span> <span class="n">targetNodeType</span> <span class="o">==</span> <span class="n">GAUSS_LOBATTO</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-609"></a>
<a name="ln-610"></a><span class="k">      CALL </span><span class="n">LegendreQuadrature</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-611"></a>                              <span class="n">myPoly</span> <span class="p">%</span> <span class="n">targetPoints</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-612"></a>                              <span class="n">q</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-613"></a>                              <span class="n">targetNodeType</span><span class="p">)</span>
<a name="ln-614"></a>
<a name="ln-615"></a>    <span class="n">ELSEIF</span> <span class="p">(</span><span class="n">targetNodeType</span> <span class="o">==</span> <span class="n">UNIFORM</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-616"></a>
<a name="ln-617"></a><span class="k">      </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">targetPoints</span> <span class="p">%</span> <span class="n">hostData</span> <span class="o">=</span> <span class="n">UniformPoints</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0_prec</span><span class="p">,</span><span class="mf">1.0_prec</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">M</span><span class="p">)</span>
<a name="ln-618"></a>
<a name="ln-619"></a>    <span class="k">END IF</span>
<a name="ln-620"></a>
<a name="ln-621"></a><span class="k">    CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">CalculateBarycentricWeights</span><span class="p">()</span>
<a name="ln-622"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">CalculateInterpolationMatrix</span><span class="p">()</span>
<a name="ln-623"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">CalculateDerivativeMatrix</span><span class="p">()</span>
<a name="ln-624"></a>    <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">CalculateLagrangePolynomials</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0_prec</span><span class="p">)</span>
<a name="ln-625"></a>    <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">CalculateLagrangePolynomials</span><span class="p">(</span><span class="mf">1.0_prec</span><span class="p">)</span>
<a name="ln-626"></a>
<a name="ln-627"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-628"></a>
<a name="ln-629"></a>  <span class="k">END SUBROUTINE </span><span class="n">Init_Lagrange</span>
<a name="ln-630"></a>
<a name="ln-631"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-632"></a><span class="c">!</span>
<a name="ln-633"></a><span class="c">! Free_Lagrange</span>
<a name="ln-634"></a><span class="c">!</span>
<a name="ln-635"></a><span class="c">!   A manual destructor for the Lagrange class that deallocates the memory held by its attributes.</span>
<a name="ln-636"></a><span class="c">!</span>
<a name="ln-637"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-638"></a>
<a name="ln-639"></a>  <span class="k">SUBROUTINE </span><span class="n">Free_Lagrange</span><span class="p">(</span><span class="n">myPoly</span><span class="p">)</span>
<a name="ln-640"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-641"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-642"></a>
<a name="ln-643"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-644"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">targetPoints</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-645"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-646"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-647"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-648"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-649"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-650"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">Free</span><span class="p">()</span>
<a name="ln-651"></a>
<a name="ln-652"></a>  <span class="k">END SUBROUTINE </span><span class="n">Free_Lagrange</span>
<a name="ln-653"></a>
<a name="ln-654"></a>  <span class="k">SUBROUTINE </span><span class="n">UpdateDevice_Lagrange</span><span class="p">(</span><span class="n">myPoly</span><span class="p">)</span>
<a name="ln-655"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-656"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-657"></a>
<a name="ln-658"></a><span class="cp">#ifdef GPU</span>
<a name="ln-659"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-660"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">targetPoints</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-661"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-662"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-663"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-664"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-665"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-666"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">UpdateDevice</span><span class="p">()</span>
<a name="ln-667"></a><span class="cp">#endif</span>
<a name="ln-668"></a>
<a name="ln-669"></a>  <span class="k">END SUBROUTINE </span><span class="n">UpdateDevice_Lagrange</span>
<a name="ln-670"></a>
<a name="ln-671"></a>  <span class="k">SUBROUTINE </span><span class="n">UpdateHost_Lagrange</span><span class="p">(</span><span class="n">myPoly</span><span class="p">)</span>
<a name="ln-672"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-673"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-674"></a>
<a name="ln-675"></a><span class="cp">#ifdef GPU</span>
<a name="ln-676"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-677"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">targetPoints</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-678"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-679"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-680"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-681"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-682"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-683"></a>    <span class="k">CALL </span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">UpdateHost</span><span class="p">()</span>
<a name="ln-684"></a><span class="cp">#endif</span>
<a name="ln-685"></a>
<a name="ln-686"></a>  <span class="k">END SUBROUTINE </span><span class="n">UpdateHost_Lagrange</span>
<a name="ln-687"></a>
<a name="ln-688"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-689"></a><span class="c">!</span>
<a name="ln-690"></a><span class="c">! ScalarGridInterp_1D</span>
<a name="ln-691"></a><span class="c">!</span>
<a name="ln-692"></a><span class="c">!   Interpolates an array of nodal values at the native nodes to nodal values at the target nodes.</span>
<a name="ln-693"></a><span class="c">!</span>
<a name="ln-694"></a><span class="c">!   We can write the operations of interpolating data from one set of points to another (in this</span>
<a name="ln-695"></a><span class="c">!   case from &quot;controlPoints&quot; to &quot;targetPoints&quot;) as</span>
<a name="ln-696"></a><span class="c">!</span>
<a name="ln-697"></a><span class="c">!              fnew_a = \sum_{i=0}^N f_i l_i(\xi_a),   a=0,1,2,...,M</span>
<a name="ln-698"></a><span class="c">!</span>
<a name="ln-699"></a><span class="c">!   where l_i(\xi) are the Lagrange interpolating polynomials through the interpolation points.</span>
<a name="ln-700"></a><span class="c">!   The interpolation matrix is T_{a,i} = l_i(\xi_a) maps an array of nodal values from the native</span>
<a name="ln-701"></a><span class="c">!   interpolation nodes to the target nodes. This routine serves as a wrapper to call either the CUDA</span>
<a name="ln-702"></a><span class="c">!   kernel (if CUDA is enabled) or the CPU version.</span>
<a name="ln-703"></a><span class="c">!</span>
<a name="ln-704"></a><span class="c">!   Usage :</span>
<a name="ln-705"></a><span class="c">!</span>
<a name="ln-706"></a><span class="c">!     TYPE(Lagrange) :: interp</span>
<a name="ln-707"></a><span class="c">!     INTEGER        :: nVariables, nElements</span>
<a name="ln-708"></a><span class="c">!     REAL(prec)     :: f(0:interp % N,1:nVariables,1:nElements)</span>
<a name="ln-709"></a><span class="c">!     REAL(prec)     :: fNew(0:interp % M,1:nVariables,1:nElements)</span>
<a name="ln-710"></a><span class="c">!</span>
<a name="ln-711"></a><span class="c">!       CALL interp % GridInterpolation_1D( fnative, fNew, nVariables, nElements )</span>
<a name="ln-712"></a><span class="c">!</span>
<a name="ln-713"></a><span class="c">!     * If CUDA is enabled, the fnative and ftarget arrays must be CUDA device variables.</span>
<a name="ln-714"></a><span class="c">!</span>
<a name="ln-715"></a><span class="c">!   Parameters :</span>
<a name="ln-716"></a><span class="c">!</span>
<a name="ln-717"></a><span class="c">!     interp (in)</span>
<a name="ln-718"></a><span class="c">!       A previously constructed Lagrange data-structure.</span>
<a name="ln-719"></a><span class="c">!</span>
<a name="ln-720"></a><span class="c">!     f (in)</span>
<a name="ln-721"></a><span class="c">!       Array of function nodal values at the native interpolation nodes.</span>
<a name="ln-722"></a><span class="c">!</span>
<a name="ln-723"></a><span class="c">!     nVariables (in)</span>
<a name="ln-724"></a><span class="c">!</span>
<a name="ln-725"></a><span class="c">!     nElements (in)</span>
<a name="ln-726"></a><span class="c">!</span>
<a name="ln-727"></a><span class="c">!     fNew (out)</span>
<a name="ln-728"></a><span class="c">!      Array of function nodal values at the target interpolation nodes.</span>
<a name="ln-729"></a><span class="c">!</span>
<a name="ln-730"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-731"></a>
<a name="ln-732"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGridInterp_1D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fInterp</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-733"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-734"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-735"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-736"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-737"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-738"></a>    <span class="c">! Local</span>
<a name="ln-739"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span>
<a name="ln-740"></a>
<a name="ln-741"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-742"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-743"></a>        <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-744"></a>          <span class="n">fInterp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-745"></a>          <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-746"></a>            <span class="n">fInterp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fInterp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-747"></a>          <span class="k">END DO</span>
<a name="ln-748"></a><span class="k">        END DO</span>
<a name="ln-749"></a><span class="k">      END DO</span>
<a name="ln-750"></a><span class="k">    END DO</span>
<a name="ln-751"></a>
<a name="ln-752"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarGridInterp_1D_cpu</span>
<a name="ln-753"></a>
<a name="ln-754"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGridInterp_1D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-755"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-756"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-757"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-758"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-759"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp_dev</span>
<a name="ln-760"></a>
<a name="ln-761"></a><span class="cp">#ifdef GPU</span>
<a name="ln-762"></a>    <span class="k">CALL </span><span class="n">ScalarGridInterp_1D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-763"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-764"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-765"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-766"></a><span class="cp">#endif</span>
<a name="ln-767"></a>
<a name="ln-768"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarGridInterp_1D_gpu</span>
<a name="ln-769"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-770"></a><span class="c">!</span>
<a name="ln-771"></a><span class="c">! ScalarGridInterp_2D</span>
<a name="ln-772"></a><span class="c">!</span>
<a name="ln-773"></a><span class="c">!   Interpolates an array of nodal values at the native nodes to nodal values at the target nodes.</span>
<a name="ln-774"></a><span class="c">!</span>
<a name="ln-775"></a><span class="c">!   We can write the operations of interpolating data from one set of points to another (in this</span>
<a name="ln-776"></a><span class="c">!   case from &quot;controlPoints&quot; to &quot;targetPoints&quot;) as</span>
<a name="ln-777"></a><span class="c">!</span>
<a name="ln-778"></a><span class="c">!              fnew_{a,b} = \sum_{i,j=0}^N f_{i,j} l_i(\xi_a) l_j(\xi_b),   a,b=0,1,2,...,M</span>
<a name="ln-779"></a><span class="c">!</span>
<a name="ln-780"></a><span class="c">!   where l_i(\xi) are the Lagrange interpolating polynomials through the interpolation points.</span>
<a name="ln-781"></a><span class="c">!   The interpolation matrix is T_{a,i} = l_i(\xi_a) maps an array of nodal values from the native</span>
<a name="ln-782"></a><span class="c">!   interpolation nodes to the target nodes. This routine serves as a wrapper to call either the CUDA</span>
<a name="ln-783"></a><span class="c">!   kernel (if CUDA is enabled) or the CPU version.</span>
<a name="ln-784"></a><span class="c">!</span>
<a name="ln-785"></a><span class="c">!   Usage :</span>
<a name="ln-786"></a><span class="c">!</span>
<a name="ln-787"></a><span class="c">!     TYPE(Lagrange) :: interp</span>
<a name="ln-788"></a><span class="c">!     INTEGER        :: nVariables, nElements</span>
<a name="ln-789"></a><span class="c">!     REAL(prec)     :: f(0:interp % N,0:interp % N,1:nVariables,1:nElements)</span>
<a name="ln-790"></a><span class="c">!     REAL(prec)     :: fNew(0:interp % M,0:interp % M,1:nVariables,1:nElements)</span>
<a name="ln-791"></a><span class="c">!</span>
<a name="ln-792"></a><span class="c">!       CALL interp % GridInterpolation_2D( fnative, fNew, nVariables, nElements )</span>
<a name="ln-793"></a><span class="c">!</span>
<a name="ln-794"></a><span class="c">!     * If CUDA is enabled, the fnative and ftarget arrays must be CUDA device variables.</span>
<a name="ln-795"></a><span class="c">!</span>
<a name="ln-796"></a><span class="c">!   Parameters :</span>
<a name="ln-797"></a><span class="c">!</span>
<a name="ln-798"></a><span class="c">!     interp (in)</span>
<a name="ln-799"></a><span class="c">!       A previously constructed Lagrange data-structure.</span>
<a name="ln-800"></a><span class="c">!</span>
<a name="ln-801"></a><span class="c">!     f (in)</span>
<a name="ln-802"></a><span class="c">!       Array of function nodal values at the native interpolation nodes.</span>
<a name="ln-803"></a><span class="c">!</span>
<a name="ln-804"></a><span class="c">!     nVariables (in)</span>
<a name="ln-805"></a><span class="c">!</span>
<a name="ln-806"></a><span class="c">!     nElements (in)</span>
<a name="ln-807"></a><span class="c">!</span>
<a name="ln-808"></a><span class="c">!     fNew (out)</span>
<a name="ln-809"></a><span class="c">!      Array of function nodal values at the target interpolation nodes.</span>
<a name="ln-810"></a><span class="c">!</span>
<a name="ln-811"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-812"></a>
<a name="ln-813"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGridInterp_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fNew</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-814"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-815"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-816"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-817"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-818"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fNew</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-819"></a>    <span class="c">! Local</span>
<a name="ln-820"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span>
<a name="ln-821"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fi</span><span class="p">,</span><span class="n">fij</span>
<a name="ln-822"></a>
<a name="ln-823"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-824"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-825"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-826"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-827"></a>
<a name="ln-828"></a>            <span class="n">fij</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-829"></a>            <span class="k">DO </span><span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-830"></a>              <span class="n">fi</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-831"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-832"></a>                <span class="n">fi</span> <span class="o">=</span> <span class="n">fi</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-833"></a>              <span class="k">END DO</span>
<a name="ln-834"></a><span class="k">              </span><span class="n">fij</span> <span class="o">=</span> <span class="n">fij</span> <span class="o">+</span> <span class="n">fi</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-835"></a>            <span class="k">END DO</span>
<a name="ln-836"></a><span class="k">            </span><span class="n">fNew</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fij</span>
<a name="ln-837"></a>
<a name="ln-838"></a>          <span class="k">END DO</span>
<a name="ln-839"></a><span class="k">        END DO</span>
<a name="ln-840"></a><span class="k">      END DO</span>
<a name="ln-841"></a><span class="k">    END DO</span>
<a name="ln-842"></a>
<a name="ln-843"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarGridInterp_2D_cpu</span>
<a name="ln-844"></a><span class="c">!</span>
<a name="ln-845"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGridInterp_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-846"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-847"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-848"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-849"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-850"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp_dev</span>
<a name="ln-851"></a>
<a name="ln-852"></a><span class="cp">#ifdef GPU</span>
<a name="ln-853"></a>    <span class="k">CALL </span><span class="n">ScalarGridInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-854"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-855"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-856"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-857"></a><span class="cp">#endif</span>
<a name="ln-858"></a>
<a name="ln-859"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarGridInterp_2D_gpu</span>
<a name="ln-860"></a>
<a name="ln-861"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGridInterp_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fNew</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-862"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-863"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-864"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-865"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-866"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-867"></a>    <span class="c">! Local</span>
<a name="ln-868"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span>
<a name="ln-869"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-870"></a>
<a name="ln-871"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-872"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-873"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-874"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-875"></a>
<a name="ln-876"></a>            <span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-877"></a>            <span class="n">fNew</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-878"></a>
<a name="ln-879"></a>            <span class="k">DO </span><span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-880"></a>
<a name="ln-881"></a>              <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-882"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-883"></a>                <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-884"></a>              <span class="k">END DO</span>
<a name="ln-885"></a>
<a name="ln-886"></a><span class="k">              </span><span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-887"></a>
<a name="ln-888"></a>            <span class="k">END DO</span>
<a name="ln-889"></a>
<a name="ln-890"></a><span class="k">          END DO</span>
<a name="ln-891"></a><span class="k">        END DO</span>
<a name="ln-892"></a><span class="k">      END DO</span>
<a name="ln-893"></a><span class="k">    END DO</span>
<a name="ln-894"></a>
<a name="ln-895"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorGridInterp_2D_cpu</span>
<a name="ln-896"></a><span class="c">!</span>
<a name="ln-897"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGridInterp_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-898"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-899"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-900"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-901"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-902"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp_dev</span>
<a name="ln-903"></a>
<a name="ln-904"></a><span class="cp">#ifdef GPU</span>
<a name="ln-905"></a>    <span class="k">CALL </span><span class="n">VectorGridInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-906"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-907"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-908"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-909"></a><span class="cp">#endif</span>
<a name="ln-910"></a>
<a name="ln-911"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorGridInterp_2D_gpu</span>
<a name="ln-912"></a>
<a name="ln-913"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorGridInterp_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fNew</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-914"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-915"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-916"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-917"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-918"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-919"></a>    <span class="c">! Local</span>
<a name="ln-920"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span>
<a name="ln-921"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-922"></a>
<a name="ln-923"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-924"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-925"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-926"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-927"></a>
<a name="ln-928"></a>            <span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-929"></a>
<a name="ln-930"></a>            <span class="k">DO </span><span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-931"></a>
<a name="ln-932"></a>              <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-933"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-934"></a>                <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-935"></a>              <span class="k">END DO</span>
<a name="ln-936"></a>
<a name="ln-937"></a><span class="k">              </span><span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fNew</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-938"></a>
<a name="ln-939"></a>            <span class="k">END DO</span>
<a name="ln-940"></a>
<a name="ln-941"></a><span class="k">          END DO</span>
<a name="ln-942"></a><span class="k">        END DO</span>
<a name="ln-943"></a><span class="k">      END DO</span>
<a name="ln-944"></a><span class="k">    END DO</span>
<a name="ln-945"></a>
<a name="ln-946"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorGridInterp_2D_cpu</span>
<a name="ln-947"></a><span class="c">!</span>
<a name="ln-948"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorGridInterp_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-949"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-950"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-951"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-952"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-953"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp_dev</span>
<a name="ln-954"></a>
<a name="ln-955"></a><span class="cp">#ifdef GPU</span>
<a name="ln-956"></a>    <span class="k">CALL </span><span class="n">TensorGridInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-957"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-958"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-959"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-960"></a><span class="cp">#endif</span>
<a name="ln-961"></a>
<a name="ln-962"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorGridInterp_2D_gpu</span>
<a name="ln-963"></a>
<a name="ln-964"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-965"></a><span class="c">!</span>
<a name="ln-966"></a><span class="c">! GridInterpolate_3D</span>
<a name="ln-967"></a><span class="c">!</span>
<a name="ln-968"></a><span class="c">!   Interpolates an array of nodal values at the native nodes to nodal values at the target nodes.</span>
<a name="ln-969"></a><span class="c">!</span>
<a name="ln-970"></a><span class="c">!   We can write the operations of interpolating data from one set of points to another (in this</span>
<a name="ln-971"></a><span class="c">!   case from &quot;controlPoints&quot; to &quot;targetPoints&quot;) as</span>
<a name="ln-972"></a><span class="c">!</span>
<a name="ln-973"></a><span class="c">!   fnew_{a,b,c} = \sum_{i,j,k=0}^N f_{i,j,k} l_i(\xi_a) l_j(\xi_b) l_k(\xi_c),   a,b,c=0,1,2,...,M</span>
<a name="ln-974"></a><span class="c">!</span>
<a name="ln-975"></a><span class="c">!   where l_i(\xi) are the Lagrange interpolating polynomials through the interpolation points.</span>
<a name="ln-976"></a><span class="c">!   The interpolation matrix is T_{a,i} = l_i(\xi_a) maps an array of nodal values from the native</span>
<a name="ln-977"></a><span class="c">!   interpolation nodes to the target nodes. This routine serves as a wrapper to call either the CUDA</span>
<a name="ln-978"></a><span class="c">!   kernel (if CUDA is enabled) or the CPU version.</span>
<a name="ln-979"></a><span class="c">!</span>
<a name="ln-980"></a><span class="c">!   Usage :</span>
<a name="ln-981"></a><span class="c">!</span>
<a name="ln-982"></a><span class="c">!     TYPE(Lagrange) :: interp</span>
<a name="ln-983"></a><span class="c">!     INTEGER        :: nVariables, nElements</span>
<a name="ln-984"></a><span class="c">!     REAL(prec)     :: f(0:interp % N,0:interp % N,0:interp % N,1:nVariables,1:nElements)</span>
<a name="ln-985"></a><span class="c">!     REAL(prec)     :: fNew(0:interp % M,0:interp % M,0:interp % M,1:nVariables,1:nElements)</span>
<a name="ln-986"></a><span class="c">!</span>
<a name="ln-987"></a><span class="c">!       CALL interp % GridInterpolation_3D( fnative, fNew, nVariables, nElements )</span>
<a name="ln-988"></a><span class="c">!</span>
<a name="ln-989"></a><span class="c">!     * If CUDA is enabled, the fnative and ftarget arrays must be CUDA device variables.</span>
<a name="ln-990"></a><span class="c">!</span>
<a name="ln-991"></a><span class="c">!   Parameters :</span>
<a name="ln-992"></a><span class="c">!</span>
<a name="ln-993"></a><span class="c">!     interp (in)</span>
<a name="ln-994"></a><span class="c">!       A previously constructed Lagrange data-structure.</span>
<a name="ln-995"></a><span class="c">!</span>
<a name="ln-996"></a><span class="c">!     f (in)</span>
<a name="ln-997"></a><span class="c">!       Array of function nodal values at the native interpolation nodes.</span>
<a name="ln-998"></a><span class="c">!</span>
<a name="ln-999"></a><span class="c">!     nVariables (in)</span>
<a name="ln-1000"></a><span class="c">!</span>
<a name="ln-1001"></a><span class="c">!     nElements (in)</span>
<a name="ln-1002"></a><span class="c">!</span>
<a name="ln-1003"></a><span class="c">!     fNew (out)</span>
<a name="ln-1004"></a><span class="c">!      Array of function nodal values at the target interpolation nodes.</span>
<a name="ln-1005"></a><span class="c">!</span>
<a name="ln-1006"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-1007"></a>
<a name="ln-1008"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGridInterp_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fInterp</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1009"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1010"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1011"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1012"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1013"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1014"></a>    <span class="c">! Local</span>
<a name="ln-1015"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span>
<a name="ln-1016"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fi</span><span class="p">,</span><span class="n">fij</span><span class="p">,</span><span class="n">fijk</span>
<a name="ln-1017"></a>
<a name="ln-1018"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1019"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1020"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1021"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1022"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1023"></a>
<a name="ln-1024"></a>              <span class="n">fijk</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1025"></a>              <span class="k">DO </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1026"></a>                <span class="n">fij</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1027"></a>                <span class="k">DO </span><span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1028"></a>                  <span class="n">fi</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1029"></a>                  <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1030"></a>                    <span class="n">fi</span> <span class="o">=</span> <span class="n">fi</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1031"></a>                  <span class="k">END DO</span>
<a name="ln-1032"></a><span class="k">                  </span><span class="n">fij</span> <span class="o">=</span> <span class="n">fij</span> <span class="o">+</span> <span class="n">fi</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1033"></a>                <span class="k">END DO</span>
<a name="ln-1034"></a><span class="k">                </span><span class="n">fijk</span> <span class="o">=</span> <span class="n">fijk</span> <span class="o">+</span> <span class="n">fij</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1035"></a>              <span class="k">END DO</span>
<a name="ln-1036"></a><span class="k">              </span><span class="n">fInterp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fijk</span>
<a name="ln-1037"></a>
<a name="ln-1038"></a>            <span class="k">END DO</span>
<a name="ln-1039"></a><span class="k">          END DO</span>
<a name="ln-1040"></a><span class="k">        END DO</span>
<a name="ln-1041"></a><span class="k">      END DO</span>
<a name="ln-1042"></a><span class="k">    END DO</span>
<a name="ln-1043"></a>
<a name="ln-1044"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarGridInterp_3D_cpu</span>
<a name="ln-1045"></a><span class="c">!</span>
<a name="ln-1046"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGridInterp_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1047"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1048"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1049"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1050"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1051"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp_dev</span>
<a name="ln-1052"></a>
<a name="ln-1053"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1054"></a>    <span class="k">CALL </span><span class="n">ScalarGridInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1055"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1056"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1057"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1058"></a><span class="cp">#endif</span>
<a name="ln-1059"></a>
<a name="ln-1060"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarGridInterp_3D_gpu</span>
<a name="ln-1061"></a>
<a name="ln-1062"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGridInterp_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fInterp</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1063"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1064"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1065"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1066"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1067"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1068"></a>    <span class="c">! Local</span>
<a name="ln-1069"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span>
<a name="ln-1070"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1071"></a>
<a name="ln-1072"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1073"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1074"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1075"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1076"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1077"></a>
<a name="ln-1078"></a>              <span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1079"></a>              <span class="k">DO </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1080"></a>                <span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1081"></a>                <span class="k">DO </span><span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1082"></a>                  <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1083"></a>                  <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1084"></a>                    <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1085"></a>                  <span class="k">END DO</span>
<a name="ln-1086"></a><span class="k">                  </span><span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1087"></a>                <span class="k">END DO</span>
<a name="ln-1088"></a><span class="k">                </span><span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1089"></a>              <span class="k">END DO</span>
<a name="ln-1090"></a>
<a name="ln-1091"></a><span class="k">            END DO</span>
<a name="ln-1092"></a><span class="k">          END DO</span>
<a name="ln-1093"></a><span class="k">        END DO</span>
<a name="ln-1094"></a><span class="k">      END DO</span>
<a name="ln-1095"></a><span class="k">    END DO</span>
<a name="ln-1096"></a>
<a name="ln-1097"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorGridInterp_3D_cpu</span>
<a name="ln-1098"></a><span class="c">!</span>
<a name="ln-1099"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGridInterp_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1100"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1101"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1102"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1103"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1104"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp_dev</span>
<a name="ln-1105"></a>
<a name="ln-1106"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1107"></a>    <span class="k">CALL </span><span class="n">VectorGridInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1108"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1109"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1110"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1111"></a><span class="cp">#endif</span>
<a name="ln-1112"></a>
<a name="ln-1113"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorGridInterp_3D_gpu</span>
<a name="ln-1114"></a>
<a name="ln-1115"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorGridInterp_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fInterp</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1116"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1117"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1118"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1119"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1120"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1121"></a>    <span class="c">! Local</span>
<a name="ln-1122"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span>
<a name="ln-1123"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1124"></a>
<a name="ln-1125"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1126"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1127"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1128"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1129"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-1130"></a>
<a name="ln-1131"></a>              <span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1132"></a>              <span class="k">DO </span><span class="n">kk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1133"></a>                <span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1134"></a>                <span class="k">DO </span><span class="n">jj</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1135"></a>                  <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1136"></a>                  <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1137"></a>                    <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">,</span><span class="n">kk</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1138"></a>                  <span class="k">END DO</span>
<a name="ln-1139"></a><span class="k">                  </span><span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">jj</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1140"></a>                <span class="k">END DO</span>
<a name="ln-1141"></a><span class="k">                </span><span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fInterp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1142"></a>                                                  <span class="n">fij</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1143"></a>              <span class="k">END DO</span>
<a name="ln-1144"></a>
<a name="ln-1145"></a><span class="k">            END DO</span>
<a name="ln-1146"></a><span class="k">          END DO</span>
<a name="ln-1147"></a><span class="k">        END DO</span>
<a name="ln-1148"></a><span class="k">      END DO</span>
<a name="ln-1149"></a><span class="k">    END DO</span>
<a name="ln-1150"></a>
<a name="ln-1151"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorGridInterp_3D_cpu</span>
<a name="ln-1152"></a><span class="c">!</span>
<a name="ln-1153"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorGridInterp_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1154"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1155"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1156"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1157"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1158"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fInterp_dev</span>
<a name="ln-1159"></a>
<a name="ln-1160"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1161"></a>    <span class="k">CALL </span><span class="n">TensorGridInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1162"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">fInterp_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1163"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1164"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1165"></a><span class="cp">#endif                                     </span>
<a name="ln-1166"></a>
<a name="ln-1167"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorGridInterp_3D_gpu</span>
<a name="ln-1168"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-1169"></a><span class="c">!</span>
<a name="ln-1170"></a><span class="c">! Derivative_1D</span>
<a name="ln-1171"></a><span class="c">!</span>
<a name="ln-1172"></a><span class="c">!   Calculates the derivative of the Lagrange interpolant given a set of nodal function values at</span>
<a name="ln-1173"></a><span class="c">!   the native interpolation nodes</span>
<a name="ln-1174"></a><span class="c">!</span>
<a name="ln-1175"></a><span class="c">!   Given a set of nodal values at the interpolation nodes, the derivative of a function through</span>
<a name="ln-1176"></a><span class="c">!   the interpolation nodes can be estimated by</span>
<a name="ln-1177"></a><span class="c">!</span>
<a name="ln-1178"></a><span class="c">!                       f&#39;_a = \sum_{i=0}^N f_{i} l&#39;_i(\xi_a),   a=0,1,2,...,N</span>
<a name="ln-1179"></a><span class="c">!</span>
<a name="ln-1180"></a><span class="c">!   where l_i(\xi) are the Lagrange interpolating polynomials through the interpolation points.</span>
<a name="ln-1181"></a><span class="c">!   The derivative matrix is D_{a,i} = l&#39;_i(\xi_a) maps an array of nodal values at the interpolation</span>
<a name="ln-1182"></a><span class="c">!   nodes to its estimated derivative. This routine serves as a wrapper to call either the CUDA</span>
<a name="ln-1183"></a><span class="c">!   kernel (if CUDA is enabled) or the CPU version.</span>
<a name="ln-1184"></a><span class="c">!</span>
<a name="ln-1185"></a><span class="c">!   Usage :</span>
<a name="ln-1186"></a><span class="c">!</span>
<a name="ln-1187"></a><span class="c">!     TYPE(Lagrange) :: interp</span>
<a name="ln-1188"></a><span class="c">!     INTEGER        :: nVariables, nElements</span>
<a name="ln-1189"></a><span class="c">!     REAL(prec)     :: f(0:interp % N,1:nVariables,1:nElements)</span>
<a name="ln-1190"></a><span class="c">!     REAL(prec)     :: derF(0:interp % N,1:nVariables,1:nElements)</span>
<a name="ln-1191"></a><span class="c">!</span>
<a name="ln-1192"></a><span class="c">!       CALL interp % Derivative_1D( f, derF, nVariables, nElements )</span>
<a name="ln-1193"></a><span class="c">!</span>
<a name="ln-1194"></a><span class="c">!     * If CUDA is enabled, the fnative and ftarget arrays must be CUDA device variables.</span>
<a name="ln-1195"></a><span class="c">!</span>
<a name="ln-1196"></a><span class="c">!   Parameters :</span>
<a name="ln-1197"></a><span class="c">!</span>
<a name="ln-1198"></a><span class="c">!     interp (in)</span>
<a name="ln-1199"></a><span class="c">!       A previously constructed Lagrange data-structure.</span>
<a name="ln-1200"></a><span class="c">!</span>
<a name="ln-1201"></a><span class="c">!     f (in)</span>
<a name="ln-1202"></a><span class="c">!       Array of function nodal values at the native interpolation nodes.</span>
<a name="ln-1203"></a><span class="c">!</span>
<a name="ln-1204"></a><span class="c">!     nVariables (in)</span>
<a name="ln-1205"></a><span class="c">!</span>
<a name="ln-1206"></a><span class="c">!     nElements (in)</span>
<a name="ln-1207"></a><span class="c">!</span>
<a name="ln-1208"></a><span class="c">!     derF (out)</span>
<a name="ln-1209"></a><span class="c">!      Array of derivative values at the target interpolation nodes.</span>
<a name="ln-1210"></a><span class="c">!</span>
<a name="ln-1211"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-1212"></a>
<a name="ln-1213"></a>  <span class="k">SUBROUTINE </span><span class="n">Derivative_1D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1214"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1215"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1216"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1217"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1218"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1219"></a>    <span class="c">! Local</span>
<a name="ln-1220"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1221"></a>
<a name="ln-1222"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1223"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1224"></a>        <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1225"></a>
<a name="ln-1226"></a>          <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1227"></a>          <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1228"></a>            <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1229"></a>          <span class="k">END DO</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a><span class="k">        END DO</span>
<a name="ln-1232"></a><span class="k">      END DO</span>
<a name="ln-1233"></a><span class="k">    END DO</span>
<a name="ln-1234"></a>
<a name="ln-1235"></a><span class="k">  END SUBROUTINE </span><span class="n">Derivative_1D_cpu</span>
<a name="ln-1236"></a>
<a name="ln-1237"></a>  <span class="k">SUBROUTINE </span><span class="n">Derivative_1D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1238"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1239"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1240"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1241"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1242"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">df_dev</span>
<a name="ln-1243"></a>
<a name="ln-1244"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1245"></a>    <span class="k">CALL </span><span class="n">Derivative_1D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1246"></a>                                   <span class="n">f_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1247"></a>                                   <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1248"></a>                                   <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1249"></a><span class="cp">#endif                                     </span>
<a name="ln-1250"></a>
<a name="ln-1251"></a>  <span class="k">END SUBROUTINE </span><span class="n">Derivative_1D_gpu</span>
<a name="ln-1252"></a>  
<a name="ln-1253"></a>  <span class="k">SUBROUTINE </span><span class="n">DGDerivative_1D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bf</span><span class="p">,</span><span class="n">df</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1254"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1255"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1256"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1257"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1258"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1259"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1260"></a>    <span class="c">! Local</span>
<a name="ln-1261"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1262"></a>
<a name="ln-1263"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1264"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1265"></a>        <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1266"></a>
<a name="ln-1267"></a>          <span class="c">! Interior Derivative Matrix Application</span>
<a name="ln-1268"></a>          <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1269"></a>          <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1270"></a>            <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1271"></a>          <span class="k">END DO</span>
<a name="ln-1272"></a>
<a name="ln-1273"></a>          <span class="c">! Boundary Contribution</span>
<a name="ln-1274"></a>          <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">df</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bf</span><span class="p">(</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-1275"></a>                                             <span class="n">bf</span><span class="p">(</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1276"></a>                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1277"></a>
<a name="ln-1278"></a>        <span class="k">END DO</span>
<a name="ln-1279"></a>
<a name="ln-1280"></a><span class="k">      END DO</span>
<a name="ln-1281"></a><span class="k">    END DO</span>
<a name="ln-1282"></a>
<a name="ln-1283"></a><span class="k">  END SUBROUTINE </span><span class="n">DGDerivative_1D_cpu</span>
<a name="ln-1284"></a>
<a name="ln-1285"></a>  <span class="k">SUBROUTINE </span><span class="n">DGDerivative_1D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1286"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1287"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1288"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1289"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1290"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bf_dev</span>
<a name="ln-1291"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">df_dev</span>
<a name="ln-1292"></a>
<a name="ln-1293"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1294"></a>    <span class="k">CALL </span><span class="n">DGDerivative_1D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1295"></a>                                     <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1296"></a>                                     <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1297"></a>                                     <span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">df_dev</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1298"></a>                                     <span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1299"></a>                                     <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1300"></a><span class="cp">#endif                                     </span>
<a name="ln-1301"></a>
<a name="ln-1302"></a>  <span class="k">END SUBROUTINE </span><span class="n">DGDerivative_1D_gpu</span>
<a name="ln-1303"></a>
<a name="ln-1304"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-1305"></a><span class="c">!</span>
<a name="ln-1306"></a><span class="c">! CalculateGradient_2D</span>
<a name="ln-1307"></a><span class="c">!</span>
<a name="ln-1308"></a><span class="c">!   Calculates the gradient of a 2-D function, represented by a 2-D array of nodal values.</span>
<a name="ln-1309"></a><span class="c">!</span>
<a name="ln-1310"></a><span class="c">!   Given a set of nodal values at the interpolation nodes, the gradient of a function through</span>
<a name="ln-1311"></a><span class="c">!   the interpolation nodes can be estimated by</span>
<a name="ln-1312"></a><span class="c">!</span>
<a name="ln-1313"></a><span class="c">!                       (df/dx)_{a,b} = \sum_{i=0}^N f_{i,b} l&#39;_i(\xi_a),   a,b=0,1,2,...,N</span>
<a name="ln-1314"></a><span class="c">!                       (df/dy)_{a,b} = \sum_{j=0}^N f_{a,j} l&#39;_j(\xi_b),   a,b=0,1,2,...,N</span>
<a name="ln-1315"></a><span class="c">!</span>
<a name="ln-1316"></a><span class="c">!   where l_i(\xi) are the Lagrange interpolating polynomials through the interpolation points.</span>
<a name="ln-1317"></a><span class="c">!   The derivative matrix is D_{a,i} = l&#39;_i(\xi_a) maps an array of nodal values at the interpolation</span>
<a name="ln-1318"></a><span class="c">!   nodes to its estimated derivative. This routine serves as a wrapper to call either the CUDA</span>
<a name="ln-1319"></a><span class="c">!   kernel (if CUDA is enabled) or the CPU version.</span>
<a name="ln-1320"></a><span class="c">!</span>
<a name="ln-1321"></a><span class="c">!   Usage :</span>
<a name="ln-1322"></a><span class="c">!</span>
<a name="ln-1323"></a><span class="c">!     TYPE(Lagrange) :: interp</span>
<a name="ln-1324"></a><span class="c">!     INTEGER        :: nVariables, nElements</span>
<a name="ln-1325"></a><span class="c">!     REAL(prec)     :: f(0:interp % N,0:interp % N,1:nVariables,1:nElements)</span>
<a name="ln-1326"></a><span class="c">!     REAL(prec)     :: gradF(1:2,0:interp % N,0:interp % N,1:nVariables,1:nElements)</span>
<a name="ln-1327"></a><span class="c">!</span>
<a name="ln-1328"></a><span class="c">!       CALL interp % CalculateGradient_2D( f, gradF, nVariables, nElements )</span>
<a name="ln-1329"></a><span class="c">!</span>
<a name="ln-1330"></a><span class="c">!     * If CUDA is enabled, the fnative and ftarget arrays must be CUDA device variables.</span>
<a name="ln-1331"></a><span class="c">!</span>
<a name="ln-1332"></a><span class="c">!   Parameters :</span>
<a name="ln-1333"></a><span class="c">!</span>
<a name="ln-1334"></a><span class="c">!     interp (in)</span>
<a name="ln-1335"></a><span class="c">!       A previously constructed Lagrange data-structure.</span>
<a name="ln-1336"></a><span class="c">!</span>
<a name="ln-1337"></a><span class="c">!     f (in)</span>
<a name="ln-1338"></a><span class="c">!       Array of function nodal values at the native interpolation nodes.</span>
<a name="ln-1339"></a><span class="c">!</span>
<a name="ln-1340"></a><span class="c">!     nVariables (in)</span>
<a name="ln-1341"></a><span class="c">!</span>
<a name="ln-1342"></a><span class="c">!     nElements (in)</span>
<a name="ln-1343"></a><span class="c">!</span>
<a name="ln-1344"></a><span class="c">!     gradF (out)</span>
<a name="ln-1345"></a><span class="c">!      Array of derivative values at the target interpolation nodes.</span>
<a name="ln-1346"></a><span class="c">!</span>
<a name="ln-1347"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-1348"></a><span class="c">!</span>
<a name="ln-1349"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGradient_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1350"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1351"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1352"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1353"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1354"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1355"></a>    <span class="c">! Local</span>
<a name="ln-1356"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1357"></a>
<a name="ln-1358"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1359"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1360"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1361"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1362"></a>
<a name="ln-1363"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1364"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1365"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1366"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1367"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1368"></a>            <span class="k">END DO</span>
<a name="ln-1369"></a>
<a name="ln-1370"></a><span class="k">          END DO</span>
<a name="ln-1371"></a><span class="k">        END DO</span>
<a name="ln-1372"></a><span class="k">      END DO</span>
<a name="ln-1373"></a><span class="k">    END DO</span>
<a name="ln-1374"></a>
<a name="ln-1375"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarGradient_2D_cpu</span>
<a name="ln-1376"></a>
<a name="ln-1377"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGradient_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1378"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1379"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1380"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1381"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1382"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">gradF_dev</span>
<a name="ln-1383"></a>    <span class="c">! Local</span>
<a name="ln-1384"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1385"></a>
<a name="ln-1386"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1387"></a>    <span class="k">CALL </span><span class="n">ScalarGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1388"></a>                                       <span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1389"></a>                                       <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1390"></a><span class="cp">#endif                                     </span>
<a name="ln-1391"></a>
<a name="ln-1392"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarGradient_2D_gpu</span>
<a name="ln-1393"></a><span class="c">!</span>
<a name="ln-1394"></a><span class="c">!</span>
<a name="ln-1395"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarDGGradient_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bf</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1396"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1397"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1398"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1399"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1400"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bf</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1401"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1402"></a>    <span class="c">! Local</span>
<a name="ln-1403"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1404"></a>
<a name="ln-1405"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1406"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1407"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1408"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1409"></a>
<a name="ln-1410"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1411"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1412"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1413"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1414"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1415"></a>            <span class="k">END DO</span>
<a name="ln-1416"></a>
<a name="ln-1417"></a>            <span class="c">! Boundary Contribution</span>
<a name="ln-1418"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bf</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1419"></a>                                                             <span class="n">bf</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1420"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1421"></a>
<a name="ln-1422"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">bf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1423"></a>                                                             <span class="n">bf</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1424"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1425"></a>
<a name="ln-1426"></a>          <span class="k">END DO</span>
<a name="ln-1427"></a><span class="k">        END DO</span>
<a name="ln-1428"></a><span class="k">      END DO</span>
<a name="ln-1429"></a><span class="k">    END DO</span>
<a name="ln-1430"></a>
<a name="ln-1431"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarDGGradient_2D_cpu</span>
<a name="ln-1432"></a>
<a name="ln-1433"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarDGGradient_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1434"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1435"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1436"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1437"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1438"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">bf_dev</span>
<a name="ln-1439"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">gradF_dev</span>
<a name="ln-1440"></a>    <span class="c">! Local</span>
<a name="ln-1441"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1442"></a>
<a name="ln-1443"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1444"></a>    <span class="k">CALL </span><span class="n">ScalarDGGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1445"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1446"></a>                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1447"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1448"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1449"></a><span class="cp">#endif                                     </span>
<a name="ln-1450"></a>
<a name="ln-1451"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarDGGradient_2D_gpu</span>
<a name="ln-1452"></a>
<a name="ln-1453"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGradient_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1454"></a>    <span class="c">!</span>
<a name="ln-1455"></a>    <span class="c">! Input : Vector(1:2,...)</span>
<a name="ln-1456"></a>    <span class="c">! Output : Tensor(1:2,1:2,....)</span>
<a name="ln-1457"></a>    <span class="c">!          &gt; Tensor(1,1) = d/ds1( Vector(1,...) )</span>
<a name="ln-1458"></a>    <span class="c">!          &gt; Tensor(2,1) = d/ds1( Vector(2,...) )</span>
<a name="ln-1459"></a>    <span class="c">!          &gt; Tensor(1,2) = d/ds2( Vector(1,...) )</span>
<a name="ln-1460"></a>    <span class="c">!          &gt; Tensor(2,2) = d/ds2( Vector(2,...) )</span>
<a name="ln-1461"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1462"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1463"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1464"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1465"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1466"></a>    <span class="c">! Local</span>
<a name="ln-1467"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1468"></a>
<a name="ln-1469"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1470"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1471"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1472"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1473"></a>
<a name="ln-1474"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1475"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1476"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1477"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1478"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1479"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1480"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1481"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1482"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1483"></a>            <span class="k">END DO</span>
<a name="ln-1484"></a>
<a name="ln-1485"></a><span class="k">          END DO</span>
<a name="ln-1486"></a><span class="k">        END DO</span>
<a name="ln-1487"></a><span class="k">      END DO</span>
<a name="ln-1488"></a><span class="k">    END DO</span>
<a name="ln-1489"></a>
<a name="ln-1490"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorGradient_2D_cpu</span>
<a name="ln-1491"></a>
<a name="ln-1492"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGradient_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1493"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1494"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1495"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1496"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1497"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">gradF_dev</span>
<a name="ln-1498"></a>    <span class="c">! Local</span>
<a name="ln-1499"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1500"></a>
<a name="ln-1501"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1502"></a>    <span class="k">CALL </span><span class="n">VectorGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1503"></a>                                       <span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1504"></a>                                       <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1505"></a><span class="cp">#endif                                     </span>
<a name="ln-1506"></a>
<a name="ln-1507"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorGradient_2D_gpu</span>
<a name="ln-1508"></a>
<a name="ln-1509"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDGGradient_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bf</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1510"></a>    <span class="c">!</span>
<a name="ln-1511"></a>    <span class="c">! Input : Vector(1:2,...)</span>
<a name="ln-1512"></a>    <span class="c">! Output : Tensor(1:2,1:2,....)</span>
<a name="ln-1513"></a>    <span class="c">!          &gt; Tensor(1,1) = d/ds1( Vector(1,...) )</span>
<a name="ln-1514"></a>    <span class="c">!          &gt; Tensor(2,1) = d/ds1( Vector(2,...) )</span>
<a name="ln-1515"></a>    <span class="c">!          &gt; Tensor(1,2) = d/ds2( Vector(1,...) )</span>
<a name="ln-1516"></a>    <span class="c">!          &gt; Tensor(2,2) = d/ds2( Vector(2,...) )</span>
<a name="ln-1517"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1518"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1519"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1520"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1521"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1522"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1523"></a>    <span class="c">! Local</span>
<a name="ln-1524"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1525"></a>
<a name="ln-1526"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1527"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1528"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1529"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1530"></a>
<a name="ln-1531"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1532"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1533"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1534"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1535"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1536"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1537"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1538"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1539"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1540"></a>            <span class="k">END DO</span>
<a name="ln-1541"></a><span class="k">            </span><span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1542"></a>                                                                 <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1543"></a>                                                                <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1544"></a>
<a name="ln-1545"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1546"></a>                                                                 <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1547"></a>                                                                <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1548"></a>
<a name="ln-1549"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1550"></a>                                                                 <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1551"></a>                                                                <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1552"></a>
<a name="ln-1553"></a>            <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1554"></a>                                                                 <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1555"></a>                                                                <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1556"></a>
<a name="ln-1557"></a>          <span class="k">END DO</span>
<a name="ln-1558"></a><span class="k">        END DO</span>
<a name="ln-1559"></a><span class="k">      END DO</span>
<a name="ln-1560"></a><span class="k">    END DO</span>
<a name="ln-1561"></a>
<a name="ln-1562"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorDGGradient_2D_cpu</span>
<a name="ln-1563"></a>
<a name="ln-1564"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDGGradient_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1565"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1566"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1567"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1568"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1569"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">bf_dev</span>
<a name="ln-1570"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">gradF_dev</span>
<a name="ln-1571"></a>    <span class="c">! Local</span>
<a name="ln-1572"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1573"></a>
<a name="ln-1574"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1575"></a>    <span class="k">CALL </span><span class="n">VectorDGGradient_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1576"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1577"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1578"></a>                                       <span class="n">f_dev</span><span class="p">,</span><span class="n">bf_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1579"></a>                                       <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1580"></a><span class="cp">#endif                                     </span>
<a name="ln-1581"></a>
<a name="ln-1582"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorDGGradient_2D_gpu</span>
<a name="ln-1583"></a>
<a name="ln-1584"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDivergence_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1585"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1586"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1587"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1588"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1589"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1590"></a>    <span class="c">! Local</span>
<a name="ln-1591"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1592"></a>
<a name="ln-1593"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1594"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1595"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1596"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1597"></a>
<a name="ln-1598"></a>            <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1599"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1600"></a>              <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1601"></a>                                 <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1602"></a>            <span class="k">END DO</span>
<a name="ln-1603"></a>
<a name="ln-1604"></a><span class="k">          END DO</span>
<a name="ln-1605"></a><span class="k">        END DO</span>
<a name="ln-1606"></a><span class="k">      END DO</span>
<a name="ln-1607"></a><span class="k">    END DO</span>
<a name="ln-1608"></a>
<a name="ln-1609"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorDivergence_2D_cpu</span>
<a name="ln-1610"></a>
<a name="ln-1611"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDivergence_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1612"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1613"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1614"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1615"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1616"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-1617"></a>    <span class="c">! Local</span>
<a name="ln-1618"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1619"></a>
<a name="ln-1620"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1621"></a>    <span class="k">CALL </span><span class="n">VectorDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1622"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1623"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1624"></a><span class="cp">#endif                                     </span>
<a name="ln-1625"></a>
<a name="ln-1626"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorDivergence_2D_gpu</span>
<a name="ln-1627"></a>
<a name="ln-1628"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDGDivergence_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bF</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1629"></a>  <span class="c">! Assumes bF is the vector component in the direction normal to the boundary</span>
<a name="ln-1630"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1631"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1632"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1633"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1634"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1635"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1636"></a>    <span class="c">! Local</span>
<a name="ln-1637"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1638"></a>
<a name="ln-1639"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1640"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1641"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1642"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1643"></a>
<a name="ln-1644"></a>            <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1645"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1646"></a>              <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1647"></a>                                                    <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1648"></a>            <span class="k">END DO</span>
<a name="ln-1649"></a>
<a name="ln-1650"></a><span class="k">            </span><span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1651"></a>                                                   <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1652"></a>                                                  <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1653"></a>                                                  <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1654"></a>                                                   <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1655"></a>                                                  <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1656"></a>
<a name="ln-1657"></a>
<a name="ln-1658"></a>          <span class="k">END DO</span>
<a name="ln-1659"></a><span class="k">        END DO</span>
<a name="ln-1660"></a><span class="k">      END DO</span>
<a name="ln-1661"></a><span class="k">    END DO</span>
<a name="ln-1662"></a>
<a name="ln-1663"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorDGDivergence_2D_cpu</span>
<a name="ln-1664"></a>
<a name="ln-1665"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDGDivergence_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1666"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1667"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1668"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1669"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1670"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">bF_dev</span>
<a name="ln-1671"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-1672"></a>    <span class="c">! Local</span>
<a name="ln-1673"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1674"></a>
<a name="ln-1675"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1676"></a>    <span class="k">CALL </span><span class="n">VectorDGDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1677"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1678"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1679"></a>                                           <span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1680"></a>                                           <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1681"></a><span class="cp">#endif                                     </span>
<a name="ln-1682"></a>
<a name="ln-1683"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorDGDivergence_2D_gpu</span>
<a name="ln-1684"></a>
<a name="ln-1685"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorCurl_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1686"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1687"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1688"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1689"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1690"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1691"></a>    <span class="c">! Local</span>
<a name="ln-1692"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1693"></a>
<a name="ln-1694"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1695"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1696"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1697"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1698"></a>
<a name="ln-1699"></a>            <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1700"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1701"></a>              <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-1702"></a>                                 <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1703"></a>            <span class="k">END DO</span>
<a name="ln-1704"></a>
<a name="ln-1705"></a><span class="k">          END DO</span>
<a name="ln-1706"></a><span class="k">        END DO</span>
<a name="ln-1707"></a><span class="k">      END DO</span>
<a name="ln-1708"></a><span class="k">    END DO</span>
<a name="ln-1709"></a>
<a name="ln-1710"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorCurl_2D_cpu</span>
<a name="ln-1711"></a>
<a name="ln-1712"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorCurl_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1713"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1714"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1715"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1716"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1717"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-1718"></a>    <span class="c">! Local</span>
<a name="ln-1719"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1720"></a>
<a name="ln-1721"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1722"></a>    <span class="k">CALL </span><span class="n">VectorCurl_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1723"></a>                                   <span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1724"></a>                                   <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1725"></a><span class="cp">#endif                                     </span>
<a name="ln-1726"></a>
<a name="ln-1727"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorCurl_2D_gpu</span>
<a name="ln-1728"></a>
<a name="ln-1729"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDivergence_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1730"></a>    <span class="c">! Note that the divergence is taken over the first dimension (row dimension) of the tensor matrix</span>
<a name="ln-1731"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1732"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1733"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1734"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1735"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1736"></a>    <span class="c">! Local</span>
<a name="ln-1737"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1738"></a>
<a name="ln-1739"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1740"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1741"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1742"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1743"></a>
<a name="ln-1744"></a>            <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1745"></a>            <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1746"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1747"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1748"></a>                                   <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1749"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1750"></a>                                   <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1751"></a>            <span class="k">END DO</span>
<a name="ln-1752"></a>
<a name="ln-1753"></a><span class="k">          END DO</span>
<a name="ln-1754"></a><span class="k">        END DO</span>
<a name="ln-1755"></a><span class="k">      END DO</span>
<a name="ln-1756"></a><span class="k">    END DO</span>
<a name="ln-1757"></a>
<a name="ln-1758"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorDivergence_2D_cpu</span>
<a name="ln-1759"></a>
<a name="ln-1760"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDivergence_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1761"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1762"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1763"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1764"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1765"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-1766"></a>    <span class="c">! Local</span>
<a name="ln-1767"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1768"></a>
<a name="ln-1769"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1770"></a>    <span class="k">CALL </span><span class="n">TensorDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1771"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1772"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1773"></a><span class="cp">#endif                                     </span>
<a name="ln-1774"></a>
<a name="ln-1775"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorDivergence_2D_gpu</span>
<a name="ln-1776"></a>
<a name="ln-1777"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDGDivergence_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bF</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1778"></a>    <span class="c">! Note that the divergence is taken over the first dimension (row dimension) of the tensor matrix</span>
<a name="ln-1779"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1780"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1781"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1782"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1783"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1784"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1785"></a>    <span class="c">! Local</span>
<a name="ln-1786"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1787"></a>
<a name="ln-1788"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1789"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1790"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1791"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1792"></a>
<a name="ln-1793"></a>            <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1794"></a>            <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1795"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1796"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1797"></a>                                                        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1798"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1799"></a>                                                        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1800"></a>            <span class="k">END DO</span>
<a name="ln-1801"></a>
<a name="ln-1802"></a><span class="k">            </span><span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1803"></a>                                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1804"></a>                                                      <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1805"></a>                                                      <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1806"></a>                                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1807"></a>                                                      <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1808"></a>
<a name="ln-1809"></a>            <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1810"></a>                                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1811"></a>                                                      <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1812"></a>                                                      <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-1813"></a>                                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1814"></a>                                                      <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-1815"></a>          <span class="k">END DO</span>
<a name="ln-1816"></a><span class="k">        END DO</span>
<a name="ln-1817"></a><span class="k">      END DO</span>
<a name="ln-1818"></a><span class="k">    END DO</span>
<a name="ln-1819"></a>
<a name="ln-1820"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorDGDivergence_2D_cpu</span>
<a name="ln-1821"></a>
<a name="ln-1822"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDGDivergence_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1823"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1824"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1825"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1826"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1827"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">bf_dev</span>
<a name="ln-1828"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-1829"></a>    <span class="c">! Local</span>
<a name="ln-1830"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1831"></a>
<a name="ln-1832"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1833"></a>    <span class="k">CALL </span><span class="n">TensorDGDivergence_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1834"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1835"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1836"></a>                                           <span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1837"></a>                                           <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1838"></a><span class="cp">#endif                                     </span>
<a name="ln-1839"></a>
<a name="ln-1840"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorDGDivergence_2D_gpu</span>
<a name="ln-1841"></a>
<a name="ln-1842"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGradient_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1843"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1844"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1845"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1846"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1847"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1848"></a>    <span class="c">! Local</span>
<a name="ln-1849"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1850"></a>
<a name="ln-1851"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1852"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1853"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1854"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1855"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1856"></a>
<a name="ln-1857"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1858"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1859"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1860"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1861"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1862"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1863"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1864"></a>              <span class="k">END DO</span>
<a name="ln-1865"></a>
<a name="ln-1866"></a><span class="k">            END DO</span>
<a name="ln-1867"></a><span class="k">          END DO</span>
<a name="ln-1868"></a><span class="k">        END DO</span>
<a name="ln-1869"></a><span class="k">      END DO</span>
<a name="ln-1870"></a><span class="k">    END DO</span>
<a name="ln-1871"></a>
<a name="ln-1872"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarGradient_3D_cpu</span>
<a name="ln-1873"></a>
<a name="ln-1874"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarGradient_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1875"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1876"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1877"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1878"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1879"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">gradF_dev</span>
<a name="ln-1880"></a>    <span class="c">! Local</span>
<a name="ln-1881"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1882"></a>
<a name="ln-1883"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1884"></a>    <span class="k">CALL </span><span class="n">ScalarGradient_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1885"></a>                                       <span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1886"></a>                                       <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1887"></a><span class="cp">#endif                                     </span>
<a name="ln-1888"></a>
<a name="ln-1889"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarGradient_3D_gpu</span>
<a name="ln-1890"></a><span class="c">!</span>
<a name="ln-1891"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGradient_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1892"></a>    <span class="c">!</span>
<a name="ln-1893"></a>    <span class="c">! Input : Vector(1:3,...)</span>
<a name="ln-1894"></a>    <span class="c">! Output : Tensor(1:3,1:3,....)</span>
<a name="ln-1895"></a>    <span class="c">!          &gt; Tensor(1,1) = d/ds1( Vector(1,...) )</span>
<a name="ln-1896"></a>    <span class="c">!          &gt; Tensor(2,1) = d/ds1( Vector(2,...) )</span>
<a name="ln-1897"></a>    <span class="c">!          &gt; Tensor(3,1) = d/ds1( Vector(3,...) )</span>
<a name="ln-1898"></a>    <span class="c">!          &gt; Tensor(1,2) = d/ds2( Vector(1,...) )</span>
<a name="ln-1899"></a>    <span class="c">!          &gt; Tensor(2,2) = d/ds2( Vector(2,...) )</span>
<a name="ln-1900"></a>    <span class="c">!          &gt; Tensor(3,2) = d/ds2( Vector(3,...) )</span>
<a name="ln-1901"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1902"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1903"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1904"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1905"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1906"></a>    <span class="c">! Local</span>
<a name="ln-1907"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1908"></a>
<a name="ln-1909"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1910"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1911"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1912"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1913"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1914"></a>
<a name="ln-1915"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1916"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1917"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1918"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1919"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1920"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1921"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1922"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1923"></a>              <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1924"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1925"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1926"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1927"></a>
<a name="ln-1928"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1929"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1930"></a>
<a name="ln-1931"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1932"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1933"></a>
<a name="ln-1934"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1935"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1936"></a>
<a name="ln-1937"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1938"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1939"></a>
<a name="ln-1940"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1941"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1942"></a>
<a name="ln-1943"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1944"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1945"></a>
<a name="ln-1946"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1947"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1948"></a>
<a name="ln-1949"></a>                <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">gradF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1950"></a>                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1951"></a>
<a name="ln-1952"></a>              <span class="k">END DO</span>
<a name="ln-1953"></a>
<a name="ln-1954"></a><span class="k">            END DO</span>
<a name="ln-1955"></a><span class="k">          END DO</span>
<a name="ln-1956"></a><span class="k">        END DO</span>
<a name="ln-1957"></a><span class="k">      END DO</span>
<a name="ln-1958"></a><span class="k">    END DO</span>
<a name="ln-1959"></a>
<a name="ln-1960"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorGradient_3D_cpu</span>
<a name="ln-1961"></a>
<a name="ln-1962"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorGradient_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1963"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1964"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1965"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1966"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-1967"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">gradF_dev</span>
<a name="ln-1968"></a>    <span class="c">! Local</span>
<a name="ln-1969"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1970"></a>
<a name="ln-1971"></a><span class="cp">#ifdef GPU</span>
<a name="ln-1972"></a>    <span class="k">CALL </span><span class="n">VectorGradient_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1973"></a>                                       <span class="n">f_dev</span><span class="p">,</span><span class="n">gradF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-1974"></a>                                       <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1975"></a><span class="cp">#endif                                     </span>
<a name="ln-1976"></a>
<a name="ln-1977"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorGradient_3D_gpu</span>
<a name="ln-1978"></a>
<a name="ln-1979"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDivergence_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1980"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1981"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-1982"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1983"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1984"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-1985"></a>    <span class="c">! Local</span>
<a name="ln-1986"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-1987"></a>
<a name="ln-1988"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-1989"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-1990"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1991"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1992"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1993"></a>
<a name="ln-1994"></a>              <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-1995"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1996"></a>                <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1997"></a>                                     <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1998"></a>                                     <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1999"></a>              <span class="k">END DO</span>
<a name="ln-2000"></a>
<a name="ln-2001"></a><span class="k">            END DO</span>
<a name="ln-2002"></a><span class="k">          END DO</span>
<a name="ln-2003"></a><span class="k">        END DO</span>
<a name="ln-2004"></a><span class="k">      END DO</span>
<a name="ln-2005"></a><span class="k">    END DO</span>
<a name="ln-2006"></a>
<a name="ln-2007"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorDivergence_3D_cpu</span>
<a name="ln-2008"></a>
<a name="ln-2009"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDivergence_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2010"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2011"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2012"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2013"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-2014"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-2015"></a>    <span class="c">! Local</span>
<a name="ln-2016"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2017"></a>
<a name="ln-2018"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2019"></a>    <span class="k">CALL </span><span class="n">VectorDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2020"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2021"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2022"></a><span class="cp">#endif                                     </span>
<a name="ln-2023"></a>
<a name="ln-2024"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorDivergence_3D_gpu</span>
<a name="ln-2025"></a>
<a name="ln-2026"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDGDivergence_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bF</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2027"></a>  <span class="c">! Assumes bF is the vector component in the direction normal to the element boundaries</span>
<a name="ln-2028"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2029"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2030"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2031"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2032"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bf</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2033"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2034"></a>    <span class="c">! Local</span>
<a name="ln-2035"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2036"></a>
<a name="ln-2037"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2038"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2039"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2040"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2041"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2042"></a>
<a name="ln-2043"></a>              <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2044"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2045"></a>                <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2046"></a>                                                          <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2047"></a>                                                          <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2048"></a>              <span class="k">END DO</span>
<a name="ln-2049"></a>
<a name="ln-2050"></a><span class="k">              </span><span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! east</span>
<a name="ln-2051"></a>                                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! west</span>
<a name="ln-2052"></a>                                                        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2053"></a>                                                        <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! north</span>
<a name="ln-2054"></a>                                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! south</span>
<a name="ln-2055"></a>                                                        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2056"></a>                                                        <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! top</span>
<a name="ln-2057"></a>                                                         <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! bottom</span>
<a name="ln-2058"></a>                                                        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-2059"></a>
<a name="ln-2060"></a>            <span class="k">END DO</span>
<a name="ln-2061"></a><span class="k">          END DO</span>
<a name="ln-2062"></a><span class="k">        END DO</span>
<a name="ln-2063"></a><span class="k">      END DO</span>
<a name="ln-2064"></a><span class="k">    END DO</span>
<a name="ln-2065"></a>
<a name="ln-2066"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorDGDivergence_3D_cpu</span>
<a name="ln-2067"></a>
<a name="ln-2068"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorDGDivergence_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2069"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2070"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2071"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2072"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-2073"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">bF_dev</span>
<a name="ln-2074"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-2075"></a>    <span class="c">! Local</span>
<a name="ln-2076"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2077"></a>
<a name="ln-2078"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2079"></a>    <span class="k">CALL </span><span class="n">VectorDGDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2080"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2081"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2082"></a>                                           <span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2083"></a>                                           <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2084"></a><span class="cp">#endif                                     </span>
<a name="ln-2085"></a>
<a name="ln-2086"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorDGDivergence_3D_gpu</span>
<a name="ln-2087"></a>
<a name="ln-2088"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorCurl_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2089"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2090"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2091"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2092"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2093"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2094"></a>    <span class="c">! Local</span>
<a name="ln-2095"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2096"></a>
<a name="ln-2097"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2098"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2099"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2100"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2101"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2102"></a>
<a name="ln-2103"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2104"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2105"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2106"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2107"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-2108"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2109"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-2110"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2111"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-2112"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2113"></a>              <span class="k">END DO</span>
<a name="ln-2114"></a>
<a name="ln-2115"></a><span class="k">            END DO</span>
<a name="ln-2116"></a><span class="k">          END DO</span>
<a name="ln-2117"></a><span class="k">        END DO</span>
<a name="ln-2118"></a><span class="k">      END DO</span>
<a name="ln-2119"></a><span class="k">    END DO</span>
<a name="ln-2120"></a>
<a name="ln-2121"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorCurl_3D_cpu</span>
<a name="ln-2122"></a>
<a name="ln-2123"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorCurl_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2124"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2125"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2126"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2127"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-2128"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-2129"></a>    <span class="c">! Local</span>
<a name="ln-2130"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2131"></a>
<a name="ln-2132"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2133"></a>    <span class="k">CALL </span><span class="n">VectorCurl_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2134"></a>                                   <span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2135"></a>                                   <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2136"></a><span class="cp">#endif                                     </span>
<a name="ln-2137"></a>
<a name="ln-2138"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorCurl_3D_gpu</span>
<a name="ln-2139"></a>
<a name="ln-2140"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDivergence_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2141"></a>    <span class="c">! Note that the divergence is taken over the first dimension (row dimension) of the tensor matrix</span>
<a name="ln-2142"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2143"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2144"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2145"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2146"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2147"></a>    <span class="c">! Local</span>
<a name="ln-2148"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2149"></a>
<a name="ln-2150"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2151"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2152"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2153"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2154"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2155"></a>
<a name="ln-2156"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2157"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2158"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2159"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2160"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2161"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2162"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2163"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2164"></a>
<a name="ln-2165"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2166"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2167"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2168"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2169"></a>
<a name="ln-2170"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2171"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2172"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2173"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2174"></a>              <span class="k">END DO</span>
<a name="ln-2175"></a>
<a name="ln-2176"></a><span class="k">            END DO</span>
<a name="ln-2177"></a><span class="k">          END DO</span>
<a name="ln-2178"></a><span class="k">        END DO</span>
<a name="ln-2179"></a><span class="k">      END DO</span>
<a name="ln-2180"></a><span class="k">    END DO</span>
<a name="ln-2181"></a>
<a name="ln-2182"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorDivergence_3D_cpu</span>
<a name="ln-2183"></a>
<a name="ln-2184"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDivergence_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2185"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2186"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2187"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2188"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-2189"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-2190"></a>    <span class="c">! Local</span>
<a name="ln-2191"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2192"></a>
<a name="ln-2193"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2194"></a>    <span class="k">CALL </span><span class="n">TensorDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2195"></a>                                         <span class="n">f_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2196"></a>                                         <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2197"></a><span class="cp">#endif                                     </span>
<a name="ln-2198"></a>
<a name="ln-2199"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorDivergence_3D_gpu</span>
<a name="ln-2200"></a>
<a name="ln-2201"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDGDivergence_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">bF</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2202"></a>    <span class="c">! Note that the divergence is taken over the first dimension (row dimension) of the tensor matrix</span>
<a name="ln-2203"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2204"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2205"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2206"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2207"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2208"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2209"></a>    <span class="c">! Local</span>
<a name="ln-2210"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2211"></a>
<a name="ln-2212"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2213"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2214"></a>        <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2215"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2216"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2217"></a>
<a name="ln-2218"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2219"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2220"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2221"></a>              <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2222"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2223"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2224"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2225"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2226"></a>
<a name="ln-2227"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2228"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2229"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2230"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2231"></a>
<a name="ln-2232"></a>                <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2233"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2234"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-2235"></a>                                       <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-2236"></a>              <span class="k">END DO</span>
<a name="ln-2237"></a>
<a name="ln-2238"></a><span class="k">              </span><span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! east</span>
<a name="ln-2239"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! west</span>
<a name="ln-2240"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2241"></a>                                                            <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! north</span>
<a name="ln-2242"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! south</span>
<a name="ln-2243"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2244"></a>                                                            <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! top</span>
<a name="ln-2245"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! bottom</span>
<a name="ln-2246"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-2247"></a>
<a name="ln-2248"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! east</span>
<a name="ln-2249"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! west</span>
<a name="ln-2250"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2251"></a>                                                            <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! north</span>
<a name="ln-2252"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! south</span>
<a name="ln-2253"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2254"></a>                                                            <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! top</span>
<a name="ln-2255"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! bottom</span>
<a name="ln-2256"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-2257"></a>
<a name="ln-2258"></a>              <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">dF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! east</span>
<a name="ln-2259"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! west</span>
<a name="ln-2260"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2261"></a>                                                            <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! north</span>
<a name="ln-2262"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! south</span>
<a name="ln-2263"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span><span class="p">&amp;</span>
<a name="ln-2264"></a>                                                            <span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span> <span class="c">! top</span>
<a name="ln-2265"></a>                                                             <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">bF</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">))</span><span class="o">/</span><span class="p">&amp;</span>  <span class="c">! bottom</span>
<a name="ln-2266"></a>                                                            <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-2267"></a>
<a name="ln-2268"></a>            <span class="k">END DO</span>
<a name="ln-2269"></a><span class="k">          END DO</span>
<a name="ln-2270"></a><span class="k">        END DO</span>
<a name="ln-2271"></a><span class="k">      END DO</span>
<a name="ln-2272"></a><span class="k">    END DO</span>
<a name="ln-2273"></a>
<a name="ln-2274"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorDGDivergence_3D_cpu</span>
<a name="ln-2275"></a>
<a name="ln-2276"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorDGDivergence_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2277"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2278"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2279"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2280"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">f_dev</span>
<a name="ln-2281"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">bF_dev</span>
<a name="ln-2282"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">dF_dev</span>
<a name="ln-2283"></a>    <span class="c">! Local</span>
<a name="ln-2284"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2285"></a>
<a name="ln-2286"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2287"></a>    <span class="k">CALL </span><span class="n">TensorDGDivergence_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2288"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2289"></a>                                           <span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2290"></a>                                           <span class="n">f_dev</span><span class="p">,</span><span class="n">bF_dev</span><span class="p">,</span><span class="n">dF_dev</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2291"></a>                                           <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2292"></a><span class="cp">#endif                                     </span>
<a name="ln-2293"></a>
<a name="ln-2294"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorDGDivergence_3D_gpu</span>
<a name="ln-2295"></a>  <span class="c">! /////////////////////////////// !</span>
<a name="ln-2296"></a>  <span class="c">! Boundary Interpolation Routines !</span>
<a name="ln-2297"></a>
<a name="ln-2298"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarBoundaryInterp_1D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2299"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2300"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2301"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2302"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2303"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">fBound</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2304"></a>    <span class="c">! Local</span>
<a name="ln-2305"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2306"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2307"></a>
<a name="ln-2308"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2309"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2310"></a>        <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2311"></a>        <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2312"></a>          <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! West</span>
<a name="ln-2313"></a>          <span class="n">fb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! East</span>
<a name="ln-2314"></a>        <span class="k">END DO</span>
<a name="ln-2315"></a><span class="k">        </span><span class="n">fBound</span><span class="p">(</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-2316"></a>      <span class="k">END DO</span>
<a name="ln-2317"></a><span class="k">    END DO</span>
<a name="ln-2318"></a>
<a name="ln-2319"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_1D_cpu</span>
<a name="ln-2320"></a>
<a name="ln-2321"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarBoundaryInterp_1D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2322"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2323"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2324"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2325"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span>
<a name="ln-2326"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span>
<a name="ln-2327"></a>
<a name="ln-2328"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2329"></a>    <span class="k">CALL </span><span class="n">ScalarBoundaryInterp_1D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2330"></a>                                             <span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2331"></a><span class="cp">#endif                                     </span>
<a name="ln-2332"></a>
<a name="ln-2333"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_1D_gpu</span>
<a name="ln-2334"></a>
<a name="ln-2335"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarBoundaryInterp_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2336"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2337"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2338"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2339"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2340"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">fBound</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2341"></a>    <span class="c">! Local</span>
<a name="ln-2342"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2343"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2344"></a>
<a name="ln-2345"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2346"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2347"></a>        <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2348"></a>
<a name="ln-2349"></a>          <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2350"></a>
<a name="ln-2351"></a>          <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2352"></a>            <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! South</span>
<a name="ln-2353"></a>            <span class="n">fb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! East</span>
<a name="ln-2354"></a>            <span class="n">fb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! North</span>
<a name="ln-2355"></a>            <span class="n">fb</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! West</span>
<a name="ln-2356"></a>          <span class="k">END DO</span>
<a name="ln-2357"></a>
<a name="ln-2358"></a><span class="k">          </span><span class="n">fBound</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2359"></a>
<a name="ln-2360"></a>        <span class="k">END DO</span>
<a name="ln-2361"></a><span class="k">      END DO</span>
<a name="ln-2362"></a><span class="k">    END DO</span>
<a name="ln-2363"></a>
<a name="ln-2364"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_2D_cpu</span>
<a name="ln-2365"></a>
<a name="ln-2366"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarBoundaryInterp_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2367"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2368"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2369"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2370"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span>
<a name="ln-2371"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span>
<a name="ln-2372"></a>
<a name="ln-2373"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2374"></a>    <span class="k">CALL </span><span class="n">ScalarBoundaryInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2375"></a>                                             <span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2376"></a><span class="cp">#endif                                     </span>
<a name="ln-2377"></a>
<a name="ln-2378"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_2D_gpu</span>
<a name="ln-2379"></a>
<a name="ln-2380"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorBoundaryInterp_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2381"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2382"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2383"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2384"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2385"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2386"></a>    <span class="c">! Local</span>
<a name="ln-2387"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">idir</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2388"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2389"></a>
<a name="ln-2390"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2391"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2392"></a>        <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2393"></a>
<a name="ln-2394"></a>          <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2395"></a>          <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2396"></a>            <span class="k">DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-2397"></a>              <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! South</span>
<a name="ln-2398"></a>              <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! East</span>
<a name="ln-2399"></a>              <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! North</span>
<a name="ln-2400"></a>              <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! West</span>
<a name="ln-2401"></a>            <span class="k">END DO</span>
<a name="ln-2402"></a><span class="k">          END DO</span>
<a name="ln-2403"></a>
<a name="ln-2404"></a><span class="k">          DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-2405"></a>            <span class="n">fBound</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2406"></a>          <span class="k">END DO</span>
<a name="ln-2407"></a>
<a name="ln-2408"></a><span class="k">        END DO</span>
<a name="ln-2409"></a><span class="k">      END DO</span>
<a name="ln-2410"></a><span class="k">    END DO</span>
<a name="ln-2411"></a>
<a name="ln-2412"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorBoundaryInterp_2D_cpu</span>
<a name="ln-2413"></a>
<a name="ln-2414"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorBoundaryInterp_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2415"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2416"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2417"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2418"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span>
<a name="ln-2419"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span>
<a name="ln-2420"></a>
<a name="ln-2421"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2422"></a>    <span class="k">CALL </span><span class="n">VectorBoundaryInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2423"></a>                                             <span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2424"></a><span class="cp">#endif                                     </span>
<a name="ln-2425"></a>
<a name="ln-2426"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorBoundaryInterp_2D_gpu</span>
<a name="ln-2427"></a>
<a name="ln-2428"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorBoundaryInterp_2D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2429"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2430"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2431"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2432"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2433"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2434"></a>    <span class="c">! Local</span>
<a name="ln-2435"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2436"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2437"></a>
<a name="ln-2438"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2439"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2440"></a>        <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2441"></a>
<a name="ln-2442"></a>          <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2443"></a>          <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2444"></a>            <span class="k">DO </span><span class="n">jdir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-2445"></a>              <span class="k">DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-2446"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! South</span>
<a name="ln-2447"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! East</span>
<a name="ln-2448"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! North</span>
<a name="ln-2449"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! West</span>
<a name="ln-2450"></a>              <span class="k">END DO</span>
<a name="ln-2451"></a><span class="k">            END DO</span>
<a name="ln-2452"></a><span class="k">          END DO</span>
<a name="ln-2453"></a>
<a name="ln-2454"></a><span class="k">          DO </span><span class="n">jdir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-2455"></a>            <span class="k">DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-2456"></a>              <span class="n">fBound</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-2457"></a>            <span class="k">END DO</span>
<a name="ln-2458"></a><span class="k">          END DO</span>
<a name="ln-2459"></a>
<a name="ln-2460"></a><span class="k">        END DO</span>
<a name="ln-2461"></a><span class="k">      END DO</span>
<a name="ln-2462"></a><span class="k">    END DO</span>
<a name="ln-2463"></a>
<a name="ln-2464"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorBoundaryInterp_2D_cpu</span>
<a name="ln-2465"></a>
<a name="ln-2466"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorBoundaryInterp_2D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2467"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2468"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2469"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2470"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span>
<a name="ln-2471"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span>
<a name="ln-2472"></a>
<a name="ln-2473"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2474"></a>    <span class="k">CALL </span><span class="n">TensorBoundaryInterp_2D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2475"></a>                                             <span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2476"></a><span class="cp">#endif                                     </span>
<a name="ln-2477"></a>
<a name="ln-2478"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorBoundaryInterp_2D_gpu</span>
<a name="ln-2479"></a>
<a name="ln-2480"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarBoundaryInterp_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2481"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2482"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2483"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2484"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2485"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">fBound</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2486"></a>    <span class="c">! Local</span>
<a name="ln-2487"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2488"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2489"></a>
<a name="ln-2490"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2491"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2492"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2493"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2494"></a>
<a name="ln-2495"></a>            <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2496"></a>
<a name="ln-2497"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2498"></a>              <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! Bottom</span>
<a name="ln-2499"></a>              <span class="n">fb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! South</span>
<a name="ln-2500"></a>              <span class="n">fb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! East</span>
<a name="ln-2501"></a>              <span class="n">fb</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! North</span>
<a name="ln-2502"></a>              <span class="n">fb</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! West</span>
<a name="ln-2503"></a>              <span class="n">fb</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! Top</span>
<a name="ln-2504"></a>            <span class="k">END DO</span>
<a name="ln-2505"></a>
<a name="ln-2506"></a><span class="k">            </span><span class="n">fBound</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2507"></a>
<a name="ln-2508"></a>          <span class="k">END DO</span>
<a name="ln-2509"></a><span class="k">        END DO</span>
<a name="ln-2510"></a><span class="k">      END DO</span>
<a name="ln-2511"></a><span class="k">    END DO</span>
<a name="ln-2512"></a>
<a name="ln-2513"></a><span class="k">  END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_3D_cpu</span>
<a name="ln-2514"></a>
<a name="ln-2515"></a>  <span class="k">SUBROUTINE </span><span class="n">ScalarBoundaryInterp_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2516"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2517"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2518"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2519"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span>
<a name="ln-2520"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span>
<a name="ln-2521"></a>
<a name="ln-2522"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2523"></a>    <span class="k">CALL </span><span class="n">ScalarBoundaryInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2524"></a>                                             <span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2525"></a><span class="cp">#endif                                     </span>
<a name="ln-2526"></a>
<a name="ln-2527"></a>  <span class="k">END SUBROUTINE </span><span class="n">ScalarBoundaryInterp_3D_gpu</span>
<a name="ln-2528"></a>
<a name="ln-2529"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorBoundaryInterp_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2530"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2531"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2532"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2533"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2534"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2535"></a>    <span class="c">! Local</span>
<a name="ln-2536"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">idir</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2537"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2538"></a>
<a name="ln-2539"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2540"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2541"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2542"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2543"></a>
<a name="ln-2544"></a>            <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2545"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2546"></a>              <span class="k">DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-2547"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! Bottom</span>
<a name="ln-2548"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! South</span>
<a name="ln-2549"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! East</span>
<a name="ln-2550"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! North</span>
<a name="ln-2551"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! West</span>
<a name="ln-2552"></a>                <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! Top</span>
<a name="ln-2553"></a>              <span class="k">END DO</span>
<a name="ln-2554"></a><span class="k">            END DO</span>
<a name="ln-2555"></a>
<a name="ln-2556"></a><span class="k">            DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-2557"></a>              <span class="n">fBound</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2558"></a>            <span class="k">END DO</span>
<a name="ln-2559"></a>
<a name="ln-2560"></a><span class="k">          END DO</span>
<a name="ln-2561"></a><span class="k">        END DO</span>
<a name="ln-2562"></a><span class="k">      END DO</span>
<a name="ln-2563"></a><span class="k">    END DO</span>
<a name="ln-2564"></a>
<a name="ln-2565"></a><span class="k">  END SUBROUTINE </span><span class="n">VectorBoundaryInterp_3D_cpu</span>
<a name="ln-2566"></a>
<a name="ln-2567"></a>  <span class="k">SUBROUTINE </span><span class="n">VectorBoundaryInterp_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2568"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2569"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2570"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2571"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span>
<a name="ln-2572"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span>
<a name="ln-2573"></a>
<a name="ln-2574"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2575"></a>    <span class="k">CALL </span><span class="n">VectorBoundaryInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2576"></a>                                             <span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2577"></a><span class="cp">#endif                                     </span>
<a name="ln-2578"></a>
<a name="ln-2579"></a>  <span class="k">END SUBROUTINE </span><span class="n">VectorBoundaryInterp_3D_gpu</span>
<a name="ln-2580"></a>
<a name="ln-2581"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorBoundaryInterp_3D_cpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2582"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2583"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2584"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2585"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2586"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nVariables</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2587"></a>    <span class="c">! Local</span>
<a name="ln-2588"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span>
<a name="ln-2589"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2590"></a>
<a name="ln-2591"></a>    <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2592"></a>      <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">nVariables</span>
<a name="ln-2593"></a>        <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2594"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2595"></a>
<a name="ln-2596"></a>            <span class="n">fb</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2597"></a>            <span class="k">DO </span><span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2598"></a>              <span class="k">DO </span><span class="n">jdir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-2599"></a>                <span class="k">DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-2600"></a>                  <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! Bottom</span>
<a name="ln-2601"></a>                  <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! South</span>
<a name="ln-2602"></a>                  <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! East</span>
<a name="ln-2603"></a>                  <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! North</span>
<a name="ln-2604"></a>                  <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! West</span>
<a name="ln-2605"></a>                  <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ii</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="c">! Top</span>
<a name="ln-2606"></a>                <span class="k">END DO</span>
<a name="ln-2607"></a><span class="k">              END DO</span>
<a name="ln-2608"></a><span class="k">            END DO</span>
<a name="ln-2609"></a>
<a name="ln-2610"></a><span class="k">            DO </span><span class="n">jdir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-2611"></a>              <span class="k">DO </span><span class="n">idir</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-2612"></a>                <span class="n">fBound</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">fb</span><span class="p">(</span><span class="n">idir</span><span class="p">,</span><span class="n">jdir</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span>
<a name="ln-2613"></a>              <span class="k">END DO</span>
<a name="ln-2614"></a><span class="k">            END DO</span>
<a name="ln-2615"></a>
<a name="ln-2616"></a><span class="k">          END DO</span>
<a name="ln-2617"></a><span class="k">        END DO</span>
<a name="ln-2618"></a><span class="k">      END DO</span>
<a name="ln-2619"></a><span class="k">    END DO</span>
<a name="ln-2620"></a>
<a name="ln-2621"></a><span class="k">  END SUBROUTINE </span><span class="n">TensorBoundaryInterp_3D_cpu</span>
<a name="ln-2622"></a>
<a name="ln-2623"></a>  <span class="k">SUBROUTINE </span><span class="n">TensorBoundaryInterp_3D_gpu</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2624"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2625"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2626"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span>
<a name="ln-2627"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">f</span>
<a name="ln-2628"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="kt">c_ptr</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">fBound</span>
<a name="ln-2629"></a>
<a name="ln-2630"></a><span class="cp">#ifdef GPU</span>
<a name="ln-2631"></a>    <span class="k">CALL </span><span class="n">TensorBoundaryInterp_3D_gpu_wrapper</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bMatrix</span> <span class="p">%</span> <span class="n">deviceData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-2632"></a>                                             <span class="n">f</span><span class="p">,</span><span class="n">fBound</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="n">nVariables</span><span class="p">,</span><span class="n">nElements</span><span class="p">)</span>
<a name="ln-2633"></a><span class="cp">#endif                                     </span>
<a name="ln-2634"></a>
<a name="ln-2635"></a>  <span class="k">END SUBROUTINE </span><span class="n">TensorBoundaryInterp_3D_gpu</span>
<a name="ln-2636"></a>
<a name="ln-2637"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2638"></a><span class="c">!</span>
<a name="ln-2639"></a><span class="c">! CalculateBarycentricWeights (PRIVATE)</span>
<a name="ln-2640"></a><span class="c">!</span>
<a name="ln-2641"></a><span class="c">!   A PRIVATE routine that calculates and stores the barycentric weights for the Lagrange</span>
<a name="ln-2642"></a><span class="c">!   data-structure.</span>
<a name="ln-2643"></a><span class="c">!</span>
<a name="ln-2644"></a><span class="c">!   This routine is from Alg. 30 on pg. 75 of D.A. Kopriva, 2009.</span>
<a name="ln-2645"></a><span class="c">!</span>
<a name="ln-2646"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2647"></a>
<a name="ln-2648"></a>  <span class="k">SUBROUTINE </span><span class="n">CalculateBarycentricWeights</span><span class="p">(</span><span class="n">myPoly</span><span class="p">)</span>
<a name="ln-2649"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2650"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2651"></a>    <span class="c">! Local</span>
<a name="ln-2652"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span>
<a name="ln-2653"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bWeights</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2654"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">controlPoints</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2655"></a>
<a name="ln-2656"></a>    <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2657"></a>      <span class="n">bWeights</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0_real64</span>
<a name="ln-2658"></a>      <span class="n">controlPoints</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2659"></a>    <span class="k">END DO</span>
<a name="ln-2660"></a>
<a name="ln-2661"></a>    <span class="c">! Computes the product w_k = w_k*(s_k - s_j), k /= j</span>
<a name="ln-2662"></a>    <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2663"></a>      <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2664"></a>
<a name="ln-2665"></a>        <span class="n">bWeights</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">bWeights</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">controlPoints</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="n">controlPoints</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a name="ln-2666"></a>        <span class="n">bWeights</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">bWeights</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">controlPoints</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">controlPoints</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-2667"></a>
<a name="ln-2668"></a>      <span class="k">END DO</span>
<a name="ln-2669"></a><span class="k">    END DO</span>
<a name="ln-2670"></a>
<a name="ln-2671"></a><span class="k">    DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2672"></a>      <span class="n">bWeights</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0_prec</span><span class="o">/</span><span class="n">bWeights</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-2673"></a>      <span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">bWeights</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">prec</span><span class="p">)</span>
<a name="ln-2674"></a>    <span class="k">END DO</span>
<a name="ln-2675"></a>
<a name="ln-2676"></a><span class="k">  END SUBROUTINE </span><span class="n">CalculateBarycentricWeights</span>
<a name="ln-2677"></a>
<a name="ln-2678"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2679"></a><span class="c">!</span>
<a name="ln-2680"></a><span class="c">! CalculateInterpolationMatrix (PRIVATE)</span>
<a name="ln-2681"></a><span class="c">!</span>
<a name="ln-2682"></a><span class="c">!   A PRIVATE routine that fills in the interpolation matrix for the Lagrange data structure.</span>
<a name="ln-2683"></a><span class="c">!</span>
<a name="ln-2684"></a><span class="c">!   This function is from Alg. 32 on pg. 76 of D.A. Kopriva, 2009.</span>
<a name="ln-2685"></a><span class="c">!</span>
<a name="ln-2686"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2687"></a>
<a name="ln-2688"></a>  <span class="k">SUBROUTINE </span><span class="n">CalculateInterpolationMatrix</span><span class="p">(</span><span class="n">myPoly</span><span class="p">)</span>
<a name="ln-2689"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2690"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2691"></a>    <span class="c">! Local</span>
<a name="ln-2692"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">row</span><span class="p">,</span><span class="n">col</span>
<a name="ln-2693"></a>    <span class="kt">LOGICAL</span>    <span class="kd">::</span> <span class="n">rowHasMatch</span>
<a name="ln-2694"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">temp1</span><span class="p">,</span><span class="n">temp2</span>
<a name="ln-2695"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iMatrix</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">)</span>
<a name="ln-2696"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bWeights</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2697"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">controlPoints</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2698"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">targetPoints</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">M</span><span class="p">)</span>
<a name="ln-2699"></a>
<a name="ln-2700"></a>    <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2701"></a>      <span class="n">controlPoints</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">col</span><span class="p">),</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2702"></a>      <span class="n">bWeights</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">col</span><span class="p">),</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2703"></a>    <span class="k">END DO</span>
<a name="ln-2704"></a><span class="k">    DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-2705"></a>      <span class="n">targetPoints</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">targetPoints</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">),</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2706"></a>    <span class="k">END DO</span>
<a name="ln-2707"></a>
<a name="ln-2708"></a><span class="k">    DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-2709"></a>
<a name="ln-2710"></a>      <span class="n">rowHasMatch</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2711"></a>
<a name="ln-2712"></a>      <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2713"></a>
<a name="ln-2714"></a>        <span class="n">iMatrix</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_real64</span>
<a name="ln-2715"></a>
<a name="ln-2716"></a>        <span class="k">IF</span> <span class="p">(</span><span class="n">AlmostEqual</span><span class="p">(</span><span class="n">targetPoints</span><span class="p">(</span><span class="n">row</span><span class="p">),</span><span class="n">controlPoints</span><span class="p">(</span><span class="n">col</span><span class="p">)))</span> <span class="k">THEN</span>
<a name="ln-2717"></a><span class="k">          </span><span class="n">rowHasMatch</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2718"></a>          <span class="n">iMatrix</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0_real64</span>
<a name="ln-2719"></a>        <span class="k">END IF</span>
<a name="ln-2720"></a>
<a name="ln-2721"></a><span class="k">      END DO</span>
<a name="ln-2722"></a>
<a name="ln-2723"></a><span class="k">      IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="p">(</span><span class="n">rowHasMatch</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2724"></a>
<a name="ln-2725"></a><span class="k">        </span><span class="n">temp1</span> <span class="o">=</span> <span class="mf">0.0_real64</span>
<a name="ln-2726"></a>
<a name="ln-2727"></a>        <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2728"></a>          <span class="n">temp2</span> <span class="o">=</span> <span class="n">bWeights</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-2729"></a>                  <span class="p">(</span><span class="n">targetPoints</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-2730"></a>                   <span class="n">controlPoints</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
<a name="ln-2731"></a>          <span class="n">iMatrix</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="n">temp2</span>
<a name="ln-2732"></a>          <span class="n">temp1</span> <span class="o">=</span> <span class="n">temp1</span> <span class="o">+</span> <span class="n">temp2</span>
<a name="ln-2733"></a>        <span class="k">END DO</span>
<a name="ln-2734"></a>
<a name="ln-2735"></a><span class="k">        DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2736"></a>          <span class="n">iMatrix</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="n">iMatrix</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span><span class="o">/</span><span class="n">temp1</span>
<a name="ln-2737"></a>        <span class="k">END DO</span>
<a name="ln-2738"></a>
<a name="ln-2739"></a><span class="k">      END IF</span>
<a name="ln-2740"></a>
<a name="ln-2741"></a><span class="k">    END DO</span>
<a name="ln-2742"></a>
<a name="ln-2743"></a><span class="k">    DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">M</span>
<a name="ln-2744"></a>      <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2745"></a>        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">iMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">iMatrix</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">),</span><span class="n">prec</span><span class="p">)</span>
<a name="ln-2746"></a>      <span class="k">ENDDO</span>
<a name="ln-2747"></a><span class="k">    ENDDO</span>
<a name="ln-2748"></a>
<a name="ln-2749"></a><span class="k">  END SUBROUTINE </span><span class="n">CalculateInterpolationMatrix</span>
<a name="ln-2750"></a>
<a name="ln-2751"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2752"></a><span class="c">!</span>
<a name="ln-2753"></a><span class="c">! CalculateDerivativeMatrix (PRIVATE)</span>
<a name="ln-2754"></a><span class="c">!</span>
<a name="ln-2755"></a><span class="c">!   Calculates and stores the derivative matrix and its transpose.</span>
<a name="ln-2756"></a><span class="c">!   Generates a matrix that can be used to approximate derivatives at the interpolation nodes.</span>
<a name="ln-2757"></a><span class="c">!</span>
<a name="ln-2758"></a><span class="c">!   This function is from Alg. 37 on pg. 82 of D.A. Kopriva, 2009.</span>
<a name="ln-2759"></a><span class="c">!</span>
<a name="ln-2760"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2761"></a>
<a name="ln-2762"></a>  <span class="k">SUBROUTINE </span><span class="n">CalculateDerivativeMatrix</span><span class="p">(</span><span class="n">myPoly</span><span class="p">)</span>
<a name="ln-2763"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2764"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2765"></a>    <span class="c">! Local</span>
<a name="ln-2766"></a>    <span class="kt">INTEGER</span>      <span class="kd">::</span> <span class="n">row</span><span class="p">,</span><span class="n">col</span>
<a name="ln-2767"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dmat</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">)</span>
<a name="ln-2768"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dgmat</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">)</span>
<a name="ln-2769"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bWeights</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2770"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qWeights</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2771"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">controlPoints</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2772"></a>
<a name="ln-2773"></a>    <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2774"></a>      <span class="n">bWeights</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">real64</span><span class="p">)</span>
<a name="ln-2775"></a>      <span class="n">qWeights</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">qWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">real64</span><span class="p">)</span>
<a name="ln-2776"></a>      <span class="n">controlPoints</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">),</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2777"></a>    <span class="k">END DO</span>
<a name="ln-2778"></a>
<a name="ln-2779"></a><span class="k">    DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2780"></a>
<a name="ln-2781"></a>      <span class="n">dmat</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_prec</span>
<a name="ln-2782"></a>
<a name="ln-2783"></a>      <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2784"></a>
<a name="ln-2785"></a>        <span class="k">IF</span> <span class="p">(.</span><span class="nb">NOT</span><span class="p">.</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">row</span><span class="p">))</span> <span class="k">THEN</span>
<a name="ln-2786"></a>
<a name="ln-2787"></a><span class="k">          </span><span class="n">dmat</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="n">bWeights</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">/</span> <span class="p">&amp;</span>
<a name="ln-2788"></a>                          <span class="p">(</span><span class="n">bWeights</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-2789"></a>                           <span class="p">(</span><span class="n">controlPoints</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">-</span> <span class="p">&amp;</span>
<a name="ln-2790"></a>                            <span class="n">controlPoints</span><span class="p">(</span><span class="n">col</span><span class="p">)))</span>
<a name="ln-2791"></a>
<a name="ln-2792"></a>          <span class="n">dmat</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="o">=</span> <span class="n">dmat</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="o">-</span> <span class="n">dmat</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
<a name="ln-2793"></a>
<a name="ln-2794"></a>        <span class="k">END IF</span>
<a name="ln-2795"></a>
<a name="ln-2796"></a><span class="k">      END DO</span>
<a name="ln-2797"></a>
<a name="ln-2798"></a><span class="k">    END DO</span>
<a name="ln-2799"></a>
<a name="ln-2800"></a><span class="k">    DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2801"></a>      <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2802"></a>        <span class="n">dgmat</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">dmat</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="p">)</span><span class="o">*</span><span class="p">&amp;</span>
<a name="ln-2803"></a>                          <span class="n">qWeights</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-2804"></a>                          <span class="n">qWeights</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a name="ln-2805"></a>      <span class="k">ENDDO</span>
<a name="ln-2806"></a><span class="k">    ENDDO</span>
<a name="ln-2807"></a>
<a name="ln-2808"></a><span class="k">    DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2809"></a>      <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2810"></a>        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">dmat</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="p">),</span><span class="n">prec</span><span class="p">)</span>
<a name="ln-2811"></a>        <span class="n">myPoly</span> <span class="p">%</span> <span class="n">dgMatrix</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">dgmat</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="p">),</span><span class="n">prec</span><span class="p">)</span>
<a name="ln-2812"></a>      <span class="k">ENDDO</span>
<a name="ln-2813"></a><span class="k">    ENDDO</span>
<a name="ln-2814"></a>
<a name="ln-2815"></a><span class="k">  END SUBROUTINE </span><span class="n">CalculateDerivativeMatrix</span>
<a name="ln-2816"></a>
<a name="ln-2817"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2818"></a><span class="c">!</span>
<a name="ln-2819"></a><span class="c">! CalculateLagrangePolynomials</span>
<a name="ln-2820"></a><span class="c">!</span>
<a name="ln-2821"></a><span class="c">!   Evaluates each of the 1-D Lagrange interpolating polynomials at a specified point.</span>
<a name="ln-2822"></a><span class="c">!</span>
<a name="ln-2823"></a><span class="c">!   This function is from Alg. 34 on pg. 77 of D.A. Kopriva, 2009.</span>
<a name="ln-2824"></a><span class="c">!</span>
<a name="ln-2825"></a><span class="c">! ================================================================================================ !</span>
<a name="ln-2826"></a>
<a name="ln-2827"></a>  <span class="k">FUNCTION </span><span class="n">CalculateLagrangePolynomials</span><span class="p">(</span><span class="n">myPoly</span><span class="p">,</span><span class="n">sE</span><span class="p">)</span> <span class="k">RESULT</span><span class="p">(</span><span class="n">lAtS</span><span class="p">)</span>
<a name="ln-2828"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-2829"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">Lagrange</span><span class="p">)</span> <span class="kd">::</span> <span class="n">myPoly</span>
<a name="ln-2830"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">sE</span>
<a name="ln-2831"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">prec</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">lAtS</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span><span class="p">)</span>
<a name="ln-2832"></a>    <span class="c">! Local</span>
<a name="ln-2833"></a>    <span class="kt">INTEGER</span>    <span class="kd">::</span> <span class="n">j</span>
<a name="ln-2834"></a>    <span class="kt">LOGICAL</span>    <span class="kd">::</span> <span class="n">xMatchesNode</span>
<a name="ln-2835"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">temp1</span><span class="p">,</span><span class="n">temp2</span>
<a name="ln-2836"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sELocal</span>
<a name="ln-2837"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">controlPoints</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2838"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">bWeights</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2839"></a>    <span class="kt">REAL</span><span class="p">(</span><span class="n">real64</span><span class="p">)</span> <span class="kd">::</span> <span class="n">lS</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">myPoly</span><span class="p">%</span><span class="n">N</span><span class="p">)</span>
<a name="ln-2840"></a>
<a name="ln-2841"></a>    <span class="n">sELocal</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">sE</span><span class="p">,</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2842"></a>    <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2843"></a>      <span class="n">controlPoints</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">controlPoints</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2844"></a>      <span class="n">bWeights</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">bWeights</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">real64</span><span class="p">)</span>
<a name="ln-2845"></a>    <span class="k">END DO</span>
<a name="ln-2846"></a>
<a name="ln-2847"></a><span class="k">    </span><span class="n">xMatchesNode</span> <span class="o">=</span> <span class="p">.</span><span class="n">FALSE</span><span class="p">.</span>
<a name="ln-2848"></a>
<a name="ln-2849"></a>    <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2850"></a>
<a name="ln-2851"></a>      <span class="n">lS</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0_real64</span>
<a name="ln-2852"></a>
<a name="ln-2853"></a>      <span class="k">IF</span> <span class="p">(</span><span class="n">AlmostEqual</span><span class="p">(</span><span class="n">sELocal</span><span class="p">,</span><span class="n">controlPoints</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span> <span class="k">THEN</span>
<a name="ln-2854"></a><span class="k">        </span><span class="n">lS</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.0_real64</span>
<a name="ln-2855"></a>        <span class="n">xMatchesNode</span> <span class="o">=</span> <span class="p">.</span><span class="n">TRUE</span><span class="p">.</span>
<a name="ln-2856"></a>      <span class="k">END IF</span>
<a name="ln-2857"></a>
<a name="ln-2858"></a><span class="k">    END DO</span>
<a name="ln-2859"></a>
<a name="ln-2860"></a><span class="k">    IF</span> <span class="p">(</span><span class="n">xMatchesNode</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-2861"></a><span class="k">      RETURN</span>
<a name="ln-2862"></a><span class="k">    END IF</span>
<a name="ln-2863"></a>
<a name="ln-2864"></a><span class="k">    </span><span class="n">temp1</span> <span class="o">=</span> <span class="mf">0.0_real64</span>
<a name="ln-2865"></a>
<a name="ln-2866"></a>    <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2867"></a>      <span class="n">temp2</span> <span class="o">=</span> <span class="n">bWeights</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sE</span> <span class="o">-</span> <span class="n">controlPoints</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a name="ln-2868"></a>      <span class="n">lS</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">temp2</span>
<a name="ln-2869"></a>      <span class="n">temp1</span> <span class="o">=</span> <span class="n">temp1</span> <span class="o">+</span> <span class="n">temp2</span>
<a name="ln-2870"></a>    <span class="k">END DO</span>
<a name="ln-2871"></a>
<a name="ln-2872"></a><span class="k">    </span><span class="n">lS</span> <span class="o">=</span> <span class="n">lS</span><span class="o">/</span><span class="n">temp1</span>
<a name="ln-2873"></a>
<a name="ln-2874"></a>    <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">myPoly</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-2875"></a>      <span class="n">lAtS</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="kt">REAL</span><span class="p">(</span><span class="n">lS</span><span class="p">(</span><span class="n">j</span><span class="p">),</span><span class="n">prec</span><span class="p">)</span>
<a name="ln-2876"></a>    <span class="k">ENDDO</span>
<a name="ln-2877"></a>
<a name="ln-2878"></a><span class="k">  END FUNCTION </span><span class="n">CalculateLagrangePolynomials</span>
<a name="ln-2879"></a>
<a name="ln-2880"></a><span class="k">END MODULE </span><span class="n">SELF_Lagrange</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2021 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2021-04-14 00:34  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SELF was developed by Joe Schoonover</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>