<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Spectral Element Libraries in Fortran. Fortran classes for implementing spectral element methods on CPU and GPU hardware.">
    
    <meta name="author" content="Joe Schoonover" >
    <link rel="icon" href="../favicon.png">

    <title>SELF_MappedData.f90 &ndash; SELF</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">SELF </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/self.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/self.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>SELF_MappedData.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 7.3% of total for source files.">587 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/SELF_MappedData.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">SELF_MappedData.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/self_mappeddata.html">SELF_MappedData</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/self_mappeddata.f90.html#src">SELF_MappedData.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~self_mappeddata.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileself_mappeddataf90EfferentGraph" width="641pt" height="131pt"
 viewBox="0.00 0.00 641.00 130.87" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph" class="graph" transform="scale(.6205 .6205) rotate(0) translate(4 206.9022)">
<title>sourcefile~~self_mappeddata.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-206.9022 1029,-206.9022 1029,4 -4,4"/>
<!-- sourcefile~self_mappeddata.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~self_mappeddata.f90</title>
<polygon fill="none" stroke="#000000" points="1025,-79.1304 893,-79.1304 893,-55.1304 1025,-55.1304 1025,-79.1304"/>
<text text-anchor="middle" x="959" y="-64.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">SELF_MappedData.f90</text>
</g>
<!-- sourcefile~self_geometry.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~self_geometry.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/self_geometry.f90.html" xlink:title="SELF_Geometry.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="857,-118.1304 742,-118.1304 742,-94.1304 857,-94.1304 857,-118.1304"/>
<text text-anchor="middle" x="799.5" y="-103.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Geometry.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_geometry.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_geometry.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M909.8433,-79.1499C893.6219,-83.1162 875.4101,-87.5693 858.5293,-91.6969"/>
<polygon fill="#ff0000" stroke="#ff0000" points="857.6515,-88.3083 848.769,-94.0834 859.3142,-95.108 857.6515,-88.3083"/>
</g>
<!-- sourcefile~self_data.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~self_data.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/self_data.f90.html" xlink:title="SELF_Data.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="579,-59.1304 490,-59.1304 490,-35.1304 579,-35.1304 579,-59.1304"/>
<text text-anchor="middle" x="534.5" y="-44.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Data.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M660.5,-47.1304C637.2501,-45.2966 611.5119,-44.9903 589.3905,-45.2571"/>
<polygon fill="#ff0000" stroke="#ff0000" points="589.1184,-41.761 579.1767,-45.4233 589.2323,-48.7601 589.1184,-41.761"/>
</g>
<!-- sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~self_mesh.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/self_mesh.f90.html" xlink:title="SELF_Mesh.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="706,-137.1304 615,-137.1304 615,-113.1304 706,-113.1304 706,-137.1304"/>
<text text-anchor="middle" x="660.5" y="-122.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Mesh.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_mesh.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M799.5,-47.1304C752.1893,-50.6568 705.9045,-84.4436 680.4909,-106.3779"/>
<polygon fill="#ff0000" stroke="#ff0000" points="678.1529,-103.7732 672.9982,-113.0295 682.8001,-109.008 678.1529,-103.7732"/>
</g>
<!-- sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~self_lagrange.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/self_lagrange.f90.html" xlink:title="SELF_Lagrange.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="454,-59.1304 339,-59.1304 339,-35.1304 454,-35.1304 454,-59.1304"/>
<text text-anchor="middle" x="396.5" y="-44.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Lagrange.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M534.5,-7.1304C515.7757,-5.5965 471.3083,-19.7164 437.8751,-31.5996"/>
<polygon fill="#ff0000" stroke="#ff0000" points="436.5549,-28.355 428.3322,-35.0361 438.9266,-34.941 436.5549,-28.355"/>
</g>
<!-- sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~self_constants.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/self_constants.f90.html" xlink:title="SELF_Constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="116,-101.1304 0,-101.1304 0,-77.1304 116,-77.1304 116,-101.1304"/>
<text text-anchor="middle" x="58" y="-86.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~self_mappeddata.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M905.6041,-55.0726C874.6867,-49.4361 834.984,-44.4855 799.5,-47.1304"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M799.5,-47.1304C737.8931,-51.7225 722.0865,-51.9878 660.5,-47.1304"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M660.5,-47.1304C601.9278,-42.5107 593.058,-11.9274 534.5,-7.1304"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M534.5,-7.1304C473.3714,-2.1228 457.6746,-11.5403 396.5,-7.1304"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M396.5,-7.1304C321.5833,-1.7298 301.5737,5.3101 227.5,-7.1304"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M227.5,-7.1304C193.3761,-12.8614 183.6157,-12.0687 152,-26.1304 125.93,-37.7255 99.1859,-56.4411 80.9233,-70.466"/>
<polygon fill="#ff0000" stroke="#ff0000" points="78.3942,-68.001 72.6794,-76.9224 82.7104,-73.512 78.3942,-68.001"/>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M745.5539,-94.1197C699.9698,-83.9708 634.972,-69.4996 589.1809,-59.3046"/>
<polygon fill="#ff0000" stroke="#ff0000" points="589.6593,-55.8255 579.1376,-57.0686 588.138,-62.6582 589.6593,-55.8255"/>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_mesh.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_mesh.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M741.7591,-114.023C733.3805,-115.1683 724.7671,-116.3457 716.4252,-117.4859"/>
<polygon fill="#ff0000" stroke="#ff0000" points="715.8524,-114.0316 706.4186,-118.8537 716.8005,-120.9671 715.8524,-114.0316"/>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M785.3406,-118.2582C761.5137,-137.6182 711.0354,-174.2354 660.5,-183.1304"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M660.5,-183.1304C559.132,-200.9726 455.3182,-108.2833 414.5169,-66.6015"/>
<polygon fill="#ff0000" stroke="#ff0000" points="416.8814,-64.0106 407.4309,-59.2214 411.8321,-68.8588 416.8814,-64.0106"/>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M534.5,-201.1304C473.2536,-197.8663 457.8157,-202.601 396.5,-201.1304"/>
</g>
<!-- sourcefile~self_supportroutines.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~self_supportroutines.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/self_supportroutines.f90.html" xlink:title="SELF_SupportRoutines.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="303,-143.1304 152,-143.1304 152,-119.1304 303,-119.1304 303,-143.1304"/>
<text text-anchor="middle" x="227.5" y="-128.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_SupportRoutines.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_supportroutines.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~self_geometry.f90&#45;&gt;sourcefile~self_supportroutines.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M660.5,-183.1304C605.4101,-195.9797 590.9884,-204.1409 534.5,-201.1304"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M534.5,-201.1304C465.8248,-197.4703 465.1968,-134.359 396.5,-131.1304"/>
</g>
<!-- sourcefile~self_data.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~self_data.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M489.6954,-47.1304C481.5498,-47.1304 472.8891,-47.1304 464.2544,-47.1304"/>
<polygon fill="#cbff00" stroke="#cbff00" points="464.1625,-43.6305 454.1624,-47.1304 464.1624,-50.6305 464.1625,-43.6305"/>
</g>
<!-- sourcefile~self_data.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~self_data.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M506.0731,-35.0743C478.6153,-24.3528 435.5615,-9.9462 396.5,-7.1304"/>
</g>
<!-- sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_data.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_data.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M638.0008,-112.9002C630.5763,-108.6994 622.3423,-103.8606 615,-99.1304 598.4085,-88.4415 595.5399,-83.899 579,-73.1304 574.522,-70.2149 569.7116,-67.2447 564.9676,-64.4041"/>
<polygon fill="#00ff66" stroke="#00ff66" points="566.4257,-61.2013 556.0314,-59.1496 562.8776,-67.2354 566.4257,-61.2013"/>
</g>
<!-- sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_lagrange.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_lagrange.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M630.026,-113.0526C604.8684,-103.7901 567.9882,-91.8226 534.5,-87.1304"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M534.5,-87.1304C501.2781,-82.4754 464.8771,-71.6724 437.8054,-62.4655"/>
<polygon fill="#00ff66" stroke="#00ff66" points="438.8717,-59.1308 428.2769,-59.16 436.5774,-65.7442 438.8717,-59.1308"/>
</g>
<!-- sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M633.0734,-137.2297C585.8664,-157.0894 485.7185,-195.0174 396.5,-201.1304"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M396.5,-201.1304C285.8244,-206.9289 254.3308,-194.6878 152,-152.1304 125.4993,-141.1092 98.632,-122.1497 80.4471,-107.9016"/>
<polygon fill="#00ff66" stroke="#00ff66" points="82.25,-104.8613 72.2571,-101.341 77.8736,-110.3246 82.25,-104.8613"/>
</g>
<!-- sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_supportroutines.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~self_mesh.f90&#45;&gt;sourcefile~self_supportroutines.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M534.5,-87.1304C470.7473,-78.1976 460.8045,-134.1525 396.5,-131.1304"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M396.5,-131.1304C369.4726,-129.8602 339.987,-129.5051 313.3214,-129.5707"/>
<polygon fill="#00ff66" stroke="#00ff66" points="313.235,-126.0709 303.2507,-129.6153 313.2662,-133.0708 313.235,-126.0709"/>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M372.0776,-35.0262C339.4024,-20.2921 279.5353,1.6088 227.5,-7.1304"/>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_supportroutines.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_supportroutines.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M381.8517,-59.2134C364.165,-73.2588 333.039,-96.2772 303,-110.1304 298.5986,-112.1602 293.9602,-114.0317 289.2358,-115.7497"/>
<polygon fill="#0066ff" stroke="#0066ff" points="287.8129,-112.5364 279.4663,-119.0621 290.0606,-119.1657 287.8129,-112.5364"/>
</g>
<!-- sourcefile~self_quadrature.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~self_quadrature.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/self_quadrature.f90.html" xlink:title="SELF_Quadrature.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="290,-101.1304 165,-101.1304 165,-77.1304 290,-77.1304 290,-101.1304"/>
<text text-anchor="middle" x="227.5" y="-86.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Quadrature.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_quadrature.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_quadrature.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M348.0714,-59.1659C328.6249,-63.9988 306.0405,-69.6114 285.7109,-74.6638"/>
<polygon fill="#0066ff" stroke="#0066ff" points="284.7963,-71.2845 275.9357,-77.0931 286.4847,-78.0779 284.7963,-71.2845"/>
</g>
<!-- sourcefile~self_memory.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~self_memory.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/self_memory.f90.html" xlink:title="SELF_Memory.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="280.5,-59.1304 174.5,-59.1304 174.5,-35.1304 280.5,-35.1304 280.5,-59.1304"/>
<text text-anchor="middle" x="227.5" y="-44.7304" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Memory.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_memory.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~self_lagrange.f90&#45;&gt;sourcefile~self_memory.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M338.8125,-47.1304C323.3599,-47.1304 306.5729,-47.1304 290.8331,-47.1304"/>
<polygon fill="#0066ff" stroke="#0066ff" points="290.6656,-43.6305 280.6655,-47.1304 290.6655,-50.6305 290.6656,-43.6305"/>
</g>
<!-- sourcefile~self_supportroutines.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~self_supportroutines.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M178.9281,-119.0949C159.424,-114.262 136.7729,-108.6493 116.3831,-103.597"/>
<polygon fill="#ff0000" stroke="#ff0000" points="117.1273,-100.1756 106.579,-101.1676 115.4436,-106.9701 117.1273,-100.1756"/>
</g>
<!-- sourcefile~self_quadrature.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~self_quadrature.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M164.866,-89.1304C152.2903,-89.1304 139.016,-89.1304 126.2602,-89.1304"/>
<polygon fill="#00ff00" stroke="#00ff00" points="126.1646,-85.6305 116.1646,-89.1304 126.1646,-92.6305 126.1646,-85.6305"/>
</g>
<!-- sourcefile~self_memory.f90&#45;&gt;sourcefile~self_constants.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~self_memory.f90&#45;&gt;sourcefile~self_constants.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M178.9281,-59.1659C159.424,-63.9988 136.7729,-69.6114 116.3831,-74.6638"/>
<polygon fill="#0000ff" stroke="#0000ff" points="115.4436,-71.2906 106.579,-77.0931 117.1273,-78.0852 115.4436,-71.2906"/>
</g>
</g>
</svg>
</div><script>var pansourcefileself_mappeddataf90EfferentGraph = svgPanZoom('#sourcefileself_mappeddataf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~self_mappeddata.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileself_mappeddataf90AfferentGraph" width="380pt" height="74pt"
 viewBox="0.00 0.00 380.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>sourcefile~~self_mappeddata.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-70 376,-70 376,4 -4,4"/>
<!-- sourcefile~self_mappeddata.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~self_mappeddata.f90</title>
<polygon fill="none" stroke="#000000" points="132,-45 0,-45 0,-21 132,-21 132,-45"/>
<text text-anchor="middle" x="66" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">SELF_MappedData.f90</text>
</g>
<!-- sourcefile~self_tests.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~self_tests.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/self_tests.f90.html" xlink:title="SELF_Tests.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="268.5,-66 178.5,-66 178.5,-42 268.5,-42 268.5,-66"/>
<text text-anchor="middle" x="223.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_Tests.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_tests.f90&#45;&gt;sourcefile~self_mappeddata.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~self_tests.f90&#45;&gt;sourcefile~self_mappeddata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M178.3668,-47.9822C167.1463,-46.4862 154.8049,-44.8407 142.5352,-43.2047"/>
<polygon fill="#ff0000" stroke="#ff0000" points="142.6466,-39.6887 132.2718,-41.8362 141.7214,-46.6273 142.6466,-39.6887"/>
</g>
<!-- sourcefile~self_mpilayer.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~self_mpilayer.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/self_mpilayer.f90.html" xlink:title="SELF_MPILayer.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="279,-24 168,-24 168,0 279,0 279,-24"/>
<text text-anchor="middle" x="223.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF_MPILayer.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_mappeddata.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~self_mpilayer.f90&#45;&gt;sourcefile~self_mappeddata.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M167.9714,-19.4038C159.6325,-20.5157 150.912,-21.6784 142.2324,-22.8357"/>
<polygon fill="#ff0000" stroke="#ff0000" points="141.537,-19.3973 132.0873,-24.1884 142.4622,-26.3359 141.537,-19.3973"/>
</g>
<!-- sourcefile~self.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~self.f90</title>
<g id="a_sourcefile~~self_mappeddata.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/self.f90.html" xlink:title="SELF.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="372,-66 315,-66 315,-42 372,-42 372,-66"/>
<text text-anchor="middle" x="343.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">SELF.f90</text>
</a>
</g>
</g>
<!-- sourcefile~self.f90&#45;&gt;sourcefile~self_tests.f90 -->
<g id="sourcefile~~self_mappeddata.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~self.f90&#45;&gt;sourcefile~self_tests.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M314.757,-54C304.0313,-54 291.4568,-54 279.1296,-54"/>
<polygon fill="#ff0000" stroke="#ff0000" points="278.8789,-50.5001 268.8789,-54 278.8788,-57.5001 278.8789,-50.5001"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/self_mappeddata.html">SELF_MappedData</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/self_mappeddata.f90.html#src">SELF_MappedData.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">! SELF_MappedData.F90</span>
<a name="ln-2"></a><span class="c">!</span>
<a name="ln-3"></a><span class="c">! Copyright 2020 Fluid Numerics LLC</span>
<a name="ln-4"></a><span class="c">! Author : Joseph Schoonover (joe@fluidnumerics.com)</span>
<a name="ln-5"></a><span class="c">! Support : self-fluids@fluidnumerics.com</span>
<a name="ln-6"></a><span class="c">!</span>
<a name="ln-7"></a><span class="c">! //////////////////////////////////////////////////////////////////////////////////////////////// !</span>
<a name="ln-8"></a>
<a name="ln-9"></a><span class="k">MODULE </span><span class="n">SELF_MappedData</span>
<a name="ln-10"></a>
<a name="ln-11"></a>  <span class="k">USE </span><span class="n">SELF_Constants</span>
<a name="ln-12"></a>  <span class="k">USE </span><span class="n">SELF_Lagrange</span>
<a name="ln-13"></a>
<a name="ln-14"></a>  <span class="k">USE </span><span class="n">SELF_Data</span>
<a name="ln-15"></a>  <span class="k">USE </span><span class="n">SELF_Mesh</span>
<a name="ln-16"></a>  <span class="k">USE </span><span class="n">SELF_Geometry</span>
<a name="ln-17"></a>
<a name="ln-18"></a><span class="c">!USE ISO_C_BINDING</span>
<a name="ln-19"></a>
<a name="ln-20"></a>  <span class="k">IMPLICIT NONE</span>
<a name="ln-21"></a>
<a name="ln-22"></a><span class="k">  TYPE</span><span class="p">,</span><span class="k">EXTENDS</span><span class="p">(</span><span class="n">Scalar1D</span><span class="p">),</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">MappedScalar1D</span>
<a name="ln-23"></a>
<a name="ln-24"></a>  <span class="k">CONTAINS</span>
<a name="ln-25"></a><span class="k">    GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Derivative</span> <span class="o">=&gt;</span> <span class="n">Derivative_MappedScalar1D</span>
<a name="ln-26"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Derivative_MappedScalar1D</span>
<a name="ln-27"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">JacobianWeight</span> <span class="o">=&gt;</span> <span class="n">JacobianWeight_MappedScalar1D</span>
<a name="ln-28"></a>
<a name="ln-29"></a>  <span class="k">END TYPE </span><span class="n">MappedScalar1D</span>
<a name="ln-30"></a>
<a name="ln-31"></a>  <span class="k">TYPE</span><span class="p">,</span><span class="k">EXTENDS</span><span class="p">(</span><span class="n">Scalar2D</span><span class="p">),</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">MappedScalar2D</span>
<a name="ln-32"></a>
<a name="ln-33"></a>  <span class="k">CONTAINS</span>
<a name="ln-34"></a>
<a name="ln-35"></a><span class="k">    GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Gradient</span> <span class="o">=&gt;</span> <span class="n">Gradient_MappedScalar2D</span>
<a name="ln-36"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Gradient_MappedScalar2D</span>
<a name="ln-37"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ContravariantWeight</span> <span class="o">=&gt;</span> <span class="n">ContravariantWeight_MappedScalar2D</span>
<a name="ln-38"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">JacobianWeight</span> <span class="o">=&gt;</span> <span class="n">JacobianWeight_MappedScalar2D</span>
<a name="ln-39"></a>
<a name="ln-40"></a>  <span class="k">END TYPE </span><span class="n">MappedScalar2D</span>
<a name="ln-41"></a>
<a name="ln-42"></a>  <span class="k">TYPE</span><span class="p">,</span><span class="k">EXTENDS</span><span class="p">(</span><span class="n">Scalar3D</span><span class="p">),</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">MappedScalar3D</span>
<a name="ln-43"></a>
<a name="ln-44"></a>  <span class="k">CONTAINS</span>
<a name="ln-45"></a>
<a name="ln-46"></a><span class="k">    GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Gradient</span> <span class="o">=&gt;</span> <span class="n">Gradient_MappedScalar3D</span>
<a name="ln-47"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Gradient_MappedScalar3D</span>
<a name="ln-48"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ContravariantWeight</span> <span class="o">=&gt;</span> <span class="n">ContravariantWeight_MappedScalar3D</span>
<a name="ln-49"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">JacobianWeight</span> <span class="o">=&gt;</span> <span class="n">JacobianWeight_MappedScalar3D</span>
<a name="ln-50"></a>
<a name="ln-51"></a>  <span class="k">END TYPE </span><span class="n">MappedScalar3D</span>
<a name="ln-52"></a>
<a name="ln-53"></a>  <span class="k">TYPE</span><span class="p">,</span><span class="k">EXTENDS</span><span class="p">(</span><span class="n">Vector2D</span><span class="p">),</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">MappedVector2D</span>
<a name="ln-54"></a>
<a name="ln-55"></a>  <span class="k">CONTAINS</span>
<a name="ln-56"></a>
<a name="ln-57"></a><span class="k">    GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Divergence</span> <span class="o">=&gt;</span> <span class="n">Divergence_MappedVector2D</span>
<a name="ln-58"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Gradient</span> <span class="o">=&gt;</span> <span class="n">Gradient_MappedVector2D</span>
<a name="ln-59"></a><span class="c">!    GENERIC,PUBLIC :: Curl =&gt; Curl_MappedVector2D</span>
<a name="ln-60"></a>
<a name="ln-61"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Divergence_MappedVector2D</span>
<a name="ln-62"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Gradient_MappedVector2D</span>
<a name="ln-63"></a><span class="c">!    PROCEDURE,PRIVATE :: Curl_MappedVector2D</span>
<a name="ln-64"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ContravariantProjection</span> <span class="o">=&gt;</span> <span class="n">ContravariantProjection_MappedVector2D</span>
<a name="ln-65"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">JacobianWeight</span> <span class="o">=&gt;</span> <span class="n">JacobianWeight_MappedVector2D</span>
<a name="ln-66"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">MapToScalar</span> <span class="o">=&gt;</span> <span class="n">MapToScalar_MappedVector2D</span>
<a name="ln-67"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">MapToTensor</span> <span class="o">=&gt;</span> <span class="n">MapToTensor_MappedVector2D</span>
<a name="ln-68"></a>
<a name="ln-69"></a>  <span class="k">END TYPE </span><span class="n">MappedVector2D</span>
<a name="ln-70"></a>
<a name="ln-71"></a>  <span class="k">TYPE</span><span class="p">,</span><span class="k">EXTENDS</span><span class="p">(</span><span class="n">Vector3D</span><span class="p">),</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">MappedVector3D</span>
<a name="ln-72"></a>
<a name="ln-73"></a>  <span class="k">CONTAINS</span>
<a name="ln-74"></a>
<a name="ln-75"></a><span class="k">    GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Divergence</span> <span class="o">=&gt;</span> <span class="n">Divergence_MappedVector3D</span>
<a name="ln-76"></a><span class="c">!    GENERIC,PUBLIC :: Curl =&gt; Curl_MappedVector3D</span>
<a name="ln-77"></a>    <span class="k">GENERIC</span><span class="p">,</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">Gradient</span> <span class="o">=&gt;</span> <span class="n">Gradient_MappedVector3D</span>
<a name="ln-78"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Divergence_MappedVector3D</span>
<a name="ln-79"></a><span class="c">!    PROCEDURE,PRIVATE :: Curl_MappedVector3D</span>
<a name="ln-80"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">Gradient_MappedVector3D</span>
<a name="ln-81"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">ContravariantProjection</span> <span class="o">=&gt;</span> <span class="n">ContravariantProjection_MappedVector3D</span>
<a name="ln-82"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">JacobianWeight</span> <span class="o">=&gt;</span> <span class="n">JacobianWeight_MappedVector3D</span>
<a name="ln-83"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">MapToScalar</span> <span class="o">=&gt;</span> <span class="n">MapToScalar_MappedVector3D</span>
<a name="ln-84"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">MapToTensor</span> <span class="o">=&gt;</span> <span class="n">MapToTensor_MappedVector3D</span>
<a name="ln-85"></a>
<a name="ln-86"></a>  <span class="k">END TYPE </span><span class="n">MappedVector3D</span>
<a name="ln-87"></a>
<a name="ln-88"></a>  <span class="k">TYPE</span><span class="p">,</span><span class="k">EXTENDS</span><span class="p">(</span><span class="n">Tensor2D</span><span class="p">),</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">MappedTensor2D</span>
<a name="ln-89"></a>
<a name="ln-90"></a>  <span class="k">CONTAINS</span>
<a name="ln-91"></a><span class="c">!</span>
<a name="ln-92"></a><span class="c">!    GENERIC,PUBLIC :: Divergence =&gt; Divergence_MappedTensor2D</span>
<a name="ln-93"></a><span class="c">!    PROCEDURE,PRIVATE :: Divergence_MappedTensor2D</span>
<a name="ln-94"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">JacobianWeight</span> <span class="o">=&gt;</span> <span class="n">JacobianWeight_MappedTensor2D</span>
<a name="ln-95"></a>
<a name="ln-96"></a>  <span class="k">END TYPE </span><span class="n">MappedTensor2D</span>
<a name="ln-97"></a>
<a name="ln-98"></a>  <span class="k">TYPE</span><span class="p">,</span><span class="k">EXTENDS</span><span class="p">(</span><span class="n">Tensor3D</span><span class="p">),</span><span class="k">PUBLIC</span> <span class="kd">::</span> <span class="n">MappedTensor3D</span>
<a name="ln-99"></a>
<a name="ln-100"></a>  <span class="k">CONTAINS</span>
<a name="ln-101"></a><span class="c">!</span>
<a name="ln-102"></a><span class="c">!    GENERIC,PUBLIC :: Divergence =&gt; Divergence_MappedTensor3D</span>
<a name="ln-103"></a><span class="c">!    PROCEDURE,PRIVATE :: Divergence_MappedTensor3D</span>
<a name="ln-104"></a>    <span class="k">PROCEDURE</span><span class="p">,</span><span class="k">PRIVATE</span> <span class="kd">::</span> <span class="n">JacobianWeight</span> <span class="o">=&gt;</span> <span class="n">JacobianWeight_MappedTensor3D</span>
<a name="ln-105"></a>
<a name="ln-106"></a>  <span class="k">END TYPE </span><span class="n">MappedTensor3D</span>
<a name="ln-107"></a>
<a name="ln-108"></a><span class="k">CONTAINS</span>
<a name="ln-109"></a>
<a name="ln-110"></a><span class="c">! ---------------------- Scalars ---------------------- !</span>
<a name="ln-111"></a>
<a name="ln-112"></a>  <span class="k">SUBROUTINE </span><span class="n">Derivative_MappedScalar1D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">dF</span><span class="p">,</span><span class="n">dForm</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-113"></a>    <span class="c">! Strong Form Operator</span>
<a name="ln-114"></a>    <span class="c">!</span>
<a name="ln-115"></a>    <span class="c">! Calculates the gradient of a scalar 1D function using the conservative form of the</span>
<a name="ln-116"></a>    <span class="c">! mapped gradient operator</span>
<a name="ln-117"></a>    <span class="c">!</span>
<a name="ln-118"></a>    <span class="c">! df/dx =  d\xi/dx( df/d\xi )</span>
<a name="ln-119"></a>    <span class="c">!</span>
<a name="ln-120"></a>    <span class="c">! where the sum over i is implied.</span>
<a name="ln-121"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-122"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar1D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-123"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">Geometry1D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-124"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedScalar1D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dF</span>
<a name="ln-125"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dForm</span>
<a name="ln-126"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-127"></a>
<a name="ln-128"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfWeakDGForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-129"></a>
<a name="ln-130"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-131"></a><span class="c">!        CALL scalar % interp % DGDerivative_1D(scalar % interior % deviceData, &amp;</span>
<a name="ln-132"></a><span class="c">!                                               scalar % boundary % deviceData, &amp;</span>
<a name="ln-133"></a><span class="c">!                                               df % interior % deviceData, &amp;</span>
<a name="ln-134"></a><span class="c">!                                               scalar % nVar, &amp;</span>
<a name="ln-135"></a><span class="c">!                                               scalar % nElem)</span>
<a name="ln-136"></a><span class="c">!      ELSE</span>
<a name="ln-137"></a>        <span class="k">CALL </span><span class="n">scalar</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">DGDerivative_1D</span><span class="p">(</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-138"></a>                                               <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-139"></a>                                               <span class="n">df</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-140"></a>                                               <span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-141"></a>                                               <span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-142"></a><span class="c">!      END IF</span>
<a name="ln-143"></a>
<a name="ln-144"></a>    <span class="n">ELSEIF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfStrongForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-145"></a>
<a name="ln-146"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-147"></a><span class="c">!        CALL scalar % interp % Derivative_1D(scalar % interior % deviceData, &amp;</span>
<a name="ln-148"></a><span class="c">!                                             df % interior % deviceData, &amp;</span>
<a name="ln-149"></a><span class="c">!                                             scalar % nVar, &amp;</span>
<a name="ln-150"></a><span class="c">!                                             scalar % nElem)</span>
<a name="ln-151"></a><span class="c">!      ELSE</span>
<a name="ln-152"></a>        <span class="k">CALL </span><span class="n">scalar</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">Derivative_1D</span><span class="p">(</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-153"></a>                                             <span class="n">df</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-154"></a>                                             <span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-155"></a>                                             <span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-156"></a><span class="c">!      END IF</span>
<a name="ln-157"></a>
<a name="ln-158"></a>    <span class="n">ENDIF</span>
<a name="ln-159"></a>
<a name="ln-160"></a>    <span class="k">CALL </span><span class="n">df</span> <span class="p">%</span> <span class="n">JacobianWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-161"></a>
<a name="ln-162"></a>  <span class="k">END SUBROUTINE </span><span class="n">Derivative_MappedScalar1D</span>
<a name="ln-163"></a>
<a name="ln-164"></a>  <span class="k">SUBROUTINE </span><span class="n">JacobianWeight_MappedScalar1D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-165"></a>  <span class="c">! Applies the inverse jacobian</span>
<a name="ln-166"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-167"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar1D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-168"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">Geometry1D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-169"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-170"></a>    <span class="c">! Local</span>
<a name="ln-171"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span> <span class="n">iVar</span><span class="p">,</span> <span class="n">i</span>
<a name="ln-172"></a>
<a name="ln-173"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-174"></a><span class="c">!</span>
<a name="ln-175"></a><span class="c">!      CALL JacobianWeight_MappedScalar1D_gpu_wrapper(scalar % interior % deviceData, &amp;</span>
<a name="ln-176"></a><span class="c">!                                                     geometry % dxds % interior % deviceData, &amp;</span>
<a name="ln-177"></a><span class="c">!                                                     scalar % N, &amp;</span>
<a name="ln-178"></a><span class="c">!                                                     scalar % nVar, &amp;</span>
<a name="ln-179"></a><span class="c">!                                                     scalar % nElem)</span>
<a name="ln-180"></a><span class="c">!</span>
<a name="ln-181"></a><span class="c">!    ELSE</span>
<a name="ln-182"></a>
<a name="ln-183"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-184"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-185"></a>          <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-186"></a>            <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-187"></a>                                                       <span class="n">geometry</span> <span class="p">%</span> <span class="n">dxds</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-188"></a>          <span class="n">ENDDO</span>
<a name="ln-189"></a>        <span class="n">ENDDO</span>
<a name="ln-190"></a>      <span class="n">ENDDO</span>
<a name="ln-191"></a>
<a name="ln-192"></a><span class="c">!    ENDIF</span>
<a name="ln-193"></a>
<a name="ln-194"></a>  <span class="k">END SUBROUTINE </span><span class="n">JacobianWeight_MappedScalar1D</span>
<a name="ln-195"></a>
<a name="ln-196"></a>  <span class="k">SUBROUTINE </span><span class="n">Gradient_MappedScalar2D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">dForm</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-197"></a>    <span class="c">! Strong Form Operator - (Conservative Form)</span>
<a name="ln-198"></a>    <span class="c">!</span>
<a name="ln-199"></a>    <span class="c">! Calculates the gradient of a scalar 2D function using the conservative form of the</span>
<a name="ln-200"></a>    <span class="c">! mapped gradient operator</span>
<a name="ln-201"></a>    <span class="c">!</span>
<a name="ln-202"></a>    <span class="c">! \grad_{phys}( f ) =  (1 / J)*(\partial / \partial \xi_i ( J\vec{a}_i f )</span>
<a name="ln-203"></a>    <span class="c">!</span>
<a name="ln-204"></a>    <span class="c">! where the sum over i is implied.</span>
<a name="ln-205"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-206"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-207"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workTensor</span>
<a name="ln-208"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-209"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span>
<a name="ln-210"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dForm</span>
<a name="ln-211"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-212"></a>
<a name="ln-213"></a>    <span class="k">CALL </span><span class="n">scalar</span> <span class="p">%</span> <span class="n">ContravariantWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-214"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfWeakDGForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-215"></a>
<a name="ln-216"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-217"></a><span class="c">!        CALL workTensor % interp % TensorDGDivergence_2D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-218"></a><span class="c">!                                                         workTensor % boundary % deviceData, &amp;</span>
<a name="ln-219"></a><span class="c">!                                                         gradF % interior % deviceData, &amp;</span>
<a name="ln-220"></a><span class="c">!                                                         workTensor % nVar, &amp;</span>
<a name="ln-221"></a><span class="c">!                                                         workTensor % nElem)</span>
<a name="ln-222"></a><span class="c">!      ELSE</span>
<a name="ln-223"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDGDivergence_2D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-224"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-225"></a>                                                         <span class="n">gradF</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-226"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-227"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-228"></a><span class="c">!      END IF</span>
<a name="ln-229"></a>
<a name="ln-230"></a>    <span class="n">ELSEIF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfStrongForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-231"></a>
<a name="ln-232"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-233"></a><span class="c">!        CALL workTensor % interp % TensorDivergence_2D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-234"></a><span class="c">!                                                       gradF % interior % deviceData, &amp;</span>
<a name="ln-235"></a><span class="c">!                                                       workTensor % nVar, &amp;</span>
<a name="ln-236"></a><span class="c">!                                                       workTensor % nElem)</span>
<a name="ln-237"></a><span class="c">!      ELSE</span>
<a name="ln-238"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDivergence_2D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-239"></a>                                                       <span class="n">gradF</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-240"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-241"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-242"></a><span class="c">!      END IF</span>
<a name="ln-243"></a>
<a name="ln-244"></a>    <span class="n">ENDIF</span>
<a name="ln-245"></a>
<a name="ln-246"></a>    <span class="k">CALL </span><span class="n">gradF</span> <span class="p">%</span> <span class="n">JacobianWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-247"></a>
<a name="ln-248"></a>  <span class="k">END SUBROUTINE </span><span class="n">Gradient_MappedScalar2D</span>
<a name="ln-249"></a>
<a name="ln-250"></a>  <span class="k">SUBROUTINE </span><span class="n">ContravariantWeight_MappedScalar2D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-251"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-252"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-253"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-254"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-255"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workTensor</span>
<a name="ln-256"></a>    <span class="c">! Local</span>
<a name="ln-257"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-258"></a>
<a name="ln-259"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-260"></a><span class="c">!</span>
<a name="ln-261"></a><span class="c">!      ! TO DO : Add contravariant weight on boundary terms</span>
<a name="ln-262"></a><span class="c">!      CALL ContravariantWeight_MappedScalar2D_gpu_wrapper(scalar % interior % deviceData, &amp;</span>
<a name="ln-263"></a><span class="c">!                                                          workTensor % interior % deviceData, &amp;</span>
<a name="ln-264"></a><span class="c">!                                                          geometry % dsdx % interior % deviceData, &amp;</span>
<a name="ln-265"></a><span class="c">!                                                          scalar % N, &amp;</span>
<a name="ln-266"></a><span class="c">!                                                          scalar % nVar, &amp;</span>
<a name="ln-267"></a><span class="c">!                                                          scalar % nElem)</span>
<a name="ln-268"></a><span class="c">!</span>
<a name="ln-269"></a><span class="c">!    ELSE</span>
<a name="ln-270"></a>
<a name="ln-271"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-272"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-273"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-274"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-275"></a>
<a name="ln-276"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-277"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-278"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-279"></a>
<a name="ln-280"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-281"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-282"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-283"></a>
<a name="ln-284"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-285"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-286"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-287"></a>
<a name="ln-288"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-289"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-290"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-291"></a>
<a name="ln-292"></a>            <span class="k">END DO</span>
<a name="ln-293"></a><span class="k">          END DO</span>
<a name="ln-294"></a><span class="k">        END DO</span>
<a name="ln-295"></a><span class="k">      END DO</span>
<a name="ln-296"></a>
<a name="ln-297"></a>      <span class="c">! Boundary Terms</span>
<a name="ln-298"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-299"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<a name="ln-300"></a>          <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-301"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-302"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-303"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-304"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-305"></a>
<a name="ln-306"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-307"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-308"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-309"></a>
<a name="ln-310"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-311"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-312"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-313"></a>
<a name="ln-314"></a>              <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-315"></a>                                                                   <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-316"></a>                                                                   <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-317"></a>
<a name="ln-318"></a>            <span class="n">ENDDO</span>
<a name="ln-319"></a>          <span class="n">ENDDO</span>
<a name="ln-320"></a>        <span class="n">ENDDO</span>
<a name="ln-321"></a>      <span class="n">ENDDO</span>
<a name="ln-322"></a>
<a name="ln-323"></a><span class="c">!    END IF</span>
<a name="ln-324"></a>
<a name="ln-325"></a>  <span class="k">END SUBROUTINE </span><span class="n">ContravariantWeight_MappedScalar2D</span>
<a name="ln-326"></a>
<a name="ln-327"></a>  <span class="k">SUBROUTINE </span><span class="n">JacobianWeight_MappedScalar2D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-328"></a>  <span class="c">! Applies the inverse jacobian</span>
<a name="ln-329"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-330"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-331"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-332"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-333"></a>    <span class="c">! Local</span>
<a name="ln-334"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span>
<a name="ln-335"></a>
<a name="ln-336"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-337"></a><span class="c">!</span>
<a name="ln-338"></a><span class="c">!      CALL JacobianWeight_MappedScalar2D_gpu_wrapper(scalar % interior % deviceData, &amp;</span>
<a name="ln-339"></a><span class="c">!                                                     geometry % dxds % interior % deviceData, &amp;</span>
<a name="ln-340"></a><span class="c">!                                                     scalar % N, &amp;</span>
<a name="ln-341"></a><span class="c">!                                                     scalar % nVar, &amp;</span>
<a name="ln-342"></a><span class="c">!                                                     scalar % nElem)</span>
<a name="ln-343"></a><span class="c">!</span>
<a name="ln-344"></a><span class="c">!    ELSE</span>
<a name="ln-345"></a>
<a name="ln-346"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-347"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-348"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-349"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-350"></a>              <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-351"></a>                                                           <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-352"></a>            <span class="n">ENDDO</span>
<a name="ln-353"></a>          <span class="n">ENDDO</span>
<a name="ln-354"></a>        <span class="n">ENDDO</span>
<a name="ln-355"></a>      <span class="n">ENDDO</span>
<a name="ln-356"></a>
<a name="ln-357"></a><span class="c">!    ENDIF</span>
<a name="ln-358"></a>
<a name="ln-359"></a>  <span class="k">END SUBROUTINE </span><span class="n">JacobianWeight_MappedScalar2D</span>
<a name="ln-360"></a>
<a name="ln-361"></a>  <span class="k">SUBROUTINE </span><span class="n">Gradient_MappedScalar3D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">dForm</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-362"></a>    <span class="c">! Strong Form Operator</span>
<a name="ln-363"></a>    <span class="c">!</span>
<a name="ln-364"></a>    <span class="c">! Calculates the gradient of a scalar 3D function using the conservative form of the</span>
<a name="ln-365"></a>    <span class="c">! mapped gradient operator</span>
<a name="ln-366"></a>    <span class="c">!</span>
<a name="ln-367"></a>    <span class="c">! \grad_{phys}( f ) =  (1 / J)*(\partial / \partial \xi_i ( J\vec{a}_i f )</span>
<a name="ln-368"></a>    <span class="c">!</span>
<a name="ln-369"></a>    <span class="c">! where the sum over i is implied.</span>
<a name="ln-370"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-371"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-372"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workTensor</span>
<a name="ln-373"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-374"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span>
<a name="ln-375"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dForm</span>
<a name="ln-376"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-377"></a>
<a name="ln-378"></a>    <span class="k">CALL </span><span class="n">scalar</span> <span class="p">%</span> <span class="n">ContravariantWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-379"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfWeakDGForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-380"></a>
<a name="ln-381"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-382"></a><span class="c">!        CALL workTensor % interp % TensorDGDivergence_3D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-383"></a><span class="c">!                                                         workTensor % boundary % deviceData, &amp;</span>
<a name="ln-384"></a><span class="c">!                                                         gradF % interior % deviceData, &amp;</span>
<a name="ln-385"></a><span class="c">!                                                         workTensor % nVar, &amp;</span>
<a name="ln-386"></a><span class="c">!                                                         workTensor % nElem)</span>
<a name="ln-387"></a><span class="c">!      ELSE</span>
<a name="ln-388"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDGDivergence_3D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-389"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-390"></a>                                                         <span class="n">gradF</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-391"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-392"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-393"></a><span class="c">!      END IF</span>
<a name="ln-394"></a>
<a name="ln-395"></a>    <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfStrongForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-396"></a>
<a name="ln-397"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-398"></a><span class="c">!        CALL workTensor % interp % TensorDivergence_3D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-399"></a><span class="c">!                                                       gradF % interior % deviceData, &amp;</span>
<a name="ln-400"></a><span class="c">!                                                       workTensor % nVar, &amp;</span>
<a name="ln-401"></a><span class="c">!                                                       workTensor % nElem)</span>
<a name="ln-402"></a><span class="c">!      ELSE</span>
<a name="ln-403"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDivergence_3D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-404"></a>                                                       <span class="n">gradF</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-405"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-406"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-407"></a><span class="c">!      END IF</span>
<a name="ln-408"></a>
<a name="ln-409"></a>    <span class="k">END IF</span>
<a name="ln-410"></a><span class="k">    CALL </span><span class="n">gradF</span> <span class="p">%</span> <span class="n">JacobianWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-411"></a>
<a name="ln-412"></a>  <span class="k">END SUBROUTINE </span><span class="n">Gradient_MappedScalar3D</span>
<a name="ln-413"></a>
<a name="ln-414"></a>  <span class="k">SUBROUTINE </span><span class="n">ContravariantWeight_MappedScalar3D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-415"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-416"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-417"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-418"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-419"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workTensor</span>
<a name="ln-420"></a>    <span class="c">! Local</span>
<a name="ln-421"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-422"></a>
<a name="ln-423"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-424"></a><span class="c">!</span>
<a name="ln-425"></a><span class="c">!      ! TO DO : Add weighting of boundary terms</span>
<a name="ln-426"></a><span class="c">!      CALL ContravariantWeight_MappedScalar3D_gpu_wrapper(scalar % interior % deviceData, &amp;</span>
<a name="ln-427"></a><span class="c">!                                                          workTensor % interior % deviceData, &amp;</span>
<a name="ln-428"></a><span class="c">!                                                          geometry % dsdx % interior % deviceData, &amp;</span>
<a name="ln-429"></a><span class="c">!                                                          scalar % N, &amp;</span>
<a name="ln-430"></a><span class="c">!                                                          scalar % nVar, &amp;</span>
<a name="ln-431"></a><span class="c">!                                                          scalar % nElem)</span>
<a name="ln-432"></a><span class="c">!    ELSE</span>
<a name="ln-433"></a>
<a name="ln-434"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-435"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-436"></a>          <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-437"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-438"></a>              <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-439"></a>
<a name="ln-440"></a>                <span class="c">! Get the x-component of the Jacobian weighted</span>
<a name="ln-441"></a>                <span class="c">! contravariant basis vectors multipled by the scalar</span>
<a name="ln-442"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-443"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-444"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-445"></a>
<a name="ln-446"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-447"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-448"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-449"></a>
<a name="ln-450"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-451"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-452"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-453"></a>
<a name="ln-454"></a>                <span class="c">! Get the y-component of the Jacobian weighted</span>
<a name="ln-455"></a>                <span class="c">! contravariant basis vectors multipled by the scalar</span>
<a name="ln-456"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-457"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-458"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-459"></a>
<a name="ln-460"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-461"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-462"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-463"></a>
<a name="ln-464"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-465"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-466"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-467"></a>
<a name="ln-468"></a>                <span class="c">! Get the z-component of the Jacobian weighted</span>
<a name="ln-469"></a>                <span class="c">! contravariant basis vectors multipled by the scalar</span>
<a name="ln-470"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-471"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-472"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-473"></a>
<a name="ln-474"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-475"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-476"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-477"></a>
<a name="ln-478"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-479"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-480"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-481"></a>
<a name="ln-482"></a>              <span class="k">END DO</span>
<a name="ln-483"></a><span class="k">            END DO</span>
<a name="ln-484"></a><span class="k">          END DO</span>
<a name="ln-485"></a><span class="k">        END DO</span>
<a name="ln-486"></a><span class="k">      END DO</span>
<a name="ln-487"></a>
<a name="ln-488"></a>      <span class="c">! Boundary Term</span>
<a name="ln-489"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-490"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-491"></a>          <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-492"></a>            <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-493"></a>              <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-494"></a>                <span class="c">! Get the x-component of the Jacobian weighted</span>
<a name="ln-495"></a>                <span class="c">! contravariant basis vectors multipled by the scalar</span>
<a name="ln-496"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-497"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-498"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-499"></a>
<a name="ln-500"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-501"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-502"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-503"></a>
<a name="ln-504"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-505"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-506"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-507"></a>
<a name="ln-508"></a>                <span class="c">! Get the y-component of the Jacobian weighted</span>
<a name="ln-509"></a>                <span class="c">! contravariant basis vectors multipled by the scalar</span>
<a name="ln-510"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-511"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-512"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-513"></a>
<a name="ln-514"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-515"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-516"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-517"></a>
<a name="ln-518"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-519"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-520"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-521"></a>
<a name="ln-522"></a>                <span class="c">! Get the z-component of the Jacobian weighted</span>
<a name="ln-523"></a>                <span class="c">! contravariant basis vectors multipled by the scalar</span>
<a name="ln-524"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-525"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-526"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-527"></a>
<a name="ln-528"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-529"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-530"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-531"></a>
<a name="ln-532"></a>                <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="p">&amp;</span>
<a name="ln-533"></a>                                                                       <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-534"></a>                                                                       <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-535"></a>
<a name="ln-536"></a>
<a name="ln-537"></a>              <span class="n">ENDDO</span>
<a name="ln-538"></a>            <span class="n">ENDDO</span>
<a name="ln-539"></a>          <span class="n">ENDDO</span>
<a name="ln-540"></a>        <span class="n">ENDDO</span>
<a name="ln-541"></a>      <span class="n">ENDDO</span>
<a name="ln-542"></a>
<a name="ln-543"></a><span class="c">!    END IF</span>
<a name="ln-544"></a>
<a name="ln-545"></a>  <span class="k">END SUBROUTINE </span><span class="n">ContravariantWeight_MappedScalar3D</span>
<a name="ln-546"></a>
<a name="ln-547"></a>  <span class="k">SUBROUTINE </span><span class="n">JacobianWeight_MappedScalar3D</span><span class="p">(</span><span class="n">scalar</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-548"></a>  <span class="c">! Applies the inverse jacobian</span>
<a name="ln-549"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-550"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedScalar3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-551"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-552"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-553"></a>    <span class="c">! Local</span>
<a name="ln-554"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-555"></a>
<a name="ln-556"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-557"></a><span class="c">!</span>
<a name="ln-558"></a><span class="c">!      CALL JacobianWeight_MappedScalar3D_gpu_wrapper(scalar % interior % deviceData, &amp;</span>
<a name="ln-559"></a><span class="c">!                                                     geometry % dxds % interior % deviceData, &amp;</span>
<a name="ln-560"></a><span class="c">!                                                     scalar % N, &amp;</span>
<a name="ln-561"></a><span class="c">!                                                     scalar % nVar, &amp;</span>
<a name="ln-562"></a><span class="c">!                                                     scalar % nElem)</span>
<a name="ln-563"></a><span class="c">!</span>
<a name="ln-564"></a><span class="c">!    ELSE</span>
<a name="ln-565"></a>
<a name="ln-566"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-567"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-568"></a>          <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-569"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-570"></a>              <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">scalar</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-571"></a>                <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-572"></a>                                                               <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-573"></a>              <span class="n">ENDDO</span>
<a name="ln-574"></a>            <span class="n">ENDDO</span>
<a name="ln-575"></a>          <span class="n">ENDDO</span>
<a name="ln-576"></a>        <span class="n">ENDDO</span>
<a name="ln-577"></a>      <span class="n">ENDDO</span>
<a name="ln-578"></a>
<a name="ln-579"></a><span class="c">!    ENDIF</span>
<a name="ln-580"></a>
<a name="ln-581"></a>  <span class="k">END SUBROUTINE </span><span class="n">JacobianWeight_MappedScalar3D</span>
<a name="ln-582"></a>
<a name="ln-583"></a>  <span class="c">! ---------------------- Vectors ---------------------- !</span>
<a name="ln-584"></a>  <span class="k">SUBROUTINE </span><span class="n">Divergence_MappedVector2D</span><span class="p">(</span><span class="n">physVector</span><span class="p">,</span><span class="n">compVector</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">divVector</span><span class="p">,</span><span class="n">dForm</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-585"></a>    <span class="c">! Strong Form Operator</span>
<a name="ln-586"></a>    <span class="c">!</span>
<a name="ln-587"></a>    <span class="c">! DG Weak Form Operator</span>
<a name="ln-588"></a>    <span class="c">!</span>
<a name="ln-589"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-590"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">physVector</span>
<a name="ln-591"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compVector</span>
<a name="ln-592"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-593"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedScalar2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">divVector</span>
<a name="ln-594"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dForm</span>
<a name="ln-595"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-596"></a>
<a name="ln-597"></a>    <span class="k">CALL </span><span class="n">physVector</span> <span class="p">%</span> <span class="n">ContravariantProjection</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">compVector</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-598"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfWeakDGForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-599"></a>
<a name="ln-600"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-601"></a><span class="c">!        CALL compVector % interp % VectorDGDivergence_2D(compVector % interior % deviceData, &amp;</span>
<a name="ln-602"></a><span class="c">!                                                         compVector % boundary % deviceData, &amp;</span>
<a name="ln-603"></a><span class="c">!                                                         divVector % interior % deviceData, &amp;</span>
<a name="ln-604"></a><span class="c">!                                                         compVector % nvar, &amp;</span>
<a name="ln-605"></a><span class="c">!                                                         compVector % nelem)</span>
<a name="ln-606"></a><span class="c">!      ELSE</span>
<a name="ln-607"></a>        <span class="k">CALL </span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">VectorDGDivergence_2D</span><span class="p">(</span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-608"></a>                                                         <span class="n">compVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-609"></a>                                                         <span class="n">divVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-610"></a>                                                         <span class="n">compVector</span> <span class="p">%</span> <span class="n">nvar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-611"></a>                                                         <span class="n">compVector</span> <span class="p">%</span> <span class="n">nelem</span><span class="p">)</span>
<a name="ln-612"></a><span class="c">!      ENDIF</span>
<a name="ln-613"></a>
<a name="ln-614"></a>    <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfStrongForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-615"></a>
<a name="ln-616"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-617"></a><span class="c">!        CALL compVector % interp % VectorDivergence_2D(compVector % interior % deviceData, &amp;</span>
<a name="ln-618"></a><span class="c">!                                                       divVector % interior % deviceData, &amp;</span>
<a name="ln-619"></a><span class="c">!                                                       compVector % nvar, &amp;</span>
<a name="ln-620"></a><span class="c">!                                                       compVector % nelem)</span>
<a name="ln-621"></a><span class="c">!      ELSE</span>
<a name="ln-622"></a>        <span class="k">CALL </span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">VectorDivergence_2D</span><span class="p">(</span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-623"></a>                                                       <span class="n">divVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-624"></a>                                                       <span class="n">compVector</span> <span class="p">%</span> <span class="n">nvar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-625"></a>                                                       <span class="n">compVector</span> <span class="p">%</span> <span class="n">nelem</span><span class="p">)</span>
<a name="ln-626"></a><span class="c">!      ENDIF</span>
<a name="ln-627"></a>
<a name="ln-628"></a>    <span class="k">END IF</span>
<a name="ln-629"></a>
<a name="ln-630"></a><span class="k">    CALL </span><span class="n">divVector</span> <span class="p">%</span> <span class="n">JacobianWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-631"></a>
<a name="ln-632"></a>  <span class="k">END SUBROUTINE </span><span class="n">Divergence_MappedVector2D</span>
<a name="ln-633"></a>
<a name="ln-634"></a>  <span class="k">SUBROUTINE </span><span class="n">Gradient_MappedVector2D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">workScalar</span><span class="p">,</span><span class="n">workVector</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">dForm</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-635"></a>    <span class="c">! Strong Form Operator - (Conservative Form)</span>
<a name="ln-636"></a>    <span class="c">!</span>
<a name="ln-637"></a>    <span class="c">! Calculates the gradient of a scalar 2D function using the conservative form of the</span>
<a name="ln-638"></a>    <span class="c">! mapped gradient operator</span>
<a name="ln-639"></a>    <span class="c">!</span>
<a name="ln-640"></a>    <span class="c">! \grad_{phys}( f ) =  (1 / J)*(\partial / \partial \xi_i ( J\vec{a}_i f )</span>
<a name="ln-641"></a>    <span class="c">!</span>
<a name="ln-642"></a>    <span class="c">! where the sum over i is implied.</span>
<a name="ln-643"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-644"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-645"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedScalar2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workScalar</span> <span class="c">! (scalar) nvar = 2*nvar</span>
<a name="ln-646"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workVector</span> <span class="c">! (scalar) nvar = 2*nvar</span>
<a name="ln-647"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workTensor</span> <span class="c">! (tensor) nvar = 2*nvar</span>
<a name="ln-648"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-649"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span>
<a name="ln-650"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dForm</span>
<a name="ln-651"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-652"></a>
<a name="ln-653"></a>    <span class="k">CALL </span><span class="n">vector</span> <span class="p">%</span> <span class="n">MapToScalar</span><span class="p">(</span><span class="n">workScalar</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-654"></a>
<a name="ln-655"></a>    <span class="k">CALL </span><span class="n">workScalar</span> <span class="p">%</span> <span class="n">ContravariantWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-656"></a>
<a name="ln-657"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfWeakDGForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-658"></a>
<a name="ln-659"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-660"></a><span class="c">!        CALL workTensor % interp % TensorDGDivergence_2D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-661"></a><span class="c">!                                                         workTensor % boundary % deviceData, &amp;</span>
<a name="ln-662"></a><span class="c">!                                                         workVector % interior % deviceData, &amp;</span>
<a name="ln-663"></a><span class="c">!                                                         workTensor % nVar, &amp;</span>
<a name="ln-664"></a><span class="c">!                                                         workTensor % nElem)</span>
<a name="ln-665"></a><span class="c">!      ELSE</span>
<a name="ln-666"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDGDivergence_2D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-667"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-668"></a>                                                         <span class="n">workVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-669"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-670"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-671"></a><span class="c">!      END IF</span>
<a name="ln-672"></a>
<a name="ln-673"></a>    <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfStrongForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-674"></a>
<a name="ln-675"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-676"></a><span class="c">!        CALL workTensor % interp % TensorDivergence_2D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-677"></a><span class="c">!                                                       workVector % interior % deviceData, &amp;</span>
<a name="ln-678"></a><span class="c">!                                                       workTensor % nVar, &amp;</span>
<a name="ln-679"></a><span class="c">!                                                       workTensor % nElem)</span>
<a name="ln-680"></a><span class="c">!      ELSE</span>
<a name="ln-681"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDivergence_2D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-682"></a>                                                       <span class="n">workVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-683"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-684"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-685"></a><span class="c">!      END IF</span>
<a name="ln-686"></a>
<a name="ln-687"></a>    <span class="k">END IF</span>
<a name="ln-688"></a>
<a name="ln-689"></a><span class="k">    CALL </span><span class="n">workVector</span> <span class="p">%</span> <span class="n">MapToTensor</span><span class="p">(</span><span class="n">gradF</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-690"></a>
<a name="ln-691"></a>    <span class="k">CALL </span><span class="n">gradF</span> <span class="p">%</span> <span class="n">JacobianWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-692"></a>
<a name="ln-693"></a>  <span class="k">END SUBROUTINE </span><span class="n">Gradient_MappedVector2D</span>
<a name="ln-694"></a>
<a name="ln-695"></a>  <span class="k">SUBROUTINE </span><span class="n">MapToScalar_MappedVector2D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">scalar</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-696"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-697"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-698"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedScalar2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-699"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-700"></a>    <span class="c">! Local</span>
<a name="ln-701"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">row</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-702"></a>
<a name="ln-703"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-704"></a><span class="c">!      PRINT*, &#39;GPU Acceleration of MapToScalar_MappedVector2D not supported yet!&#39;</span>
<a name="ln-705"></a><span class="c">!    ELSE</span>
<a name="ln-706"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-707"></a>        <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-708"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-709"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-710"></a>              <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-711"></a>                <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-712"></a>                <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-713"></a>              <span class="n">ENDDO</span>
<a name="ln-714"></a>            <span class="n">ENDDO</span>
<a name="ln-715"></a>          <span class="n">ENDDO</span>
<a name="ln-716"></a>        <span class="n">ENDDO</span>
<a name="ln-717"></a>      <span class="n">ENDDO</span>
<a name="ln-718"></a>
<a name="ln-719"></a>      <span class="c">! Boundary Terms</span>
<a name="ln-720"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-721"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<a name="ln-722"></a>          <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-723"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-724"></a>              <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-725"></a>                <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-726"></a>                <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-727"></a>              <span class="n">ENDDO</span>
<a name="ln-728"></a>            <span class="n">ENDDO</span>
<a name="ln-729"></a>          <span class="n">ENDDO</span>
<a name="ln-730"></a>        <span class="n">ENDDO</span>
<a name="ln-731"></a>      <span class="n">ENDDO</span>
<a name="ln-732"></a>
<a name="ln-733"></a><span class="c">!    ENDIF</span>
<a name="ln-734"></a>
<a name="ln-735"></a>  <span class="k">END SUBROUTINE </span><span class="n">MapToScalar_MappedVector2D</span>
<a name="ln-736"></a>
<a name="ln-737"></a>  <span class="k">SUBROUTINE </span><span class="n">MapToTensor_MappedVector2D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">tensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-738"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-739"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-740"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tensor</span>
<a name="ln-741"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-742"></a>    <span class="c">! Local</span>
<a name="ln-743"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-744"></a>
<a name="ln-745"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-746"></a><span class="c">!      PRINT*, &#39;GPU Acceleration of MapToTensor_MappedVector2D not supported yet!&#39;</span>
<a name="ln-747"></a><span class="c">!    ELSE</span>
<a name="ln-748"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-749"></a>        <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-750"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-751"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-752"></a>              <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-753"></a>                <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-754"></a>                  <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-755"></a>                  <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-756"></a>                <span class="n">ENDDO</span>
<a name="ln-757"></a>              <span class="n">ENDDO</span>
<a name="ln-758"></a>            <span class="n">ENDDO</span>
<a name="ln-759"></a>          <span class="n">ENDDO</span>
<a name="ln-760"></a>        <span class="n">ENDDO</span>
<a name="ln-761"></a>      <span class="n">ENDDO</span>
<a name="ln-762"></a>
<a name="ln-763"></a>      <span class="c">! Boundary Terms</span>
<a name="ln-764"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-765"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<a name="ln-766"></a>          <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-767"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-768"></a>              <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-769"></a>                <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<a name="ln-770"></a>                  <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-771"></a>                  <span class="n">tensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-772"></a>                <span class="n">ENDDO</span>
<a name="ln-773"></a>              <span class="n">ENDDO</span>
<a name="ln-774"></a>            <span class="n">ENDDO</span>
<a name="ln-775"></a>          <span class="n">ENDDO</span>
<a name="ln-776"></a>        <span class="n">ENDDO</span>
<a name="ln-777"></a>      <span class="n">ENDDO</span>
<a name="ln-778"></a>
<a name="ln-779"></a><span class="c">!    ENDIF</span>
<a name="ln-780"></a>  <span class="k">END SUBROUTINE </span><span class="n">MapToTensor_MappedVector2D</span>
<a name="ln-781"></a>
<a name="ln-782"></a>  <span class="k">SUBROUTINE </span><span class="n">ContravariantProjection_MappedVector2D</span><span class="p">(</span><span class="n">physVector</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">compVector</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-783"></a>    <span class="c">! Takes a vector that has physical space coordinate directions (x,y,z) and projects the vector</span>
<a name="ln-784"></a>    <span class="c">! into the the contravariant basis vector directions. Keep in mind that the contravariant basis</span>
<a name="ln-785"></a>    <span class="c">! vectors are really the Jacobian weighted contravariant basis vectors</span>
<a name="ln-786"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-787"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">physVector</span>
<a name="ln-788"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-789"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-790"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compVector</span>
<a name="ln-791"></a>    <span class="c">! Local</span>
<a name="ln-792"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-793"></a>
<a name="ln-794"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-795"></a><span class="c">!</span>
<a name="ln-796"></a><span class="c">!      ! TO DO : Add boundary projection routine for GPU</span>
<a name="ln-797"></a><span class="c">!      CALL ContravariantProjection_MappedVector2D_gpu_wrapper(physVector % interior % deviceData, &amp;</span>
<a name="ln-798"></a><span class="c">!                                                              compVector % interior % deviceData, &amp;</span>
<a name="ln-799"></a><span class="c">!                                                              geometry % dsdx % interior % deviceData, &amp;</span>
<a name="ln-800"></a><span class="c">!                                                              physVector % N, &amp;</span>
<a name="ln-801"></a><span class="c">!                                                              physVector % nVar, &amp;</span>
<a name="ln-802"></a><span class="c">!                                                              physVector % nElem)</span>
<a name="ln-803"></a><span class="c">!</span>
<a name="ln-804"></a><span class="c">!    ELSE</span>
<a name="ln-805"></a>      <span class="c">! Assume that tensor(j,i) is vector i, component j</span>
<a name="ln-806"></a>      <span class="c">! =&gt; dot product is done along first dimension</span>
<a name="ln-807"></a>      <span class="c">! to project onto computational space</span>
<a name="ln-808"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-809"></a>        <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-810"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-811"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-812"></a>
<a name="ln-813"></a>              <span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-814"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-815"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-816"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-817"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-818"></a>
<a name="ln-819"></a>              <span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-820"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-821"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-822"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-823"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-824"></a>
<a name="ln-825"></a>            <span class="k">END DO</span>
<a name="ln-826"></a><span class="k">          END DO</span>
<a name="ln-827"></a><span class="k">        END DO</span>
<a name="ln-828"></a><span class="k">      END DO</span>
<a name="ln-829"></a>
<a name="ln-830"></a>      <span class="c">! Boundary Terms</span>
<a name="ln-831"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-832"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">4</span>
<a name="ln-833"></a>          <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-834"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-835"></a>              <span class="n">compVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-836"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-837"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-838"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-839"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-840"></a>
<a name="ln-841"></a>              <span class="n">compVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-842"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-843"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-844"></a>                <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-845"></a>                <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-846"></a>            <span class="n">ENDDO</span>
<a name="ln-847"></a>          <span class="n">ENDDO</span>
<a name="ln-848"></a>        <span class="n">ENDDO</span>
<a name="ln-849"></a>      <span class="n">ENDDO</span>
<a name="ln-850"></a>
<a name="ln-851"></a><span class="c">!    END IF</span>
<a name="ln-852"></a>
<a name="ln-853"></a>  <span class="k">END SUBROUTINE </span><span class="n">ContravariantProjection_MappedVector2D</span>
<a name="ln-854"></a>
<a name="ln-855"></a>  <span class="k">SUBROUTINE </span><span class="n">JacobianWeight_MappedVector2D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-856"></a>  <span class="c">! Applies the inverse jacobian</span>
<a name="ln-857"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-858"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-859"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-860"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-861"></a>    <span class="c">! Local</span>
<a name="ln-862"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span>
<a name="ln-863"></a>
<a name="ln-864"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-865"></a><span class="c">!</span>
<a name="ln-866"></a><span class="c">!      CALL JacobianWeight_MappedVector2D_gpu_wrapper(vector % interior % deviceData, &amp;</span>
<a name="ln-867"></a><span class="c">!                                                     geometry % dxds % interior % deviceData, &amp;</span>
<a name="ln-868"></a><span class="c">!                                                     vector % N, &amp;</span>
<a name="ln-869"></a><span class="c">!                                                     vector % nVar, &amp;</span>
<a name="ln-870"></a><span class="c">!                                                     vector % nElem)</span>
<a name="ln-871"></a><span class="c">!</span>
<a name="ln-872"></a><span class="c">!    ELSE</span>
<a name="ln-873"></a>
<a name="ln-874"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-875"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-876"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-877"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-878"></a>              <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-879"></a>                                                             <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-880"></a>              <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-881"></a>                                                             <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-882"></a>            <span class="n">ENDDO</span>
<a name="ln-883"></a>          <span class="n">ENDDO</span>
<a name="ln-884"></a>        <span class="n">ENDDO</span>
<a name="ln-885"></a>      <span class="n">ENDDO</span>
<a name="ln-886"></a>
<a name="ln-887"></a><span class="c">!    ENDIF</span>
<a name="ln-888"></a>
<a name="ln-889"></a>  <span class="k">END SUBROUTINE </span><span class="n">JacobianWeight_MappedVector2D</span>
<a name="ln-890"></a>
<a name="ln-891"></a>  <span class="k">SUBROUTINE </span><span class="n">Divergence_MappedVector3D</span><span class="p">(</span><span class="n">physVector</span><span class="p">,</span><span class="n">compVector</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">divVector</span><span class="p">,</span><span class="n">dForm</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-892"></a>    <span class="c">!</span>
<a name="ln-893"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-894"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">physVector</span>
<a name="ln-895"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compVector</span>
<a name="ln-896"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-897"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedScalar3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">divVector</span>
<a name="ln-898"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dForm</span>
<a name="ln-899"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-900"></a>
<a name="ln-901"></a>    <span class="k">CALL </span><span class="n">physVector</span> <span class="p">%</span> <span class="n">ContravariantProjection</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">compVector</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-902"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfWeakDGForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-903"></a>
<a name="ln-904"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-905"></a><span class="c">!        CALL compVector % interp % VectorDGDivergence_3D(compVector % interior % deviceData, &amp;</span>
<a name="ln-906"></a><span class="c">!                                                         compVector % boundary % deviceData, &amp;</span>
<a name="ln-907"></a><span class="c">!                                                         divVector % interior % deviceData, &amp;</span>
<a name="ln-908"></a><span class="c">!                                                         compVector % nvar, &amp;</span>
<a name="ln-909"></a><span class="c">!                                                         compVector % nelem)</span>
<a name="ln-910"></a><span class="c">!      ELSE</span>
<a name="ln-911"></a>        <span class="k">CALL </span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">VectorDGDivergence_3D</span><span class="p">(</span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-912"></a>                                                         <span class="n">compVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-913"></a>                                                         <span class="n">divVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-914"></a>                                                         <span class="n">compVector</span> <span class="p">%</span> <span class="n">nvar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-915"></a>                                                         <span class="n">compVector</span> <span class="p">%</span> <span class="n">nelem</span><span class="p">)</span>
<a name="ln-916"></a><span class="c">!      ENDIF</span>
<a name="ln-917"></a>
<a name="ln-918"></a>    <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfStrongForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-919"></a>
<a name="ln-920"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-921"></a><span class="c">!        CALL compVector % interp % VectorDivergence_3D(compVector % interior % deviceData, &amp;</span>
<a name="ln-922"></a><span class="c">!                                                       divVector % interior % deviceData, &amp;</span>
<a name="ln-923"></a><span class="c">!                                                       compVector % nvar, &amp;</span>
<a name="ln-924"></a><span class="c">!                                                       compVector % nelem)</span>
<a name="ln-925"></a><span class="c">!      ELSE</span>
<a name="ln-926"></a>        <span class="k">CALL </span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">VectorDivergence_3D</span><span class="p">(</span><span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-927"></a>                                                       <span class="n">divVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-928"></a>                                                       <span class="n">compVector</span> <span class="p">%</span> <span class="n">nvar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-929"></a>                                                       <span class="n">compVector</span> <span class="p">%</span> <span class="n">nelem</span><span class="p">)</span>
<a name="ln-930"></a><span class="c">!      ENDIF</span>
<a name="ln-931"></a>
<a name="ln-932"></a>    <span class="k">END IF</span>
<a name="ln-933"></a>
<a name="ln-934"></a><span class="k">    CALL </span><span class="n">divVector</span> <span class="p">%</span> <span class="n">JacobianWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-935"></a>
<a name="ln-936"></a>  <span class="k">END SUBROUTINE </span><span class="n">Divergence_MappedVector3D</span>
<a name="ln-937"></a>
<a name="ln-938"></a>  <span class="k">SUBROUTINE </span><span class="n">Gradient_MappedVector3D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">workScalar</span><span class="p">,</span><span class="n">workVector</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gradF</span><span class="p">,</span><span class="n">dForm</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-939"></a>    <span class="c">! Strong Form Operator - (Conservative Form)</span>
<a name="ln-940"></a>    <span class="c">!</span>
<a name="ln-941"></a>    <span class="c">! Calculates the gradient of a scalar 3D function using the conservative form of the</span>
<a name="ln-942"></a>    <span class="c">! mapped gradient operator</span>
<a name="ln-943"></a>    <span class="c">!</span>
<a name="ln-944"></a>    <span class="c">! \grad_{phys}( f ) =  (1 / J)*(\partial / \partial \xi_i ( J\vec{a}_i f )</span>
<a name="ln-945"></a>    <span class="c">!</span>
<a name="ln-946"></a>    <span class="c">! where the sum over i is implied.</span>
<a name="ln-947"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-948"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-949"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedScalar3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workScalar</span> <span class="c">! (scalar) nvar = 3*nvar</span>
<a name="ln-950"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workVector</span> <span class="c">! (vector) nvar = 3*nvar</span>
<a name="ln-951"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">workTensor</span> <span class="c">! (tensor) nvar = 3*nvar</span>
<a name="ln-952"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-953"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gradF</span>
<a name="ln-954"></a>    <span class="kt">INTEGER</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dForm</span>
<a name="ln-955"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-956"></a>
<a name="ln-957"></a>    <span class="k">CALL </span><span class="n">vector</span> <span class="p">%</span> <span class="n">MapToScalar</span><span class="p">(</span><span class="n">workScalar</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-958"></a>
<a name="ln-959"></a>    <span class="k">CALL </span><span class="n">workScalar</span> <span class="p">%</span> <span class="n">ContravariantWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">workTensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-960"></a>
<a name="ln-961"></a>    <span class="k">IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfWeakDGForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-962"></a>
<a name="ln-963"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-964"></a><span class="c">!        CALL workTensor % interp % TensorDGDivergence_3D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-965"></a><span class="c">!                                                         workTensor % boundary % deviceData, &amp;</span>
<a name="ln-966"></a><span class="c">!                                                         workVector % interior % deviceData, &amp;</span>
<a name="ln-967"></a><span class="c">!                                                         workTensor % nVar, &amp;</span>
<a name="ln-968"></a><span class="c">!                                                         workTensor % nElem)</span>
<a name="ln-969"></a><span class="c">!      ELSE</span>
<a name="ln-970"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDGDivergence_3D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-971"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-972"></a>                                                         <span class="n">workVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-973"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-974"></a>                                                         <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-975"></a><span class="c">!      END IF</span>
<a name="ln-976"></a>
<a name="ln-977"></a>    <span class="k">ELSE IF</span> <span class="p">(</span><span class="n">dForm</span> <span class="o">==</span> <span class="n">selfStrongForm</span><span class="p">)</span> <span class="k">THEN</span>
<a name="ln-978"></a>
<a name="ln-979"></a><span class="c">!      IF (gpuAccel) THEN</span>
<a name="ln-980"></a><span class="c">!        CALL workTensor % interp % TensorDivergence_3D(workTensor % interior % deviceData, &amp;</span>
<a name="ln-981"></a><span class="c">!                                                       workVector % interior % deviceData, &amp;</span>
<a name="ln-982"></a><span class="c">!                                                       workTensor % nVar, &amp;</span>
<a name="ln-983"></a><span class="c">!                                                       workTensor % nElem)</span>
<a name="ln-984"></a><span class="c">!      ELSE</span>
<a name="ln-985"></a>        <span class="k">CALL </span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interp</span> <span class="p">%</span> <span class="n">TensorDivergence_3D</span><span class="p">(</span><span class="n">workTensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-986"></a>                                                       <span class="n">workVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-987"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nVar</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-988"></a>                                                       <span class="n">workTensor</span> <span class="p">%</span> <span class="n">nElem</span><span class="p">)</span>
<a name="ln-989"></a><span class="c">!      END IF</span>
<a name="ln-990"></a>
<a name="ln-991"></a>    <span class="k">END IF</span>
<a name="ln-992"></a>
<a name="ln-993"></a><span class="k">    CALL </span><span class="n">workVector</span> <span class="p">%</span> <span class="n">MapToTensor</span><span class="p">(</span><span class="n">gradF</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-994"></a>
<a name="ln-995"></a>    <span class="k">CALL </span><span class="n">gradF</span> <span class="p">%</span> <span class="n">JacobianWeight</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-996"></a>
<a name="ln-997"></a>  <span class="k">END SUBROUTINE </span><span class="n">Gradient_MappedVector3D</span>
<a name="ln-998"></a>
<a name="ln-999"></a>  <span class="k">SUBROUTINE </span><span class="n">MapToScalar_MappedVector3D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">scalar</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-1000"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1001"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-1002"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedScalar3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scalar</span>
<a name="ln-1003"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-1004"></a>    <span class="c">! Local</span>
<a name="ln-1005"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">row</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-1006"></a>
<a name="ln-1007"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-1008"></a><span class="c">!      PRINT*, &#39;GPU Acceleration of MapToScalar_MappedVector3D not supported yet!&#39;</span>
<a name="ln-1009"></a><span class="c">!    ELSE</span>
<a name="ln-1010"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-1011"></a>        <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-1012"></a>          <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1013"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1014"></a>              <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1015"></a>                <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-1016"></a>                  <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1017"></a>                  <span class="n">scalar</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-1018"></a>                <span class="n">ENDDO</span>
<a name="ln-1019"></a>              <span class="n">ENDDO</span>
<a name="ln-1020"></a>            <span class="n">ENDDO</span>
<a name="ln-1021"></a>          <span class="n">ENDDO</span>
<a name="ln-1022"></a>        <span class="n">ENDDO</span>
<a name="ln-1023"></a>      <span class="n">ENDDO</span>
<a name="ln-1024"></a>
<a name="ln-1025"></a>      <span class="c">! Boundary Terms</span>
<a name="ln-1026"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-1027"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-1028"></a>          <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-1029"></a>            <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1030"></a>              <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1031"></a>                <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-1032"></a>                  <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1033"></a>                  <span class="n">scalar</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-1034"></a>                <span class="n">ENDDO</span>
<a name="ln-1035"></a>              <span class="n">ENDDO</span>
<a name="ln-1036"></a>            <span class="n">ENDDO</span>
<a name="ln-1037"></a>          <span class="n">ENDDO</span>
<a name="ln-1038"></a>        <span class="n">ENDDO</span>
<a name="ln-1039"></a>      <span class="n">ENDDO</span>
<a name="ln-1040"></a>
<a name="ln-1041"></a><span class="c">!    ENDIF</span>
<a name="ln-1042"></a>  <span class="k">END SUBROUTINE </span><span class="n">MapToScalar_MappedVector3D</span>
<a name="ln-1043"></a>
<a name="ln-1044"></a>  <span class="k">SUBROUTINE </span><span class="n">MapToTensor_MappedVector3D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">tensor</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-1045"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1046"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-1047"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedTensor3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tensor</span>
<a name="ln-1048"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-1049"></a>    <span class="c">! Local</span>
<a name="ln-1050"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-1051"></a>
<a name="ln-1052"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-1053"></a><span class="c">!      PRINT*, &#39;GPU Acceleration of MapToTensor_MappedVector3D not supported yet!&#39;</span>
<a name="ln-1054"></a><span class="c">!    ELSE</span>
<a name="ln-1055"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-1056"></a>        <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-1057"></a>          <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1058"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1059"></a>              <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1060"></a>                <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-1061"></a>                  <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-1062"></a>                    <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1063"></a>                    <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-1064"></a>                  <span class="n">ENDDO</span>
<a name="ln-1065"></a>                <span class="n">ENDDO</span>
<a name="ln-1066"></a>              <span class="n">ENDDO</span>
<a name="ln-1067"></a>            <span class="n">ENDDO</span>
<a name="ln-1068"></a>          <span class="n">ENDDO</span>
<a name="ln-1069"></a>        <span class="n">ENDDO</span>
<a name="ln-1070"></a>      <span class="n">ENDDO</span>
<a name="ln-1071"></a>
<a name="ln-1072"></a>      <span class="c">! Boundary Terms</span>
<a name="ln-1073"></a>      <span class="k">DO </span><span class="n">iel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nelem</span>
<a name="ln-1074"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-1075"></a>          <span class="k">DO </span><span class="n">ivar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nvar</span>
<a name="ln-1076"></a>            <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1077"></a>              <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1078"></a>                <span class="k">DO </span><span class="n">col</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-1079"></a>                  <span class="k">DO </span><span class="n">row</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-1080"></a>                    <span class="n">jvar</span> <span class="o">=</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">ivar</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1081"></a>                    <span class="n">tensor</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ivar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">jvar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iel</span><span class="p">)</span>
<a name="ln-1082"></a>                  <span class="n">ENDDO</span>
<a name="ln-1083"></a>                <span class="n">ENDDO</span>
<a name="ln-1084"></a>              <span class="n">ENDDO</span>
<a name="ln-1085"></a>            <span class="n">ENDDO</span>
<a name="ln-1086"></a>          <span class="n">ENDDO</span>
<a name="ln-1087"></a>        <span class="n">ENDDO</span>
<a name="ln-1088"></a>      <span class="n">ENDDO</span>
<a name="ln-1089"></a>
<a name="ln-1090"></a><span class="c">!    ENDIF</span>
<a name="ln-1091"></a>  <span class="k">END SUBROUTINE </span><span class="n">MapToTensor_MappedVector3D</span>
<a name="ln-1092"></a>
<a name="ln-1093"></a>  <span class="k">SUBROUTINE </span><span class="n">ContravariantProjection_MappedVector3D</span><span class="p">(</span><span class="n">physVector</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">compVector</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-1094"></a>    <span class="c">! Takes a vector that has physical space coordinate directions (x,y,z) and projects the vector</span>
<a name="ln-1095"></a>    <span class="c">! into the the contravariant basis vector directions. Keep in mind that the contravariant basis</span>
<a name="ln-1096"></a>    <span class="c">! vectors are really the Jacobian weighted contravariant basis vectors</span>
<a name="ln-1097"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1098"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">physVector</span>
<a name="ln-1099"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compVector</span>
<a name="ln-1100"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-1101"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-1102"></a>    <span class="c">! Local</span>
<a name="ln-1103"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">,</span><span class="n">iDir</span><span class="p">,</span><span class="n">iside</span>
<a name="ln-1104"></a>
<a name="ln-1105"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-1106"></a><span class="c">!</span>
<a name="ln-1107"></a><span class="c">!      ! TO DO : Add projection for boundary terms</span>
<a name="ln-1108"></a><span class="c">!      CALL ContravariantProjection_MappedVector3D_gpu_wrapper(physVector % interior % deviceData, &amp;</span>
<a name="ln-1109"></a><span class="c">!                                                              compVector % interior % deviceData, &amp;</span>
<a name="ln-1110"></a><span class="c">!                                                              geometry % dsdx % interior % deviceData, &amp;</span>
<a name="ln-1111"></a><span class="c">!                                                              physVector % N, &amp;</span>
<a name="ln-1112"></a><span class="c">!                                                              physVector % nVar, &amp;</span>
<a name="ln-1113"></a><span class="c">!                                                              physVector % nElem)</span>
<a name="ln-1114"></a><span class="c">!</span>
<a name="ln-1115"></a><span class="c">!    ELSE</span>
<a name="ln-1116"></a>      <span class="c">! Assume that tensor(j,i) is vector i, component j</span>
<a name="ln-1117"></a>      <span class="c">! =&gt; dot product is done along first dimension to</span>
<a name="ln-1118"></a>      <span class="c">! project onto computational space</span>
<a name="ln-1119"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-1120"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-1121"></a>          <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1122"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1123"></a>              <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1124"></a>
<a name="ln-1125"></a>                <span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-1126"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1127"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1128"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1129"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1130"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1131"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1132"></a>
<a name="ln-1133"></a>                <span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-1134"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1135"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1136"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1137"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1138"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1139"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1140"></a>
<a name="ln-1141"></a>                <span class="n">compVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-1142"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1143"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1144"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1145"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1146"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1147"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1148"></a>
<a name="ln-1149"></a>              <span class="k">END DO</span>
<a name="ln-1150"></a><span class="k">            END DO</span>
<a name="ln-1151"></a><span class="k">          END DO</span>
<a name="ln-1152"></a><span class="k">        END DO</span>
<a name="ln-1153"></a><span class="k">      END DO</span>
<a name="ln-1154"></a>
<a name="ln-1155"></a>      <span class="c">! Boundary Terms</span>
<a name="ln-1156"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-1157"></a>        <span class="k">DO </span><span class="n">iside</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-1158"></a>          <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-1159"></a>            <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1160"></a>              <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">physVector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1161"></a>                <span class="n">compVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-1162"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1163"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1164"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1165"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1166"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1167"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1168"></a>
<a name="ln-1169"></a>                <span class="n">compVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-1170"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1171"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1172"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1173"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1174"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1175"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1176"></a>
<a name="ln-1177"></a>                <span class="n">compVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-1178"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1179"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1180"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1181"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">+</span> <span class="p">&amp;</span>
<a name="ln-1182"></a>                        <span class="n">geometry</span> <span class="p">%</span> <span class="n">dsdx</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-1183"></a>                        <span class="n">physVector</span> <span class="p">%</span> <span class="n">boundary</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iside</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1184"></a>              <span class="n">ENDDO</span>
<a name="ln-1185"></a>            <span class="n">ENDDO</span>
<a name="ln-1186"></a>          <span class="n">ENDDO</span>
<a name="ln-1187"></a>        <span class="n">ENDDO</span>
<a name="ln-1188"></a>      <span class="n">ENDDO</span>
<a name="ln-1189"></a>      
<a name="ln-1190"></a><span class="c">!    END IF</span>
<a name="ln-1191"></a>
<a name="ln-1192"></a>  <span class="k">END SUBROUTINE </span><span class="n">ContravariantProjection_MappedVector3D</span>
<a name="ln-1193"></a>
<a name="ln-1194"></a>  <span class="k">SUBROUTINE </span><span class="n">JacobianWeight_MappedVector3D</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-1195"></a>  <span class="c">! Applies the inverse jacobian</span>
<a name="ln-1196"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1197"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedVector3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vector</span>
<a name="ln-1198"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-1199"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-1200"></a>    <span class="c">! Local</span>
<a name="ln-1201"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-1202"></a>
<a name="ln-1203"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-1204"></a><span class="c">!</span>
<a name="ln-1205"></a><span class="c">!      CALL JacobianWeight_MappedVector3D_gpu_wrapper(vector % interior % deviceData, &amp;</span>
<a name="ln-1206"></a><span class="c">!                                                     geometry % dxds % interior % deviceData, &amp;</span>
<a name="ln-1207"></a><span class="c">!                                                     vector % N, &amp;</span>
<a name="ln-1208"></a><span class="c">!                                                     vector % nVar, &amp;</span>
<a name="ln-1209"></a><span class="c">!                                                     vector % nElem)</span>
<a name="ln-1210"></a><span class="c">!</span>
<a name="ln-1211"></a><span class="c">!    ELSE</span>
<a name="ln-1212"></a>
<a name="ln-1213"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-1214"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-1215"></a>          <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1216"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1217"></a>              <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">vector</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1218"></a>                <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1219"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1220"></a>                <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1221"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1222"></a>                <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">vector</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1223"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1224"></a>              <span class="n">ENDDO</span>
<a name="ln-1225"></a>            <span class="n">ENDDO</span>
<a name="ln-1226"></a>          <span class="n">ENDDO</span>
<a name="ln-1227"></a>        <span class="n">ENDDO</span>
<a name="ln-1228"></a>      <span class="n">ENDDO</span>
<a name="ln-1229"></a>
<a name="ln-1230"></a><span class="c">!    ENDIF</span>
<a name="ln-1231"></a>
<a name="ln-1232"></a>  <span class="k">END SUBROUTINE </span><span class="n">JacobianWeight_MappedVector3D</span>
<a name="ln-1233"></a>
<a name="ln-1234"></a>  <span class="c">! ---------------------- Tensors ---------------------- !</span>
<a name="ln-1235"></a>
<a name="ln-1236"></a>  <span class="k">SUBROUTINE </span><span class="n">JacobianWeight_MappedTensor2D</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-1237"></a>  <span class="c">! Applies the inverse jacobian</span>
<a name="ln-1238"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1239"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedTensor2D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tensor</span>
<a name="ln-1240"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMQuad</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-1241"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-1242"></a>    <span class="c">! Local</span>
<a name="ln-1243"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span>
<a name="ln-1244"></a>
<a name="ln-1245"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-1246"></a><span class="c">!</span>
<a name="ln-1247"></a><span class="c">!      CALL JacobianWeight_MappedTensor2D_gpu_wrapper(tensor % interior % deviceData, &amp;</span>
<a name="ln-1248"></a><span class="c">!                                                     geometry % dxds % interior % deviceData, &amp;</span>
<a name="ln-1249"></a><span class="c">!                                                     tensor % N, &amp;</span>
<a name="ln-1250"></a><span class="c">!                                                     tensor % nVar, &amp;</span>
<a name="ln-1251"></a><span class="c">!                                                     tensor % nElem)</span>
<a name="ln-1252"></a><span class="c">!</span>
<a name="ln-1253"></a><span class="c">!    ELSE</span>
<a name="ln-1254"></a>
<a name="ln-1255"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-1256"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-1257"></a>          <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1258"></a>            <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1259"></a>              <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1260"></a>                                                             <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1261"></a>              <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1262"></a>                                                             <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1263"></a>              <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1264"></a>                                                             <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1265"></a>              <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1266"></a>                                                             <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1267"></a>            <span class="n">ENDDO</span>
<a name="ln-1268"></a>          <span class="n">ENDDO</span>
<a name="ln-1269"></a>        <span class="n">ENDDO</span>
<a name="ln-1270"></a>      <span class="n">ENDDO</span>
<a name="ln-1271"></a>
<a name="ln-1272"></a><span class="c">!    ENDIF</span>
<a name="ln-1273"></a>
<a name="ln-1274"></a>  <span class="k">END SUBROUTINE </span><span class="n">JacobianWeight_MappedTensor2D</span>
<a name="ln-1275"></a>
<a name="ln-1276"></a>  <span class="k">SUBROUTINE </span><span class="n">JacobianWeight_MappedTensor3D</span><span class="p">(</span><span class="n">tensor</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span><span class="n">gpuAccel</span><span class="p">)</span>
<a name="ln-1277"></a>  <span class="c">! Applies the inverse jacobian</span>
<a name="ln-1278"></a>    <span class="k">IMPLICIT NONE</span>
<a name="ln-1279"></a><span class="k">    CLASS</span><span class="p">(</span><span class="n">MappedTensor3D</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tensor</span>
<a name="ln-1280"></a>    <span class="k">TYPE</span><span class="p">(</span><span class="n">SEMHex</span><span class="p">),</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">geometry</span>
<a name="ln-1281"></a>    <span class="kt">LOGICAL</span><span class="p">,</span><span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">gpuAccel</span>
<a name="ln-1282"></a>    <span class="c">! Local</span>
<a name="ln-1283"></a>    <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">iEl</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-1284"></a>
<a name="ln-1285"></a><span class="c">!    IF (gpuAccel) THEN</span>
<a name="ln-1286"></a><span class="c">!</span>
<a name="ln-1287"></a><span class="c">!      CALL JacobianWeight_MappedTensor3D_gpu_wrapper(tensor % interior % deviceData, &amp;</span>
<a name="ln-1288"></a><span class="c">!                                                     geometry % dxds % interior % deviceData, &amp;</span>
<a name="ln-1289"></a><span class="c">!                                                     tensor % N, &amp;</span>
<a name="ln-1290"></a><span class="c">!                                                     tensor % nVar, &amp;</span>
<a name="ln-1291"></a><span class="c">!                                                     tensor % nElem)</span>
<a name="ln-1292"></a><span class="c">!</span>
<a name="ln-1293"></a><span class="c">!    ELSE</span>
<a name="ln-1294"></a>
<a name="ln-1295"></a>      <span class="k">DO </span><span class="n">iEl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nElem</span>
<a name="ln-1296"></a>        <span class="k">DO </span><span class="n">iVar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">nVar</span>
<a name="ln-1297"></a>          <span class="k">DO </span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1298"></a>            <span class="k">DO </span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1299"></a>              <span class="k">DO </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="n">tensor</span> <span class="p">%</span> <span class="n">N</span>
<a name="ln-1300"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1301"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1302"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1303"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1304"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1305"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1306"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1307"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1308"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1309"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1310"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1311"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1312"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1313"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1314"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1315"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1316"></a>                <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span> <span class="o">=</span> <span class="n">tensor</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">iVar</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span><span class="o">/</span><span class="p">&amp;</span>
<a name="ln-1317"></a>                                                                 <span class="n">geometry</span> <span class="p">%</span> <span class="n">J</span> <span class="p">%</span> <span class="n">interior</span> <span class="p">%</span> <span class="n">hostData</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">iEl</span><span class="p">)</span>
<a name="ln-1318"></a>              <span class="n">ENDDO</span>
<a name="ln-1319"></a>            <span class="n">ENDDO</span>
<a name="ln-1320"></a>          <span class="n">ENDDO</span>
<a name="ln-1321"></a>        <span class="n">ENDDO</span>
<a name="ln-1322"></a>      <span class="n">ENDDO</span>
<a name="ln-1323"></a>
<a name="ln-1324"></a><span class="c">!    ENDIF</span>
<a name="ln-1325"></a>
<a name="ln-1326"></a>  <span class="k">END SUBROUTINE </span><span class="n">JacobianWeight_MappedTensor3D</span>
<a name="ln-1327"></a>
<a name="ln-1328"></a><span class="k">END MODULE </span><span class="n">SELF_MappedData</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2021 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2021-02-25 19:01  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> SELF was developed by Joe Schoonover</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>