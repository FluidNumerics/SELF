BootStrap: docker
From: gcc:8.3.0


%help
  This image contains GCC 8.3.0, OpenMPI 4.0.1, and a parallel build of HDF5 1.10.5
  that can be used for compiling SELF-Fluids.

  GCC 8.3.0 is inherited from [Dockerhub](https://hub.docker.com/_/gcc/).
  OpenMPI and HDF5 are built in this container

  The generated images should be used in subsequent build steps for building SELF-Fluids. 


%post

   export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/lib   

   # OpenMPI 4.0.1
   cd /tmp
   wget https://download.open-mpi.org/release/open-mpi/v4.0/openmpi-4.0.1.tar.gz
   tar -xvzf openmpi-4.0.1.tar.gz
   cd /tmp/openmpi-4.0.1
   ./configure
   make 
   make install
   cd /
   rm -rf /tmp/openmpi-4.0.1/ /tmp/openmpi-4.0.1.tar.gz

   # HDF5 1.10.5
   cd /tmp
   wget https://github.com/live-clones/hdf5/archive/hdf5-1_10_5.tar.gz
   tar -xvzf hdf5-1_10_5.tar.gz
   cd /tmp/hdf5-hdf5-1_10_5
   CC=mpicc FC=mpif90 CXX=mpic++ ./configure --enable-parallel --enable-fortran
   make
   make install
   cd /
   rm -rf /tmp/hdf5-1_10_5.tar.gz /tmp/hdf5-hdf5-1_10_5

   exit 0

%environment
   export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/lib   

