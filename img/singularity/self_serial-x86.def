Bootstrap: docker
From: gcr.io/self-fluids/self-base_serial-x86

%files
   ./* /workspace

%environment
   export LD_LIBRARY_PATH=/opt/view/lib:/opt/self/lib:/opt/feqparse/lib:/opt/FLAP/lib:$LD_LIBRARY_PATH
   export PATH=/opt/self/bin:/opt/view/bin:$PATH
   export INSTALL_ROOT=/opt/self
   export GPU_ACCEL=false
   export WORKSPACE=/workspace
   export BUILD_TYPE=release
   export GPU_TARGET=none
   export SPACK_VERSION="v0.16.1"
   export HDF5_VERSION="1.12.0"

%post
   export BUILD_TYPE=release
   
   # Install SELF
   . /etc/profile.d/z10_spack_environment.sh && \
   cd /workspace/ && \
   BUILD=${BUILD_TYPE} \
   SELF_PREFIX=/opt/self \
   FC=gfortran \
   PREC=double \
   make

   cp /workspace/LICENSE /opt/self/
   
   rm -rf /workspace/*


%labels
   Author joe@fluidnumerics.com


%help
   The Spectral Element Library in Fortran is an OO Fortran library that is used to create PDE and ODE solvers
   using Spectral Element Methods. This container includes the SELF library in addition to a command line interface
   (self), that can be used to test drive interpolation and calculus operations using spectral element routines defined
   by SELF.
